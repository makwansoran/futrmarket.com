const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/secp256k1-DCxl8lbT.js","assets/index-Cn3kq7oy.js","assets/index-trjEgyRZ.css"])))=>i.map(i=>d[i]);
import{q as sa,aV as tl,_ as Qd,aW as St}from"./index-Cn3kq7oy.js";function ep(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function rl(r,e){return Array.isArray(e)?e.length===0?!0:r?e.every(t=>typeof t=="string"):e.every(t=>Number.isSafeInteger(t)):!1}function As(r,e){if(typeof e!="string")throw new Error(`${r}: string expected`);return!0}function na(r){if(!Number.isSafeInteger(r))throw new Error(`invalid integer: ${r}`)}function ho(r){if(!Array.isArray(r))throw new Error("array expected")}function Cs(r,e){if(!rl(!0,e))throw new Error(`${r}: array of strings expected`)}function tp(r,e){if(!rl(!1,e))throw new Error(`${r}: array of numbers expected`)}function rp(...r){const e=n=>n,t=(n,o)=>a=>n(o(a)),i=r.map(n=>n.encode).reduceRight(t,e),s=r.map(n=>n.decode).reduce(t,e);return{encode:i,decode:s}}function ip(r){const e=typeof r=="string"?r.split(""):r,t=e.length;Cs("alphabet",e);const i=new Map(e.map((s,n)=>[s,n]));return{encode:s=>(ho(s),s.map(n=>{if(!Number.isSafeInteger(n)||n<0||n>=t)throw new Error(`alphabet.encode: digit index outside alphabet "${n}". Allowed: ${r}`);return e[n]})),decode:s=>(ho(s),s.map(n=>{As("alphabet.decode",n);const o=i.get(n);if(o===void 0)throw new Error(`Unknown letter: "${n}". Allowed: ${r}`);return o}))}}function sp(r=""){return As("join",r),{encode:e=>(Cs("join.decode",e),e.join(r)),decode:e=>(As("join.decode",e),e.split(r))}}function np(r,e="="){return na(r),As("padding",e),{encode(t){for(Cs("padding.encode",t);t.length*r%8;)t.push(e);return t},decode(t){Cs("padding.decode",t);let i=t.length;if(i*r%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;i>0&&t[i-1]===e;i--)if((i-1)*r%8===0)throw new Error("padding: invalid, string has too much padding");return t.slice(0,i)}}}const il=(r,e)=>e===0?r:il(e,r%e),Ts=(r,e)=>r+(e-il(r,e)),dn=(()=>{let r=[];for(let e=0;e<40;e++)r.push(2**e);return r})();function Va(r,e,t,i){if(ho(r),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(t<=0||t>32)throw new Error(`convertRadix2: wrong to=${t}`);if(Ts(e,t)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${t} carryBits=${Ts(e,t)}`);let s=0,n=0;const o=dn[e],a=dn[t]-1,c=[];for(const h of r){if(na(h),h>=o)throw new Error(`convertRadix2: invalid data word=${h} from=${e}`);if(s=s<<e|h,n+e>32)throw new Error(`convertRadix2: carry overflow pos=${n} from=${e}`);for(n+=e;n>=t;n-=t)c.push((s>>n-t&a)>>>0);const u=dn[n];if(u===void 0)throw new Error("invalid carry");s&=u-1}if(s=s<<t-n&a,!i&&n>=e)throw new Error("Excess padding");if(!i&&s>0)throw new Error(`Non-zero padding: ${s}`);return i&&n>0&&c.push(s>>>0),c}function op(r,e=!1){if(na(r),r<=0||r>32)throw new Error("radix2: bits should be in (0..32]");if(Ts(8,r)>32||Ts(r,8)>32)throw new Error("radix2: carry overflow");return{encode:t=>{if(!ep(t))throw new Error("radix2.encode input should be Uint8Array");return Va(Array.from(t),8,r,!e)},decode:t=>(tp("radix2.decode",t),Uint8Array.from(Va(t,r,8,e)))}}const ap=rp(op(5),ip("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),np(5),sp(""));var ss={exports:{}},Ka;function cp(){if(Ka)return ss.exports;Ka=1;var r=typeof Reflect=="object"?Reflect:null,e=r&&typeof r.apply=="function"?r.apply:function(_,m,O){return Function.prototype.apply.call(_,m,O)},t;r&&typeof r.ownKeys=="function"?t=r.ownKeys:Object.getOwnPropertySymbols?t=function(_){return Object.getOwnPropertyNames(_).concat(Object.getOwnPropertySymbols(_))}:t=function(_){return Object.getOwnPropertyNames(_)};function i(I){console&&console.warn&&console.warn(I)}var s=Number.isNaN||function(_){return _!==_};function n(){n.init.call(this)}ss.exports=n,ss.exports.once=x,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var o=10;function a(I){if(typeof I!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof I)}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(I){if(typeof I!="number"||I<0||s(I))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+I+".");o=I}}),n.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(_){if(typeof _!="number"||_<0||s(_))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+_+".");return this._maxListeners=_,this};function c(I){return I._maxListeners===void 0?n.defaultMaxListeners:I._maxListeners}n.prototype.getMaxListeners=function(){return c(this)},n.prototype.emit=function(_){for(var m=[],O=1;O<arguments.length;O++)m.push(arguments[O]);var D=_==="error",b=this._events;if(b!==void 0)D=D&&b.error===void 0;else if(!D)return!1;if(D){var $;if(m.length>0&&($=m[0]),$ instanceof Error)throw $;var P=new Error("Unhandled error."+($?" ("+$.message+")":""));throw P.context=$,P}var C=b[_];if(C===void 0)return!1;if(typeof C=="function")e(C,this,m);else for(var U=C.length,N=d(C,U),O=0;O<U;++O)e(N[O],this,m);return!0};function h(I,_,m,O){var D,b,$;if(a(m),b=I._events,b===void 0?(b=I._events=Object.create(null),I._eventsCount=0):(b.newListener!==void 0&&(I.emit("newListener",_,m.listener?m.listener:m),b=I._events),$=b[_]),$===void 0)$=b[_]=m,++I._eventsCount;else if(typeof $=="function"?$=b[_]=O?[m,$]:[$,m]:O?$.unshift(m):$.push(m),D=c(I),D>0&&$.length>D&&!$.warned){$.warned=!0;var P=new Error("Possible EventEmitter memory leak detected. "+$.length+" "+String(_)+" listeners added. Use emitter.setMaxListeners() to increase limit");P.name="MaxListenersExceededWarning",P.emitter=I,P.type=_,P.count=$.length,i(P)}return I}n.prototype.addListener=function(_,m){return h(this,_,m,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(_,m){return h(this,_,m,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(I,_,m){var O={fired:!1,wrapFn:void 0,target:I,type:_,listener:m},D=u.bind(O);return D.listener=m,O.wrapFn=D,D}n.prototype.once=function(_,m){return a(m),this.on(_,l(this,_,m)),this},n.prototype.prependOnceListener=function(_,m){return a(m),this.prependListener(_,l(this,_,m)),this},n.prototype.removeListener=function(_,m){var O,D,b,$,P;if(a(m),D=this._events,D===void 0)return this;if(O=D[_],O===void 0)return this;if(O===m||O.listener===m)--this._eventsCount===0?this._events=Object.create(null):(delete D[_],D.removeListener&&this.emit("removeListener",_,O.listener||m));else if(typeof O!="function"){for(b=-1,$=O.length-1;$>=0;$--)if(O[$]===m||O[$].listener===m){P=O[$].listener,b=$;break}if(b<0)return this;b===0?O.shift():g(O,b),O.length===1&&(D[_]=O[0]),D.removeListener!==void 0&&this.emit("removeListener",_,P||m)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(_){var m,O,D;if(O=this._events,O===void 0)return this;if(O.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):O[_]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete O[_]),this;if(arguments.length===0){var b=Object.keys(O),$;for(D=0;D<b.length;++D)$=b[D],$!=="removeListener"&&this.removeAllListeners($);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(m=O[_],typeof m=="function")this.removeListener(_,m);else if(m!==void 0)for(D=m.length-1;D>=0;D--)this.removeListener(_,m[D]);return this};function f(I,_,m){var O=I._events;if(O===void 0)return[];var D=O[_];return D===void 0?[]:typeof D=="function"?m?[D.listener||D]:[D]:m?y(D):d(D,D.length)}n.prototype.listeners=function(_){return f(this,_,!0)},n.prototype.rawListeners=function(_){return f(this,_,!1)},n.listenerCount=function(I,_){return typeof I.listenerCount=="function"?I.listenerCount(_):p.call(I,_)},n.prototype.listenerCount=p;function p(I){var _=this._events;if(_!==void 0){var m=_[I];if(typeof m=="function")return 1;if(m!==void 0)return m.length}return 0}n.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function d(I,_){for(var m=new Array(_),O=0;O<_;++O)m[O]=I[O];return m}function g(I,_){for(;_+1<I.length;_++)I[_]=I[_+1];I.pop()}function y(I){for(var _=new Array(I.length),m=0;m<_.length;++m)_[m]=I[m].listener||I[m];return _}function x(I,_){return new Promise(function(m,O){function D($){I.removeListener(_,b),O($)}function b(){typeof I.removeListener=="function"&&I.removeListener("error",D),m([].slice.call(arguments))}E(I,_,b,{once:!0}),_!=="error"&&S(I,D,{once:!0})})}function S(I,_,m){typeof I.on=="function"&&E(I,"error",_,m)}function E(I,_,m,O){if(typeof I.on=="function")O.once?I.once(_,m):I.on(_,m);else if(typeof I.addEventListener=="function")I.addEventListener(_,function D(b){O.once&&I.removeEventListener(_,D),m(b)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof I)}return ss.exports}var ct=cp();const oa=sa(ct);var pn={};var uo=function(r,e){return uo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])},uo(r,e)};function hp(r,e){uo(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var lo=function(){return lo=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},lo.apply(this,arguments)};function up(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(r);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(t[i[s]]=r[i[s]]);return t}function lp(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n}function fp(r,e){return function(t,i){e(t,i,r)}}function dp(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function pp(r,e,t,i){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{h(i.next(u))}catch(l){o(l)}}function c(u){try{h(i.throw(u))}catch(l){o(l)}}function h(u){u.done?n(u.value):s(u.value).then(a,c)}h((i=i.apply(r,e||[])).next())})}function gp(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(h){return function(u){return c([h,u])}}function c(h){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(n=h[0]&2?s.return:h[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,h[1])).done)return n;switch(s=0,n&&(h=[h[0]&2,n.value]),h[0]){case 0:case 1:n=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,s=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!n||h[1]>n[0]&&h[1]<n[3])){t.label=h[1];break}if(h[0]===6&&t.label<n[1]){t.label=n[1],n=h;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(h);break}n[2]&&t.ops.pop(),t.trys.pop();continue}h=e.call(r,t)}catch(u){h=[6,u],s=0}finally{i=n=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function yp(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}function wp(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function fo(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function sl(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),s,n=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return n}function mp(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(sl(arguments[e]));return r}function bp(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var i=Array(r),s=0,e=0;e<t;e++)for(var n=arguments[e],o=0,a=n.length;o<a;o++,s++)i[s]=n[o];return i}function ki(r){return this instanceof ki?(this.v=r,this):new ki(r)}function vp(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),s,n=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(f){i[f]&&(s[f]=function(p){return new Promise(function(d,g){n.push([f,p,d,g])>1||a(f,p)})})}function a(f,p){try{c(i[f](p))}catch(d){l(n[0][3],d)}}function c(f){f.value instanceof ki?Promise.resolve(f.value.v).then(h,u):l(n[0][2],f)}function h(f){a("next",f)}function u(f){a("throw",f)}function l(f,p){f(p),n.shift(),n.length&&a(n[0][0],n[0][1])}}function Ep(r){var e,t;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=r[s]?function(o){return(t=!t)?{value:ki(r[s](o)),done:s==="return"}:n?n(o):o}:n}}function _p(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof fo=="function"?fo(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=r[n]&&function(o){return new Promise(function(a,c){o=r[n](o),s(a,c,o.done,o.value)})}}function s(n,o,a,c){Promise.resolve(c).then(function(h){n({value:h,done:a})},o)}}function xp(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function Ip(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function Sp(r){return r&&r.__esModule?r:{default:r}}function Dp(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function $p(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}const Op=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return lo},__asyncDelegator:Ep,__asyncGenerator:vp,__asyncValues:_p,__await:ki,__awaiter:pp,__classPrivateFieldGet:Dp,__classPrivateFieldSet:$p,__createBinding:yp,__decorate:lp,__exportStar:wp,__extends:hp,__generator:gp,__importDefault:Sp,__importStar:Ip,__makeTemplateObject:xp,__metadata:dp,__param:fp,__read:sl,__rest:up,__spread:mp,__spreadArrays:bp,__values:fo},Symbol.toStringTag,{value:"Module"})),Vs=tl(Op);var gn={},ui={},Wa;function Pp(){if(Wa)return ui;Wa=1,Object.defineProperty(ui,"__esModule",{value:!0}),ui.delay=void 0;function r(e){return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}return ui.delay=r,ui}var ur={},yn={},lr={},Ga;function Ap(){return Ga||(Ga=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.ONE_THOUSAND=lr.ONE_HUNDRED=void 0,lr.ONE_HUNDRED=100,lr.ONE_THOUSAND=1e3),lr}var wn={},Ya;function Cp(){return Ya||(Ya=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ONE_YEAR=r.FOUR_WEEKS=r.THREE_WEEKS=r.TWO_WEEKS=r.ONE_WEEK=r.THIRTY_DAYS=r.SEVEN_DAYS=r.FIVE_DAYS=r.THREE_DAYS=r.ONE_DAY=r.TWENTY_FOUR_HOURS=r.TWELVE_HOURS=r.SIX_HOURS=r.THREE_HOURS=r.ONE_HOUR=r.SIXTY_MINUTES=r.THIRTY_MINUTES=r.TEN_MINUTES=r.FIVE_MINUTES=r.ONE_MINUTE=r.SIXTY_SECONDS=r.THIRTY_SECONDS=r.TEN_SECONDS=r.FIVE_SECONDS=r.ONE_SECOND=void 0,r.ONE_SECOND=1,r.FIVE_SECONDS=5,r.TEN_SECONDS=10,r.THIRTY_SECONDS=30,r.SIXTY_SECONDS=60,r.ONE_MINUTE=r.SIXTY_SECONDS,r.FIVE_MINUTES=r.ONE_MINUTE*5,r.TEN_MINUTES=r.ONE_MINUTE*10,r.THIRTY_MINUTES=r.ONE_MINUTE*30,r.SIXTY_MINUTES=r.ONE_MINUTE*60,r.ONE_HOUR=r.SIXTY_MINUTES,r.THREE_HOURS=r.ONE_HOUR*3,r.SIX_HOURS=r.ONE_HOUR*6,r.TWELVE_HOURS=r.ONE_HOUR*12,r.TWENTY_FOUR_HOURS=r.ONE_HOUR*24,r.ONE_DAY=r.TWENTY_FOUR_HOURS,r.THREE_DAYS=r.ONE_DAY*3,r.FIVE_DAYS=r.ONE_DAY*5,r.SEVEN_DAYS=r.ONE_DAY*7,r.THIRTY_DAYS=r.ONE_DAY*30,r.ONE_WEEK=r.SEVEN_DAYS,r.TWO_WEEKS=r.ONE_WEEK*2,r.THREE_WEEKS=r.ONE_WEEK*3,r.FOUR_WEEKS=r.ONE_WEEK*4,r.ONE_YEAR=r.ONE_DAY*365})(wn)),wn}var Ja;function nl(){return Ja||(Ja=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Vs;e.__exportStar(Ap(),r),e.__exportStar(Cp(),r)})(yn)),yn}var Za;function Tp(){if(Za)return ur;Za=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.fromMiliseconds=ur.toMiliseconds=void 0;const r=nl();function e(i){return i*r.ONE_THOUSAND}ur.toMiliseconds=e;function t(i){return Math.floor(i/r.ONE_THOUSAND)}return ur.fromMiliseconds=t,ur}var Xa;function Rp(){return Xa||(Xa=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Vs;e.__exportStar(Pp(),r),e.__exportStar(Tp(),r)})(gn)),gn}var Tr={},Qa;function Bp(){if(Qa)return Tr;Qa=1,Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.Watch=void 0;class r{constructor(){this.timestamps=new Map}start(t){if(this.timestamps.has(t))throw new Error(`Watch already started for label: ${t}`);this.timestamps.set(t,{started:Date.now()})}stop(t){const i=this.get(t);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${t}`);const s=Date.now()-i.started;this.timestamps.set(t,{started:i.started,elapsed:s})}get(t){const i=this.timestamps.get(t);if(typeof i>"u")throw new Error(`No timestamp found for label: ${t}`);return i}elapsed(t){const i=this.get(t);return i.elapsed||Date.now()-i.started}}return Tr.Watch=r,Tr.default=r,Tr}var mn={},li={},ec;function Np(){if(ec)return li;ec=1,Object.defineProperty(li,"__esModule",{value:!0}),li.IWatch=void 0;class r{}return li.IWatch=r,li}var tc;function Up(){return tc||(tc=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0}),Vs.__exportStar(Np(),r)})(mn)),mn}var rc;function kp(){return rc||(rc=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Vs;e.__exportStar(Rp(),r),e.__exportStar(Bp(),r),e.__exportStar(Up(),r),e.__exportStar(nl(),r)})(pn)),pn}var L=kp();class Dr{}let jp=class extends Dr{constructor(e){super()}};const ic=L.FIVE_SECONDS,$r={pulse:"heartbeat_pulse"};let Fp=class ol extends jp{constructor(e){super(e),this.events=new ct.EventEmitter,this.interval=ic,this.interval=e?.interval||ic}static async init(e){const t=new ol(e);return await t.init(),t}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),L.toMiliseconds(this.interval))}pulse(){this.events.emit($r.pulse)}};const Lp=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Mp=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,qp=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function zp(r,e){if(r==="__proto__"||r==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Hp(r);return}return e}function Hp(r){console.warn(`[destr] Dropping "${r}" key to prevent prototype pollution.`)}function ns(r,e={}){if(typeof r!="string")return r;if(r[0]==='"'&&r[r.length-1]==='"'&&r.indexOf("\\")===-1)return r.slice(1,-1);const t=r.trim();if(t.length<=9)switch(t.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!qp.test(r)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return r}try{if(Lp.test(r)||Mp.test(r)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(r,zp)}return JSON.parse(r)}catch(i){if(e.strict)throw i;return r}}function Vp(r){return!r||typeof r.then!="function"?Promise.resolve(r):r}function be(r,...e){try{return Vp(r(...e))}catch(t){return Promise.reject(t)}}function Kp(r){const e=typeof r;return r===null||e!=="object"&&e!=="function"}function Wp(r){const e=Object.getPrototypeOf(r);return!e||e.isPrototypeOf(Object)}function xs(r){if(Kp(r))return String(r);if(Wp(r)||Array.isArray(r))return JSON.stringify(r);if(typeof r.toJSON=="function")return xs(r.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const po="base64:";function Gp(r){return typeof r=="string"?r:po+Zp(r)}function Yp(r){return typeof r!="string"||!r.startsWith(po)?r:Jp(r.slice(po.length))}function Jp(r){return globalThis.Buffer?Buffer.from(r,"base64"):Uint8Array.from(globalThis.atob(r),e=>e.codePointAt(0))}function Zp(r){return globalThis.Buffer?Buffer.from(r).toString("base64"):globalThis.btoa(String.fromCodePoint(...r))}function Fe(r){return r&&r.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function Xp(...r){return Fe(r.join(":"))}function os(r){return r=Fe(r),r?r+":":""}function Qp(r,e){if(e===void 0)return!0;let t=0,i=r.indexOf(":");for(;i>-1;)t++,i=r.indexOf(":",i+1);return t<=e}function eg(r,e){return e?r.startsWith(e)&&r[r.length-1]!=="$":r[r.length-1]!=="$"}const tg="memory",rg=()=>{const r=new Map;return{name:tg,getInstance:()=>r,hasItem(e){return r.has(e)},getItem(e){return r.get(e)??null},getItemRaw(e){return r.get(e)??null},setItem(e,t){r.set(e,t)},setItemRaw(e,t){r.set(e,t)},removeItem(e){r.delete(e)},getKeys(){return[...r.keys()]},clear(){r.clear()},dispose(){r.clear()}}};function ig(r={}){const e={mounts:{"":r.driver||rg()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=h=>{for(const u of e.mountpoints)if(h.startsWith(u))return{base:u,relativeKey:h.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:h,driver:e.mounts[""]}},i=(h,u)=>e.mountpoints.filter(l=>l.startsWith(h)||u&&h.startsWith(l)).map(l=>({relativeBase:h.length>l.length?h.slice(l.length):void 0,mountpoint:l,driver:e.mounts[l]})),s=(h,u)=>{if(e.watching){u=Fe(u);for(const l of e.watchListeners)l(h,u)}},n=async()=>{if(!e.watching){e.watching=!0;for(const h in e.mounts)e.unwatch[h]=await sc(e.mounts[h],s,h)}},o=async()=>{if(e.watching){for(const h in e.unwatch)await e.unwatch[h]();e.unwatch={},e.watching=!1}},a=(h,u,l)=>{const f=new Map,p=d=>{let g=f.get(d.base);return g||(g={driver:d.driver,base:d.base,items:[]},f.set(d.base,g)),g};for(const d of h){const g=typeof d=="string",y=Fe(g?d:d.key),x=g?void 0:d.value,S=g||!d.options?u:{...u,...d.options},E=t(y);p(E).items.push({key:y,value:x,relativeKey:E.relativeKey,options:S})}return Promise.all([...f.values()].map(d=>l(d))).then(d=>d.flat())},c={hasItem(h,u={}){h=Fe(h);const{relativeKey:l,driver:f}=t(h);return be(f.hasItem,l,u)},getItem(h,u={}){h=Fe(h);const{relativeKey:l,driver:f}=t(h);return be(f.getItem,l,u).then(p=>ns(p))},getItems(h,u={}){return a(h,u,l=>l.driver.getItems?be(l.driver.getItems,l.items.map(f=>({key:f.relativeKey,options:f.options})),u).then(f=>f.map(p=>({key:Xp(l.base,p.key),value:ns(p.value)}))):Promise.all(l.items.map(f=>be(l.driver.getItem,f.relativeKey,f.options).then(p=>({key:f.key,value:ns(p)})))))},getItemRaw(h,u={}){h=Fe(h);const{relativeKey:l,driver:f}=t(h);return f.getItemRaw?be(f.getItemRaw,l,u):be(f.getItem,l,u).then(p=>Yp(p))},async setItem(h,u,l={}){if(u===void 0)return c.removeItem(h);h=Fe(h);const{relativeKey:f,driver:p}=t(h);p.setItem&&(await be(p.setItem,f,xs(u),l),p.watch||s("update",h))},async setItems(h,u){await a(h,u,async l=>{if(l.driver.setItems)return be(l.driver.setItems,l.items.map(f=>({key:f.relativeKey,value:xs(f.value),options:f.options})),u);l.driver.setItem&&await Promise.all(l.items.map(f=>be(l.driver.setItem,f.relativeKey,xs(f.value),f.options)))})},async setItemRaw(h,u,l={}){if(u===void 0)return c.removeItem(h,l);h=Fe(h);const{relativeKey:f,driver:p}=t(h);if(p.setItemRaw)await be(p.setItemRaw,f,u,l);else if(p.setItem)await be(p.setItem,f,Gp(u),l);else return;p.watch||s("update",h)},async removeItem(h,u={}){typeof u=="boolean"&&(u={removeMeta:u}),h=Fe(h);const{relativeKey:l,driver:f}=t(h);f.removeItem&&(await be(f.removeItem,l,u),(u.removeMeta||u.removeMata)&&await be(f.removeItem,l+"$",u),f.watch||s("remove",h))},async getMeta(h,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),h=Fe(h);const{relativeKey:l,driver:f}=t(h),p=Object.create(null);if(f.getMeta&&Object.assign(p,await be(f.getMeta,l,u)),!u.nativeOnly){const d=await be(f.getItem,l+"$",u).then(g=>ns(g));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(p,d))}return p},setMeta(h,u,l={}){return this.setItem(h+"$",u,l)},removeMeta(h,u={}){return this.removeItem(h+"$",u)},async getKeys(h,u={}){h=os(h);const l=i(h,!0);let f=[];const p=[];let d=!0;for(const y of l){y.driver.flags?.maxDepth||(d=!1);const x=await be(y.driver.getKeys,y.relativeBase,u);for(const S of x){const E=y.mountpoint+Fe(S);f.some(I=>E.startsWith(I))||p.push(E)}f=[y.mountpoint,...f.filter(S=>!S.startsWith(y.mountpoint))]}const g=u.maxDepth!==void 0&&!d;return p.filter(y=>(!g||Qp(y,u.maxDepth))&&eg(y,h))},async clear(h,u={}){h=os(h),await Promise.all(i(h,!1).map(async l=>{if(l.driver.clear)return be(l.driver.clear,l.relativeBase,u);if(l.driver.removeItem){const f=await l.driver.getKeys(l.relativeBase||"",u);return Promise.all(f.map(p=>l.driver.removeItem(p,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(h=>nc(h)))},async watch(h){return await n(),e.watchListeners.push(h),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==h),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(h,u){if(h=os(h),h&&e.mounts[h])throw new Error(`already mounted at ${h}`);return h&&(e.mountpoints.push(h),e.mountpoints.sort((l,f)=>f.length-l.length)),e.mounts[h]=u,e.watching&&Promise.resolve(sc(u,s,h)).then(l=>{e.unwatch[h]=l}).catch(console.error),c},async unmount(h,u=!0){h=os(h),!(!h||!e.mounts[h])&&(e.watching&&h in e.unwatch&&(e.unwatch[h]?.(),delete e.unwatch[h]),u&&await nc(e.mounts[h]),e.mountpoints=e.mountpoints.filter(l=>l!==h),delete e.mounts[h])},getMount(h=""){h=Fe(h)+":";const u=t(h);return{driver:u.driver,base:u.base}},getMounts(h="",u={}){return h=Fe(h),i(h,u.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(h,u={})=>c.getKeys(h,u),get:(h,u={})=>c.getItem(h,u),set:(h,u,l={})=>c.setItem(h,u,l),has:(h,u={})=>c.hasItem(h,u),del:(h,u={})=>c.removeItem(h,u),remove:(h,u={})=>c.removeItem(h,u)};return c}function sc(r,e,t){return r.watch?r.watch((i,s)=>e(i,t+s)):()=>{}}async function nc(r){typeof r.dispose=="function"&&await be(r.dispose)}function Or(r){return new Promise((e,t)=>{r.oncomplete=r.onsuccess=()=>e(r.result),r.onabort=r.onerror=()=>t(r.error)})}function al(r,e){const t=indexedDB.open(r);t.onupgradeneeded=()=>t.result.createObjectStore(e);const i=Or(t);return(s,n)=>i.then(o=>n(o.transaction(e,s).objectStore(e)))}let bn;function Ki(){return bn||(bn=al("keyval-store","keyval")),bn}function oc(r,e=Ki()){return e("readonly",t=>Or(t.get(r)))}function sg(r,e,t=Ki()){return t("readwrite",i=>(i.put(e,r),Or(i.transaction)))}function ng(r,e=Ki()){return e("readwrite",t=>(t.delete(r),Or(t.transaction)))}function og(r=Ki()){return r("readwrite",e=>(e.clear(),Or(e.transaction)))}function ag(r,e){return r.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Or(r.transaction)}function cg(r=Ki()){return r("readonly",e=>{if(e.getAllKeys)return Or(e.getAllKeys());const t=[];return ag(e,i=>t.push(i.key)).then(()=>t)})}const hg=r=>JSON.stringify(r,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),ug=r=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,t=r.replace(e,'$1"$2n"$3');return JSON.parse(t,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function _r(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return ug(r)}catch{return r}}function qt(r){return typeof r=="string"?r:hg(r)||""}const lg="idb-keyval";var fg=(r={})=>{const e=r.base&&r.base.length>0?`${r.base}:`:"",t=s=>e+s;let i;return r.dbName&&r.storeName&&(i=al(r.dbName,r.storeName)),{name:lg,options:r,async hasItem(s){return!(typeof await oc(t(s),i)>"u")},async getItem(s){return await oc(t(s),i)??null},setItem(s,n){return sg(t(s),n,i)},removeItem(s){return ng(t(s),i)},getKeys(){return cg(i)},clear(){return og(i)}}};const dg="WALLET_CONNECT_V2_INDEXED_DB",pg="keyvaluestorage";let gg=class{constructor(){this.indexedDb=ig({driver:fg({dbName:dg,storeName:pg})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const t=await this.indexedDb.getItem(e);if(t!==null)return t}async setItem(e,t){await this.indexedDb.setItem(e,qt(t))}async removeItem(e){await this.indexedDb.removeItem(e)}};var vn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Is={exports:{}};(function(){let r;function e(){}r=e,r.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},r.prototype.setItem=function(t,i){this[t]=String(i)},r.prototype.removeItem=function(t){delete this[t]},r.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(i){t[i]=void 0,delete t[i]})},r.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},r.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof vn<"u"&&vn.localStorage?Is.exports=vn.localStorage:typeof window<"u"&&window.localStorage?Is.exports=window.localStorage:Is.exports=new e})();function yg(r){var e;return[r[0],_r((e=r[1])!=null?e:"")]}let wg=class{constructor(){this.localStorage=Is.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(yg)}async getItem(e){const t=this.localStorage.getItem(e);if(t!==null)return _r(t)}async setItem(e,t){this.localStorage.setItem(e,qt(t))}async removeItem(e){this.localStorage.removeItem(e)}};const mg="wc_storage_version",ac=1,bg=async(r,e,t)=>{const i=mg,s=await e.getItem(i);if(s&&s>=ac){t(e);return}const n=await r.getKeys();if(!n.length){t(e);return}const o=[];for(;n.length;){const a=n.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const h=await r.getItem(a);await e.setItem(a,h),o.push(a)}}await e.setItem(i,ac),t(e),vg(r,o)},vg=async(r,e)=>{e.length&&e.forEach(async t=>{await r.removeItem(t)})};let Eg=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const e=new wg;this.storage=e;try{const t=new gg;bg(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};var En,cc;function _g(){if(cc)return En;cc=1;function r(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}En=e;function e(t,i,s){var n=s&&s.stringify||r,o=1;if(typeof t=="object"&&t!==null){var a=i.length+o;if(a===1)return t;var c=new Array(a);c[0]=n(t);for(var h=1;h<a;h++)c[h]=n(i[h]);return c.join(" ")}if(typeof t!="string")return t;var u=i.length;if(u===0)return t;for(var l="",f=1-o,p=-1,d=t&&t.length||0,g=0;g<d;){if(t.charCodeAt(g)===37&&g+1<d){switch(p=p>-1?p:0,t.charCodeAt(g+1)){case 100:case 102:if(f>=u||i[f]==null)break;p<g&&(l+=t.slice(p,g)),l+=Number(i[f]),p=g+2,g++;break;case 105:if(f>=u||i[f]==null)break;p<g&&(l+=t.slice(p,g)),l+=Math.floor(Number(i[f])),p=g+2,g++;break;case 79:case 111:case 106:if(f>=u||i[f]===void 0)break;p<g&&(l+=t.slice(p,g));var y=typeof i[f];if(y==="string"){l+="'"+i[f]+"'",p=g+2,g++;break}if(y==="function"){l+=i[f].name||"<anonymous>",p=g+2,g++;break}l+=n(i[f]),p=g+2,g++;break;case 115:if(f>=u)break;p<g&&(l+=t.slice(p,g)),l+=String(i[f]),p=g+2,g++;break;case 37:p<g&&(l+=t.slice(p,g)),l+="%",p=g+2,g++,f--;break}++f}++g}return p===-1?t:(p<d&&(l+=t.slice(p)),l)}return En}var _n,hc;function xg(){if(hc)return _n;hc=1;const r=_g();_n=s;const e=_().console||{},t={mapHttpRequest:d,mapHttpResponse:d,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:d,res:d,err:f};function i(m,O){return Array.isArray(m)?m.filter(function(b){return b!=="!stdSerializers.err"}):m===!0?Object.keys(O):!1}function s(m){m=m||{},m.browser=m.browser||{};const O=m.browser.transmit;if(O&&typeof O.send!="function")throw Error("pino: transmit option must have a send function");const D=m.browser.write||e;m.browser.write&&(m.browser.asObject=!0);const b=m.serializers||{},$=i(m.browser.serialize,b);let P=m.browser.serialize;Array.isArray(m.browser.serialize)&&m.browser.serialize.indexOf("!stdSerializers.err")>-1&&(P=!1);const C=["error","fatal","warn","info","debug","trace"];typeof D=="function"&&(D.error=D.fatal=D.warn=D.info=D.debug=D.trace=D),m.enabled===!1&&(m.level="silent");const U=m.level||"info",N=Object.create(D);N.log||(N.log=y),Object.defineProperty(N,"levelVal",{get:v}),Object.defineProperty(N,"level",{get:A,set:B});const w={transmit:O,serialize:$,asObject:m.browser.asObject,levels:C,timestamp:p(m)};N.levels=s.levels,N.level=U,N.setMaxListeners=N.getMaxListeners=N.emit=N.addListener=N.on=N.prependListener=N.once=N.prependOnceListener=N.removeListener=N.removeAllListeners=N.listeners=N.listenerCount=N.eventNames=N.write=N.flush=y,N.serializers=b,N._serialize=$,N._stdErrSerialize=P,N.child=T,O&&(N._logEvent=l());function v(){return this.level==="silent"?1/0:this.levels.values[this.level]}function A(){return this._level}function B(R){if(R!=="silent"&&!this.levels.values[R])throw Error("unknown level "+R);this._level=R,n(w,N,"error","log"),n(w,N,"fatal","error"),n(w,N,"warn","error"),n(w,N,"info","log"),n(w,N,"debug","log"),n(w,N,"trace","log")}function T(R,k){if(!R)throw new Error("missing bindings for child Pino");k=k||{},$&&R.serializers&&(k.serializers=R.serializers);const q=k.serializers;if($&&q){var H=Object.assign({},b,q),M=m.browser.serialize===!0?Object.keys(H):$;delete R.serializers,c([R],M,H,this._stdErrSerialize)}function V(K){this._childLevel=(K._childLevel|0)+1,this.error=h(K,R,"error"),this.fatal=h(K,R,"fatal"),this.warn=h(K,R,"warn"),this.info=h(K,R,"info"),this.debug=h(K,R,"debug"),this.trace=h(K,R,"trace"),H&&(this.serializers=H,this._serialize=M),O&&(this._logEvent=l([].concat(K._logEvent.bindings,R)))}return V.prototype=this,new V(this)}return N}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=t,s.stdTimeFunctions=Object.assign({},{nullTime:x,epochTime:S,unixTime:E,isoTime:I});function n(m,O,D,b){const $=Object.getPrototypeOf(O);O[D]=O.levelVal>O.levels.values[D]?y:$[D]?$[D]:e[D]||e[b]||y,o(m,O,D)}function o(m,O,D){!m.transmit&&O[D]===y||(O[D]=(function(b){return function(){const P=m.timestamp(),C=new Array(arguments.length),U=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var N=0;N<C.length;N++)C[N]=arguments[N];if(m.serialize&&!m.asObject&&c(C,this._serialize,this.serializers,this._stdErrSerialize),m.asObject?b.call(U,a(this,D,C,P)):b.apply(U,C),m.transmit){const w=m.transmit.level||O.level,v=s.levels.values[w],A=s.levels.values[D];if(A<v)return;u(this,{ts:P,methodLevel:D,methodValue:A,transmitValue:s.levels.values[m.transmit.level||O.level],send:m.transmit.send,val:O.levelVal},C)}}})(O[D]))}function a(m,O,D,b){m._serialize&&c(D,m._serialize,m.serializers,m._stdErrSerialize);const $=D.slice();let P=$[0];const C={};b&&(C.time=b),C.level=s.levels.values[O];let U=(m._childLevel|0)+1;if(U<1&&(U=1),P!==null&&typeof P=="object"){for(;U--&&typeof $[0]=="object";)Object.assign(C,$.shift());P=$.length?r($.shift(),$):void 0}else typeof P=="string"&&(P=r($.shift(),$));return P!==void 0&&(C.msg=P),C}function c(m,O,D,b){for(const $ in m)if(b&&m[$]instanceof Error)m[$]=s.stdSerializers.err(m[$]);else if(typeof m[$]=="object"&&!Array.isArray(m[$]))for(const P in m[$])O&&O.indexOf(P)>-1&&P in D&&(m[$][P]=D[P](m[$][P]))}function h(m,O,D){return function(){const b=new Array(1+arguments.length);b[0]=O;for(var $=1;$<b.length;$++)b[$]=arguments[$-1];return m[D].apply(this,b)}}function u(m,O,D){const b=O.send,$=O.ts,P=O.methodLevel,C=O.methodValue,U=O.val,N=m._logEvent.bindings;c(D,m._serialize||Object.keys(m.serializers),m.serializers,m._stdErrSerialize===void 0?!0:m._stdErrSerialize),m._logEvent.ts=$,m._logEvent.messages=D.filter(function(w){return N.indexOf(w)===-1}),m._logEvent.level.label=P,m._logEvent.level.value=C,b(P,m._logEvent,U),m._logEvent=l(N)}function l(m){return{ts:0,messages:[],bindings:m||[],level:{label:"",value:0}}}function f(m){const O={type:m.constructor.name,msg:m.message,stack:m.stack};for(const D in m)O[D]===void 0&&(O[D]=m[D]);return O}function p(m){return typeof m.timestamp=="function"?m.timestamp:m.timestamp===!1?x:S}function d(){return{}}function g(m){return m}function y(){}function x(){return!1}function S(){return Date.now()}function E(){return Math.round(Date.now()/1e3)}function I(){return new Date(Date.now()).toISOString()}function _(){function m(O){return typeof O<"u"&&O}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return m(self)||m(window)||m(this)||{}}}return _n}var Jr=xg();const Wi=sa(Jr),Ig={level:"info"},Gi="custom_context",aa=1e3*1024;let Sg=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},uc=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const t=new Sg(e);if(t.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=t),this.tail=t):(this.head=t,this.tail=t),this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let t=this.head;for(;t!==null;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const t=e.value;return e=e.next,{done:!1,value:t}}}}},cl=class{constructor(e,t=aa){this.level=e??"error",this.levelValue=Jr.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new uc(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===Jr.levels.values.error?console.error(e):t===Jr.levels.values.warn?console.warn(e):t===Jr.levels.values.debug?console.debug(e):t===Jr.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(qt({timestamp:new Date().toISOString(),log:e}));const t=typeof e=="string"?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new uc(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const t=this.getLogArray();return t.push(qt({extraMetadata:e})),new Blob(t,{type:"application/json"})}},Dg=class{constructor(e,t=aa){this.baseChunkLogger=new cl(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const t=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=t,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t)}},$g=class{constructor(e,t=aa){this.baseChunkLogger=new cl(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var Og=Object.defineProperty,Pg=Object.defineProperties,Ag=Object.getOwnPropertyDescriptors,lc=Object.getOwnPropertySymbols,Cg=Object.prototype.hasOwnProperty,Tg=Object.prototype.propertyIsEnumerable,fc=(r,e,t)=>e in r?Og(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Rs=(r,e)=>{for(var t in e||(e={}))Cg.call(e,t)&&fc(r,t,e[t]);if(lc)for(var t of lc(e))Tg.call(e,t)&&fc(r,t,e[t]);return r},Bs=(r,e)=>Pg(r,Ag(e));function Ks(r){return Bs(Rs({},r),{level:r?.level||Ig.level})}function Rg(r,e=Gi){return r[e]||""}function Bg(r,e,t=Gi){return r[t]=e,r}function Ke(r,e=Gi){let t="";return typeof r.bindings>"u"?t=Rg(r,e):t=r.bindings().context||"",t}function Ng(r,e,t=Gi){const i=Ke(r,t);return i.trim()?`${i}/${e}`:e}function Ue(r,e,t=Gi){const i=Ng(r,e,t),s=r.child({context:i});return Bg(s,i,t)}function Ug(r){var e,t;const i=new Dg((e=r.opts)==null?void 0:e.level,r.maxSizeInBytes);return{logger:Wi(Bs(Rs({},r.opts),{level:"trace",browser:Bs(Rs({},(t=r.opts)==null?void 0:t.browser),{write:s=>i.write(s)})})),chunkLoggerController:i}}function kg(r){var e;const t=new $g((e=r.opts)==null?void 0:e.level,r.maxSizeInBytes);return{logger:Wi(Bs(Rs({},r.opts),{level:"trace"}),t),chunkLoggerController:t}}function jg(r){return typeof r.loggerOverride<"u"&&typeof r.loggerOverride!="string"?{logger:r.loggerOverride,chunkLoggerController:null}:typeof window<"u"?Ug(r):kg(r)}var Fg=Object.defineProperty,Lg=(r,e,t)=>e in r?Fg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,dc=(r,e,t)=>Lg(r,typeof e!="symbol"?e+"":e,t);let Mg=class extends Dr{constructor(e){super(),this.opts=e,dc(this,"protocol","wc"),dc(this,"version",2)}};var qg=Object.defineProperty,zg=(r,e,t)=>e in r?qg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Hg=(r,e,t)=>zg(r,e+"",t);let Vg=class extends Dr{constructor(e,t){super(),this.core=e,this.logger=t,Hg(this,"records",new Map)}},Kg=class{constructor(e,t){this.logger=e,this.core=t}},Wg=class extends Dr{constructor(e,t){super(),this.relayer=e,this.logger=t}},Gg=class extends Dr{constructor(e){super()}},Yg=class{constructor(e,t,i,s){this.core=e,this.logger=t,this.name=i}},Jg=class extends Dr{constructor(e,t){super(),this.relayer=e,this.logger=t}},Zg=class extends Dr{constructor(e,t){super(),this.core=e,this.logger=t}},Xg=class{constructor(e,t,i){this.core=e,this.logger=t,this.store=i}},Qg=class{constructor(e,t){this.projectId=e,this.logger=t}},ey=class{constructor(e,t,i){this.core=e,this.logger=t,this.telemetryEnabled=i}};var ty=Object.defineProperty,ry=(r,e,t)=>e in r?ty(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,pc=(r,e,t)=>ry(r,typeof e!="symbol"?e+"":e,t);let iy=class{constructor(e){this.opts=e,pc(this,"protocol","wc"),pc(this,"version",2)}},sy=class{constructor(e){this.client=e}};function ny(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function hl(r,...e){if(!ny(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function gc(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function oy(r,e){hl(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const Rr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const xn=r=>new DataView(r.buffer,r.byteOffset,r.byteLength);function ay(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function ul(r){return typeof r=="string"&&(r=ay(r)),hl(r),r}let cy=class{clone(){return this._cloneInto()}};function hy(r){const e=i=>r().update(ul(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function ll(r=32){if(Rr&&typeof Rr.getRandomValues=="function")return Rr.getRandomValues(new Uint8Array(r));if(Rr&&typeof Rr.randomBytes=="function")return Rr.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}function uy(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(t>>s&n),a=Number(t&n),c=i?4:0,h=i?0:4;r.setUint32(e+c,o,i),r.setUint32(e+h,a,i)}let ly=class extends cy{constructor(e,t,i,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=xn(this.buffer)}update(e){gc(this);const{view:t,buffer:i,blockLen:s}=this;e=ul(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=xn(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){gc(this),oy(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let l=o;l<s;l++)t[l]=0;uy(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=xn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=c/4,u=this.get();if(h>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<h;l++)a.setUint32(4*l,u[l],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=n,e.destroyed=o,s%t&&e.buffer.set(i),e}};const as=BigInt(2**32-1),go=BigInt(32);function fl(r,e=!1){return e?{h:Number(r&as),l:Number(r>>go&as)}:{h:Number(r>>go&as)|0,l:Number(r&as)|0}}function fy(r,e=!1){let t=new Uint32Array(r.length),i=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:n,l:o}=fl(r[s],e);[t[s],i[s]]=[n,o]}return[t,i]}const dy=(r,e)=>BigInt(r>>>0)<<go|BigInt(e>>>0),py=(r,e,t)=>r>>>t,gy=(r,e,t)=>r<<32-t|e>>>t,yy=(r,e,t)=>r>>>t|e<<32-t,wy=(r,e,t)=>r<<32-t|e>>>t,my=(r,e,t)=>r<<64-t|e>>>t-32,by=(r,e,t)=>r>>>t-32|e<<64-t,vy=(r,e)=>e,Ey=(r,e)=>r,_y=(r,e,t)=>r<<t|e>>>32-t,xy=(r,e,t)=>e<<t|r>>>32-t,Iy=(r,e,t)=>e<<t-32|r>>>64-t,Sy=(r,e,t)=>r<<t-32|e>>>64-t;function Dy(r,e,t,i){const s=(e>>>0)+(i>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}const $y=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),Oy=(r,e,t,i)=>e+t+i+(r/2**32|0)|0,Py=(r,e,t,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0),Ay=(r,e,t,i,s)=>e+t+i+s+(r/2**32|0)|0,Cy=(r,e,t,i,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0)+(s>>>0),Ty=(r,e,t,i,s,n)=>e+t+i+s+n+(r/2**32|0)|0,W={fromBig:fl,split:fy,toBig:dy,shrSH:py,shrSL:gy,rotrSH:yy,rotrSL:wy,rotrBH:my,rotrBL:by,rotr32H:vy,rotr32L:Ey,rotlSH:_y,rotlSL:xy,rotlBH:Iy,rotlBL:Sy,add:Dy,add3L:$y,add3H:Oy,add4L:Py,add4H:Ay,add5H:Ty,add5L:Cy},[Ry,By]=W.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Vt=new Uint32Array(80),Kt=new Uint32Array(80);let Ny=class extends ly{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:i,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:h,El:u,Fh:l,Fl:f,Gh:p,Gl:d,Hh:g,Hl:y}=this;return[e,t,i,s,n,o,a,c,h,u,l,f,p,d,g,y]}set(e,t,i,s,n,o,a,c,h,u,l,f,p,d,g,y){this.Ah=e|0,this.Al=t|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=h|0,this.El=u|0,this.Fh=l|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=y|0}process(e,t){for(let E=0;E<16;E++,t+=4)Vt[E]=e.getUint32(t),Kt[E]=e.getUint32(t+=4);for(let E=16;E<80;E++){const I=Vt[E-15]|0,_=Kt[E-15]|0,m=W.rotrSH(I,_,1)^W.rotrSH(I,_,8)^W.shrSH(I,_,7),O=W.rotrSL(I,_,1)^W.rotrSL(I,_,8)^W.shrSL(I,_,7),D=Vt[E-2]|0,b=Kt[E-2]|0,$=W.rotrSH(D,b,19)^W.rotrBH(D,b,61)^W.shrSH(D,b,6),P=W.rotrSL(D,b,19)^W.rotrBL(D,b,61)^W.shrSL(D,b,6),C=W.add4L(O,P,Kt[E-7],Kt[E-16]),U=W.add4H(C,m,$,Vt[E-7],Vt[E-16]);Vt[E]=U|0,Kt[E]=C|0}let{Ah:i,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:h,Dl:u,Eh:l,El:f,Fh:p,Fl:d,Gh:g,Gl:y,Hh:x,Hl:S}=this;for(let E=0;E<80;E++){const I=W.rotrSH(l,f,14)^W.rotrSH(l,f,18)^W.rotrBH(l,f,41),_=W.rotrSL(l,f,14)^W.rotrSL(l,f,18)^W.rotrBL(l,f,41),m=l&p^~l&g,O=f&d^~f&y,D=W.add5L(S,_,O,By[E],Kt[E]),b=W.add5H(D,x,I,m,Ry[E],Vt[E]),$=D|0,P=W.rotrSH(i,s,28)^W.rotrBH(i,s,34)^W.rotrBH(i,s,39),C=W.rotrSL(i,s,28)^W.rotrBL(i,s,34)^W.rotrBL(i,s,39),U=i&n^i&a^n&a,N=s&o^s&c^o&c;x=g|0,S=y|0,g=p|0,y=d|0,p=l|0,d=f|0,{h:l,l:f}=W.add(h|0,u|0,b|0,$|0),h=a|0,u=c|0,a=n|0,c=o|0,n=i|0,o=s|0;const w=W.add3L($,C,N);i=W.add3H(w,b,P,U),s=w|0}({h:i,l:s}=W.add(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:o}=W.add(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=W.add(this.Ch|0,this.Cl|0,a|0,c|0),{h,l:u}=W.add(this.Dh|0,this.Dl|0,h|0,u|0),{h:l,l:f}=W.add(this.Eh|0,this.El|0,l|0,f|0),{h:p,l:d}=W.add(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:y}=W.add(this.Gh|0,this.Gl|0,g|0,y|0),{h:x,l:S}=W.add(this.Hh|0,this.Hl|0,x|0,S|0),this.set(i,s,n,o,a,c,h,u,l,f,p,d,g,y,x,S)}roundClean(){Vt.fill(0),Kt.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Uy=hy(()=>new Ny);const ca=BigInt(0),dl=BigInt(1),ky=BigInt(2);function ha(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function ua(r){if(!ha(r))throw new Error("Uint8Array expected")}function In(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}const jy=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function la(r){ua(r);let e="";for(let t=0;t<r.length;t++)e+=jy[r[t]];return e}function pl(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?ca:BigInt("0x"+r)}const Ct={_0:48,_9:57,A:65,F:70,a:97,f:102};function yc(r){if(r>=Ct._0&&r<=Ct._9)return r-Ct._0;if(r>=Ct.A&&r<=Ct.F)return r-(Ct.A-10);if(r>=Ct.a&&r<=Ct.f)return r-(Ct.a-10)}function gl(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(t);for(let s=0,n=0;s<t;s++,n+=2){const o=yc(r.charCodeAt(n)),a=yc(r.charCodeAt(n+1));if(o===void 0||a===void 0){const c=r[n]+r[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function Fy(r){return pl(la(r))}function Ss(r){return ua(r),pl(la(Uint8Array.from(r).reverse()))}function yl(r,e){return gl(r.toString(16).padStart(e*2,"0"))}function yo(r,e){return yl(r,e).reverse()}function Tt(r,e,t){let i;if(typeof e=="string")try{i=gl(e)}catch(n){throw new Error(r+" must be hex string or Uint8Array, cause: "+n)}else if(ha(e))i=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const s=i.length;if(typeof t=="number"&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return i}function wc(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];ua(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const n=r[i];t.set(n,s),s+=n.length}return t}const Sn=r=>typeof r=="bigint"&&ca<=r;function Ly(r,e,t){return Sn(r)&&Sn(e)&&Sn(t)&&e<=r&&r<t}function fi(r,e,t,i){if(!Ly(e,t,i))throw new Error("expected valid "+r+": "+t+" <= n < "+i+", got "+e)}function My(r){let e;for(e=0;r>ca;r>>=dl,e+=1);return e}const qy=r=>(ky<<BigInt(r-1))-dl,zy={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||ha(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function fa(r,e,t={}){const i=(s,n,o)=>{const a=zy[n];if(typeof a!="function")throw new Error("invalid validator function");const c=r[s];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(t))i(s,n,!0);return r}function mc(r){const e=new WeakMap;return(t,...i)=>{const s=e.get(t);if(s!==void 0)return s;const n=r(t,...i);return e.set(t,n),n}}const ve=BigInt(0),le=BigInt(1),gr=BigInt(2),Hy=BigInt(3),wo=BigInt(4),bc=BigInt(5),vc=BigInt(8);function ye(r,e){const t=r%e;return t>=ve?t:e+t}function Vy(r,e,t){if(e<ve)throw new Error("invalid exponent, negatives unsupported");if(t<=ve)throw new Error("invalid modulus");if(t===le)return ve;let i=le;for(;e>ve;)e&le&&(i=i*r%t),r=r*r%t,e>>=le;return i}function mt(r,e,t){let i=r;for(;e-- >ve;)i*=i,i%=t;return i}function Ec(r,e){if(r===ve)throw new Error("invert: expected non-zero number");if(e<=ve)throw new Error("invert: expected positive modulus, got "+e);let t=ye(r,e),i=e,s=ve,n=le;for(;t!==ve;){const o=i/t,a=i%t,c=s-n*o;i=t,t=a,s=n,n=c}if(i!==le)throw new Error("invert: does not exist");return ye(s,e)}function Ky(r){const e=(r-le)/gr;let t,i,s;for(t=r-le,i=0;t%gr===ve;t/=gr,i++);for(s=gr;s<r&&Vy(s,e,r)!==r-le;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(r+le)/wo;return function(a,c){const h=a.pow(c,o);if(!a.eql(a.sqr(h),c))throw new Error("Cannot find square root");return h}}const n=(t+le)/gr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,h=o.pow(o.mul(o.ONE,s),t),u=o.pow(a,n),l=o.pow(a,t);for(;!o.eql(l,o.ONE);){if(o.eql(l,o.ZERO))return o.ZERO;let f=1;for(let d=o.sqr(l);f<c&&!o.eql(d,o.ONE);f++)d=o.sqr(d);const p=o.pow(h,le<<BigInt(c-f-1));h=o.sqr(p),u=o.mul(u,p),l=o.mul(l,h),c=f}return u}}function Wy(r){if(r%wo===Hy){const e=(r+le)/wo;return function(t,i){const s=t.pow(i,e);if(!t.eql(t.sqr(s),i))throw new Error("Cannot find square root");return s}}if(r%vc===bc){const e=(r-bc)/vc;return function(t,i){const s=t.mul(i,gr),n=t.pow(s,e),o=t.mul(i,n),a=t.mul(t.mul(o,gr),n),c=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),i))throw new Error("Cannot find square root");return c}}return Ky(r)}const Gy=(r,e)=>(ye(r,e)&le)===le,Yy=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Jy(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=Yy.reduce((i,s)=>(i[s]="function",i),e);return fa(r,t)}function Zy(r,e,t){if(t<ve)throw new Error("invalid exponent, negatives unsupported");if(t===ve)return r.ONE;if(t===le)return e;let i=r.ONE,s=e;for(;t>ve;)t&le&&(i=r.mul(i,s)),s=r.sqr(s),t>>=le;return i}function Xy(r,e){const t=new Array(e.length),i=e.reduce((n,o,a)=>r.is0(o)?n:(t[a]=n,r.mul(n,o)),r.ONE),s=r.inv(i);return e.reduceRight((n,o,a)=>r.is0(o)?n:(t[a]=r.mul(n,t[a]),r.mul(n,o)),s),t}function wl(r,e){const t=e!==void 0?e:r.toString(2).length,i=Math.ceil(t/8);return{nBitLength:t,nByteLength:i}}function ml(r,e,t=!1,i={}){if(r<=ve)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:s,nByteLength:n}=wl(r,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:r,isLE:t,BITS:s,BYTES:n,MASK:qy(s),ZERO:ve,ONE:le,create:c=>ye(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return ve<=c&&c<r},is0:c=>c===ve,isOdd:c=>(c&le)===le,neg:c=>ye(-c,r),eql:(c,h)=>c===h,sqr:c=>ye(c*c,r),add:(c,h)=>ye(c+h,r),sub:(c,h)=>ye(c-h,r),mul:(c,h)=>ye(c*h,r),pow:(c,h)=>Zy(a,c,h),div:(c,h)=>ye(c*Ec(h,r),r),sqrN:c=>c*c,addN:(c,h)=>c+h,subN:(c,h)=>c-h,mulN:(c,h)=>c*h,inv:c=>Ec(c,r),sqrt:i.sqrt||(c=>(o||(o=Wy(r)),o(a,c))),invertBatch:c=>Xy(a,c),cmov:(c,h,u)=>u?h:c,toBytes:c=>t?yo(c,n):yl(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return t?Ss(c):Fy(c)}});return Object.freeze(a)}const _c=BigInt(0),cs=BigInt(1);function Dn(r,e){const t=e.negate();return r?t:e}function bl(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function $n(r,e){bl(r,e);const t=Math.ceil(e/r)+1,i=2**(r-1);return{windows:t,windowSize:i}}function Qy(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,i)=>{if(!(t instanceof e))throw new Error("invalid point at index "+i)})}function e0(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,i)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+i)})}const On=new WeakMap,vl=new WeakMap;function Pn(r){return vl.get(r)||1}function t0(r,e){return{constTimeNegate:Dn,hasPrecomputes(t){return Pn(t)!==1},unsafeLadder(t,i,s=r.ZERO){let n=t;for(;i>_c;)i&cs&&(s=s.add(n)),n=n.double(),i>>=cs;return s},precomputeWindow(t,i){const{windows:s,windowSize:n}=$n(i,e),o=[];let a=t,c=a;for(let h=0;h<s;h++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,i,s){const{windows:n,windowSize:o}=$n(t,e);let a=r.ZERO,c=r.BASE;const h=BigInt(2**t-1),u=2**t,l=BigInt(t);for(let f=0;f<n;f++){const p=f*o;let d=Number(s&h);s>>=l,d>o&&(d-=u,s+=cs);const g=p,y=p+Math.abs(d)-1,x=f%2!==0,S=d<0;d===0?c=c.add(Dn(x,i[g])):a=a.add(Dn(S,i[y]))}return{p:a,f:c}},wNAFUnsafe(t,i,s,n=r.ZERO){const{windows:o,windowSize:a}=$n(t,e),c=BigInt(2**t-1),h=2**t,u=BigInt(t);for(let l=0;l<o;l++){const f=l*a;if(s===_c)break;let p=Number(s&c);if(s>>=u,p>a&&(p-=h,s+=cs),p===0)continue;let d=i[f+Math.abs(p)-1];p<0&&(d=d.negate()),n=n.add(d)}return n},getPrecomputes(t,i,s){let n=On.get(i);return n||(n=this.precomputeWindow(i,t),t!==1&&On.set(i,s(n))),n},wNAFCached(t,i,s){const n=Pn(t);return this.wNAF(n,this.getPrecomputes(n,t,s),i)},wNAFCachedUnsafe(t,i,s,n){const o=Pn(t);return o===1?this.unsafeLadder(t,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,t,s),i,n)},setWindowSize(t,i){bl(i,e),vl.set(t,i),On.delete(t)}}}function r0(r,e,t,i){if(Qy(t,r),e0(i,e),t.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=r.ZERO,n=My(BigInt(t.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),h=Math.floor((e.BITS-1)/o)*o;let u=s;for(let l=h;l>=0;l-=o){c.fill(s);for(let p=0;p<i.length;p++){const d=i[p],g=Number(d>>BigInt(l)&BigInt(a));c[g]=c[g].add(t[p])}let f=s;for(let p=c.length-1,d=s;p>0;p--)d=d.add(c[p]),f=f.add(d);if(u=u.add(f),l!==0)for(let p=0;p<o;p++)u=u.double()}return u}function i0(r){return Jy(r.Fp),fa(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...wl(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}const lt=BigInt(0),ke=BigInt(1),hs=BigInt(2),s0=BigInt(8),n0={zip215:!0};function o0(r){const e=i0(r);return fa(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function a0(r){const e=o0(r),{Fp:t,n:i,prehash:s,hash:n,randomBytes:o,nByteLength:a,h:c}=e,h=hs<<BigInt(a*8)-ke,u=t.create,l=ml(e.n,e.nBitLength),f=e.uvRatio||((w,v)=>{try{return{isValid:!0,value:t.sqrt(w*t.inv(v))}}catch{return{isValid:!1,value:lt}}}),p=e.adjustScalarBytes||(w=>w),d=e.domain||((w,v,A)=>{if(In("phflag",A),v.length||A)throw new Error("Contexts/pre-hash are not supported");return w});function g(w,v){fi("coordinate "+w,v,lt,h)}function y(w){if(!(w instanceof E))throw new Error("ExtendedPoint expected")}const x=mc((w,v)=>{const{ex:A,ey:B,ez:T}=w,R=w.is0();v==null&&(v=R?s0:t.inv(T));const k=u(A*v),q=u(B*v),H=u(T*v);if(R)return{x:lt,y:ke};if(H!==ke)throw new Error("invZ was invalid");return{x:k,y:q}}),S=mc(w=>{const{a:v,d:A}=e;if(w.is0())throw new Error("bad point: ZERO");const{ex:B,ey:T,ez:R,et:k}=w,q=u(B*B),H=u(T*T),M=u(R*R),V=u(M*M),K=u(q*v),te=u(M*u(K+H)),ee=u(V+u(A*u(q*H)));if(te!==ee)throw new Error("bad point: equation left != right (1)");const G=u(B*T),he=u(R*k);if(G!==he)throw new Error("bad point: equation left != right (2)");return!0});class E{constructor(v,A,B,T){this.ex=v,this.ey=A,this.ez=B,this.et=T,g("x",v),g("y",A),g("z",B),g("t",T),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(v){if(v instanceof E)throw new Error("extended point not allowed");const{x:A,y:B}=v||{};return g("x",A),g("y",B),new E(A,B,ke,u(A*B))}static normalizeZ(v){const A=t.invertBatch(v.map(B=>B.ez));return v.map((B,T)=>B.toAffine(A[T])).map(E.fromAffine)}static msm(v,A){return r0(E,l,v,A)}_setWindowSize(v){m.setWindowSize(this,v)}assertValidity(){S(this)}equals(v){y(v);const{ex:A,ey:B,ez:T}=this,{ex:R,ey:k,ez:q}=v,H=u(A*q),M=u(R*T),V=u(B*q),K=u(k*T);return H===M&&V===K}is0(){return this.equals(E.ZERO)}negate(){return new E(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:v}=e,{ex:A,ey:B,ez:T}=this,R=u(A*A),k=u(B*B),q=u(hs*u(T*T)),H=u(v*R),M=A+B,V=u(u(M*M)-R-k),K=H+k,te=K-q,ee=H-k,G=u(V*te),he=u(K*ee),Ee=u(V*ee),hr=u(te*K);return new E(G,he,hr,Ee)}add(v){y(v);const{a:A,d:B}=e,{ex:T,ey:R,ez:k,et:q}=this,{ex:H,ey:M,ez:V,et:K}=v;if(A===BigInt(-1)){const ja=u((R-T)*(M+H)),Fa=u((R+T)*(M-H)),fn=u(Fa-ja);if(fn===lt)return this.double();const La=u(k*hs*K),Ma=u(q*hs*V),qa=Ma+La,za=Fa+ja,Ha=Ma-La,Yd=u(qa*fn),Jd=u(za*Ha),Zd=u(qa*Ha),Xd=u(fn*za);return new E(Yd,Jd,Xd,Zd)}const te=u(T*H),ee=u(R*M),G=u(q*B*K),he=u(k*V),Ee=u((T+R)*(H+M)-te-ee),hr=he-G,is=he+G,Cr=u(ee-A*te),ln=u(Ee*hr),Kd=u(is*Cr),Wd=u(Ee*Cr),Gd=u(hr*is);return new E(ln,Kd,Gd,Wd)}subtract(v){return this.add(v.negate())}wNAF(v){return m.wNAFCached(this,v,E.normalizeZ)}multiply(v){const A=v;fi("scalar",A,ke,i);const{p:B,f:T}=this.wNAF(A);return E.normalizeZ([B,T])[0]}multiplyUnsafe(v,A=E.ZERO){const B=v;return fi("scalar",B,lt,i),B===lt?_:this.is0()||B===ke?this:m.wNAFCachedUnsafe(this,B,E.normalizeZ,A)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return m.unsafeLadder(this,i).is0()}toAffine(v){return x(this,v)}clearCofactor(){const{h:v}=e;return v===ke?this:this.multiplyUnsafe(v)}static fromHex(v,A=!1){const{d:B,a:T}=e,R=t.BYTES;v=Tt("pointHex",v,R),In("zip215",A);const k=v.slice(),q=v[R-1];k[R-1]=q&-129;const H=Ss(k),M=A?h:t.ORDER;fi("pointHex.y",H,lt,M);const V=u(H*H),K=u(V-ke),te=u(B*V-T);let{isValid:ee,value:G}=f(K,te);if(!ee)throw new Error("Point.fromHex: invalid y coordinate");const he=(G&ke)===ke,Ee=(q&128)!==0;if(!A&&G===lt&&Ee)throw new Error("Point.fromHex: x=0 and x_0=1");return Ee!==he&&(G=u(-G)),E.fromAffine({x:G,y:H})}static fromPrivateKey(v){return b(v).point}toRawBytes(){const{x:v,y:A}=this.toAffine(),B=yo(A,t.BYTES);return B[B.length-1]|=v&ke?128:0,B}toHex(){return la(this.toRawBytes())}}E.BASE=new E(e.Gx,e.Gy,ke,u(e.Gx*e.Gy)),E.ZERO=new E(lt,ke,ke,lt);const{BASE:I,ZERO:_}=E,m=t0(E,a*8);function O(w){return ye(w,i)}function D(w){return O(Ss(w))}function b(w){const v=t.BYTES;w=Tt("private key",w,v);const A=Tt("hashed private key",n(w),2*v),B=p(A.slice(0,v)),T=A.slice(v,2*v),R=D(B),k=I.multiply(R),q=k.toRawBytes();return{head:B,prefix:T,scalar:R,point:k,pointBytes:q}}function $(w){return b(w).pointBytes}function P(w=new Uint8Array,...v){const A=wc(...v);return D(n(d(A,Tt("context",w),!!s)))}function C(w,v,A={}){w=Tt("message",w),s&&(w=s(w));const{prefix:B,scalar:T,pointBytes:R}=b(v),k=P(A.context,B,w),q=I.multiply(k).toRawBytes(),H=P(A.context,q,R,w),M=O(k+H*T);fi("signature.s",M,lt,i);const V=wc(q,yo(M,t.BYTES));return Tt("result",V,t.BYTES*2)}const U=n0;function N(w,v,A,B=U){const{context:T,zip215:R}=B,k=t.BYTES;w=Tt("signature",w,2*k),v=Tt("message",v),A=Tt("publicKey",A,k),R!==void 0&&In("zip215",R),s&&(v=s(v));const q=Ss(w.slice(k,2*k));let H,M,V;try{H=E.fromHex(A,R),M=E.fromHex(w.slice(0,k),R),V=I.multiplyUnsafe(q)}catch{return!1}if(!R&&H.isSmallOrder())return!1;const K=P(T,M.toRawBytes(),H.toRawBytes(),v);return M.add(H.multiplyUnsafe(K)).subtract(V).clearCofactor().equals(E.ZERO)}return I._setWindowSize(8),{CURVE:e,getPublicKey:$,sign:C,verify:N,ExtendedPoint:E,utils:{getExtendedPublicKey:b,randomPrivateKey:()=>o(t.BYTES),precompute(w=8,v=E.BASE){return v._setWindowSize(w),v.multiply(BigInt(3)),v}}}}BigInt(0),BigInt(1);const da=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),xc=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const c0=BigInt(1),Ic=BigInt(2);BigInt(3);const h0=BigInt(5),u0=BigInt(8);function l0(r){const e=BigInt(10),t=BigInt(20),i=BigInt(40),s=BigInt(80),n=da,o=r*r%n*r%n,a=mt(o,Ic,n)*o%n,c=mt(a,c0,n)*r%n,h=mt(c,h0,n)*c%n,u=mt(h,e,n)*h%n,l=mt(u,t,n)*u%n,f=mt(l,i,n)*l%n,p=mt(f,s,n)*f%n,d=mt(p,s,n)*f%n,g=mt(d,e,n)*h%n;return{pow_p_5_8:mt(g,Ic,n)*r%n,b2:o}}function f0(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function d0(r,e){const t=da,i=ye(e*e*e,t),s=ye(i*i*e,t),n=l0(r*s).pow_p_5_8;let o=ye(r*i*n,t);const a=ye(e*o*o,t),c=o,h=ye(o*xc,t),u=a===r,l=a===ye(-r,t),f=a===ye(-r*xc,t);return u&&(o=c),(l||f)&&(o=h),Gy(o,t)&&(o=ye(-o,t)),{isValid:u||l,value:o}}const p0=ml(da,void 0,!0),g0={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:p0,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:u0,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Uy,randomBytes:ll,adjustScalarBytes:f0,uvRatio:d0},El=a0(g0),y0="EdDSA",w0="JWT",Ns=".",Ws="base64url",_l="utf8",xl="utf8",m0=":",b0="did",v0="key",Sc="base58btc",E0="z",_0="K36",x0=32;function pa(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function Il(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?pa(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function Sl(r,e){e||(e=r.reduce((s,n)=>s+n.length,0));const t=Il(e);let i=0;for(const s of r)t.set(s,i),i+=s.length;return pa(t)}function I0(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),h=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,y=0,x=0,S=d.length;x!==S&&d[x]===0;)x++,g++;for(var E=(S-x)*u+1>>>0,I=new Uint8Array(E);x!==S;){for(var _=d[x],m=0,O=E-1;(_!==0||m<y)&&O!==-1;O--,m++)_+=256*I[O]>>>0,I[O]=_%a>>>0,_=_/a>>>0;if(_!==0)throw new Error("Non-zero carry");y=m,x++}for(var D=E-y;D!==E&&I[D]===0;)D++;for(var b=c.repeat(g);D<E;++D)b+=r.charAt(I[D]);return b}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var y=0,x=0;d[g]===c;)y++,g++;for(var S=(d.length-g)*h+1>>>0,E=new Uint8Array(S);d[g];){var I=t[d.charCodeAt(g)];if(I===255)return;for(var _=0,m=S-1;(I!==0||_<x)&&m!==-1;m--,_++)I+=a*E[m]>>>0,E[m]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");x=_,g++}if(d[g]!==" "){for(var O=S-x;O!==S&&E[O]===0;)O++;for(var D=new Uint8Array(y+(S-O)),b=y;O!==S;)D[b++]=E[O++];return D}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:f,decode:p}}var S0=I0,D0=S0;const Dl=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},$0=r=>new TextEncoder().encode(r),O0=r=>new TextDecoder().decode(r);let P0=class{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},A0=class{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return $l(this,e)}},C0=class{constructor(e){this.decoders=e}or(e){return $l(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const $l=(r,e)=>new C0({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let T0=class{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new P0(e,t,i),this.decoder=new A0(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Gs=({name:r,prefix:e,encode:t,decode:i})=>new T0(r,e,t,i),Yi=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=D0(t,e);return Gs({prefix:r,name:e,encode:i,decode:n=>Dl(s(n))})},R0=(r,e,t,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=r.length;for(;r[n-1]==="=";)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,h=0;for(let u=0;u<n;++u){const l=s[r[u]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<t|l,a+=t,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},B0=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,n+=e[s&a>>o];if(o&&(n+=e[s&a<<t-o]),i)for(;n.length*t&7;)n+="=";return n},De=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>Gs({prefix:e,name:r,encode(s){return B0(s,i,t)},decode(s){return R0(s,i,t,r)}}),N0=Gs({prefix:"\0",name:"identity",encode:r=>O0(r),decode:r=>$0(r)});var U0=Object.freeze({__proto__:null,identity:N0});const k0=De({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var j0=Object.freeze({__proto__:null,base2:k0});const F0=De({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var L0=Object.freeze({__proto__:null,base8:F0});const M0=Yi({prefix:"9",name:"base10",alphabet:"0123456789"});var q0=Object.freeze({__proto__:null,base10:M0});const z0=De({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),H0=De({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var V0=Object.freeze({__proto__:null,base16:z0,base16upper:H0});const K0=De({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),W0=De({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),G0=De({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Y0=De({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),J0=De({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Z0=De({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),X0=De({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Q0=De({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ew=De({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var tw=Object.freeze({__proto__:null,base32:K0,base32upper:W0,base32pad:G0,base32padupper:Y0,base32hex:J0,base32hexupper:Z0,base32hexpad:X0,base32hexpadupper:Q0,base32z:ew});const rw=Yi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),iw=Yi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var sw=Object.freeze({__proto__:null,base36:rw,base36upper:iw});const nw=Yi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ow=Yi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var aw=Object.freeze({__proto__:null,base58btc:nw,base58flickr:ow});const cw=De({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),hw=De({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),uw=De({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),lw=De({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var fw=Object.freeze({__proto__:null,base64:cw,base64pad:hw,base64url:uw,base64urlpad:lw});const Ol=Array.from(""),dw=Ol.reduce((r,e,t)=>(r[t]=e,r),[]),pw=Ol.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function gw(r){return r.reduce((e,t)=>(e+=dw[t],e),"")}function yw(r){const e=[];for(const t of r){const i=pw[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const ww=Gs({prefix:"",name:"base256emoji",encode:gw,decode:yw});var mw=Object.freeze({__proto__:null,base256emoji:ww}),bw=Pl,Dc=128,vw=-128,Ew=Math.pow(2,31);function Pl(r,e,t){e=e||[],t=t||0;for(var i=t;r>=Ew;)e[t++]=r&255|Dc,r/=128;for(;r&vw;)e[t++]=r&255|Dc,r>>>=7;return e[t]=r|0,Pl.bytes=t-i+1,e}var _w=mo,xw=128,$c=127;function mo(r,i){var t=0,i=i||0,s=0,n=i,o,a=r.length;do{if(n>=a)throw mo.bytes=0,new RangeError("Could not decode varint");o=r[n++],t+=s<28?(o&$c)<<s:(o&$c)*Math.pow(2,s),s+=7}while(o>=xw);return mo.bytes=n-i,t}var Iw=Math.pow(2,7),Sw=Math.pow(2,14),Dw=Math.pow(2,21),$w=Math.pow(2,28),Ow=Math.pow(2,35),Pw=Math.pow(2,42),Aw=Math.pow(2,49),Cw=Math.pow(2,56),Tw=Math.pow(2,63),Rw=function(r){return r<Iw?1:r<Sw?2:r<Dw?3:r<$w?4:r<Ow?5:r<Pw?6:r<Aw?7:r<Cw?8:r<Tw?9:10},Bw={encode:bw,decode:_w,encodingLength:Rw},Al=Bw;const Oc=(r,e,t=0)=>(Al.encode(r,e,t),e),Pc=r=>Al.encodingLength(r),bo=(r,e)=>{const t=e.byteLength,i=Pc(r),s=i+Pc(t),n=new Uint8Array(s+t);return Oc(r,n,0),Oc(t,n,i),n.set(e,s),new Nw(r,t,e,n)};let Nw=class{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}};const Cl=({name:r,code:e,encode:t})=>new Uw(r,e,t);let Uw=class{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?bo(this.code,t):t.then(i=>bo(this.code,i))}else throw Error("Unknown type, must be binary type")}};const Tl=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),kw=Cl({name:"sha2-256",code:18,encode:Tl("SHA-256")}),jw=Cl({name:"sha2-512",code:19,encode:Tl("SHA-512")});var Fw=Object.freeze({__proto__:null,sha256:kw,sha512:jw});const Rl=0,Lw="identity",Bl=Dl,Mw=r=>bo(Rl,Bl(r)),qw={code:Rl,name:Lw,encode:Bl,digest:Mw};var zw=Object.freeze({__proto__:null,identity:qw});new TextEncoder,new TextDecoder;const Ac={...U0,...j0,...L0,...q0,...V0,...tw,...sw,...aw,...fw,...mw};({...Fw,...zw});function Nl(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Cc=Nl("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),An=Nl("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=Il(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Ul={utf8:Cc,"utf-8":Cc,hex:Ac.base16,latin1:An,ascii:An,binary:An,...Ac};function Ys(r,e="utf8"){const t=Ul[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function ii(r,e="utf8"){const t=Ul[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?pa(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function Tc(r){return _r(Ys(ii(r,Ws),_l))}function Us(r){return Ys(ii(qt(r),_l),Ws)}function kl(r){const e=ii(_0,Sc),t=E0+Ys(Sl([e,r]),Sc);return[b0,v0,t].join(m0)}function Hw(r){return Ys(r,Ws)}function Vw(r){return ii(r,Ws)}function Kw(r){return ii([Us(r.header),Us(r.payload)].join(Ns),xl)}function Ww(r){return[Us(r.header),Us(r.payload),Hw(r.signature)].join(Ns)}function vo(r){const e=r.split(Ns),t=Tc(e[0]),i=Tc(e[1]),s=Vw(e[2]),n=ii(e.slice(0,2).join(Ns),xl);return{header:t,payload:i,signature:s,data:n}}function Rc(r=ll(x0)){const e=El.getPublicKey(r);return{secretKey:Sl([r,e]),publicKey:e}}async function Gw(r,e,t,i,s=L.fromMiliseconds(Date.now())){const n={alg:y0,typ:w0},o=kl(i.publicKey),a=s+t,c={iss:o,sub:r,aud:e,iat:s,exp:a},h=Kw({header:n,payload:c}),u=El.sign(h,i.secretKey.slice(0,32));return Ww({header:n,payload:c,signature:u})}var Bc=function(r,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,n;i<s;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return r.concat(n||Array.prototype.slice.call(e))},Yw=(function(){function r(e,t,i){this.name=e,this.version=t,this.os=i,this.type="browser"}return r})(),Jw=(function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r})(),Zw=(function(){function r(e,t,i,s){this.name=e,this.version=t,this.os=i,this.bot=s,this.type="bot-device"}return r})(),Xw=(function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r})(),Qw=(function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r})(),em=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,tm=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Nc=3,rm=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",em]],Uc=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function im(r){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Qw:typeof navigator<"u"?nm(navigator.userAgent):am()}function sm(r){return r!==""&&rm.reduce(function(e,t){var i=t[0],s=t[1];if(e)return e;var n=s.exec(r);return!!n&&[i,n]},!1)}function nm(r){var e=sm(r);if(!e)return null;var t=e[0],i=e[1];if(t==="searchbot")return new Xw;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<Nc&&(s=Bc(Bc([],s,!0),cm(Nc-s.length),!0)):s=[];var n=s.join("."),o=om(r),a=tm.exec(r);return a&&a[1]?new Zw(t,n,o,a[1]):new Yw(t,n,o)}function om(r){for(var e=0,t=Uc.length;e<t;e++){var i=Uc[e],s=i[0],n=i[1],o=n.exec(r);if(o)return s}return null}function am(){var r=typeof process<"u"&&process.version;return r?new Jw(process.version.slice(1)):null}function cm(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var se={},kc;function jl(){if(kc)return se;kc=1,Object.defineProperty(se,"__esModule",{value:!0}),se.getLocalStorage=se.getLocalStorageOrThrow=se.getCrypto=se.getCryptoOrThrow=se.getLocation=se.getLocationOrThrow=se.getNavigator=se.getNavigatorOrThrow=se.getDocument=se.getDocumentOrThrow=se.getFromWindowOrThrow=se.getFromWindow=void 0;function r(f){let p;return typeof window<"u"&&typeof window[f]<"u"&&(p=window[f]),p}se.getFromWindow=r;function e(f){const p=r(f);if(!p)throw new Error(`${f} is not defined in Window`);return p}se.getFromWindowOrThrow=e;function t(){return e("document")}se.getDocumentOrThrow=t;function i(){return r("document")}se.getDocument=i;function s(){return e("navigator")}se.getNavigatorOrThrow=s;function n(){return r("navigator")}se.getNavigator=n;function o(){return e("location")}se.getLocationOrThrow=o;function a(){return r("location")}se.getLocation=a;function c(){return e("crypto")}se.getCryptoOrThrow=c;function h(){return r("crypto")}se.getCrypto=h;function u(){return e("localStorage")}se.getLocalStorageOrThrow=u;function l(){return r("localStorage")}return se.getLocalStorage=l,se}var zt=jl(),di={},jc;function hm(){if(jc)return di;jc=1,Object.defineProperty(di,"__esModule",{value:!0}),di.getWindowMetadata=void 0;const r=jl();function e(){let t,i;try{t=r.getDocumentOrThrow(),i=r.getLocationOrThrow()}catch{return null}function s(){const p=t.getElementsByTagName("link"),d=[];for(let g=0;g<p.length;g++){const y=p[g],x=y.getAttribute("rel");if(x&&x.toLowerCase().indexOf("icon")>-1){const S=y.getAttribute("href");if(S)if(S.toLowerCase().indexOf("https:")===-1&&S.toLowerCase().indexOf("http:")===-1&&S.indexOf("//")!==0){let E=i.protocol+"//"+i.host;if(S.indexOf("/")===0)E+=S;else{const I=i.pathname.split("/");I.pop();const _=I.join("/");E+=_+"/"+S}d.push(E)}else if(S.indexOf("//")===0){const E=i.protocol+S;d.push(E)}else d.push(S)}}return d}function n(...p){const d=t.getElementsByTagName("meta");for(let g=0;g<d.length;g++){const y=d[g],x=["itemprop","property","name"].map(S=>y.getAttribute(S)).filter(S=>S?p.includes(S):!1);if(x.length&&x){const S=y.getAttribute("content");if(S)return S}}return""}function o(){let p=n("name","og:site_name","og:title","twitter:title");return p||(p=t.title),p}function a(){return n("description","og:description","twitter:description","keywords")}const c=o(),h=a(),u=i.origin,l=s();return{description:h,url:u,icons:l,name:c}}return di.getWindowMetadata=e,di}var um=hm();function ji(r,{strict:e=!0}={}){return!r||typeof r!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(r):r.startsWith("0x")}function Eo(r){return ji(r,{strict:!1})?Math.ceil((r.length-2)/2):r.length}const Fl="2.31.0";let Cn={getDocsUrl:({docsBaseUrl:r,docsPath:e="",docsSlug:t})=>e?`${r??"https://viem.sh"}${e}${t?`#${t}`:""}`:void 0,version:`viem@${Fl}`};class xr extends Error{constructor(e,t={}){const i=t.cause instanceof xr?t.cause.details:t.cause?.message?t.cause.message:t.details,s=t.cause instanceof xr&&t.cause.docsPath||t.docsPath,n=Cn.getDocsUrl?.({...t,docsPath:s}),o=[e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...n?[`Docs: ${n}`]:[],...i?[`Details: ${i}`]:[],...Cn.version?[`Version: ${Cn.version}`]:[]].join(`
`);super(o,t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=i,this.docsPath=s,this.metaMessages=t.metaMessages,this.name=t.name??this.name,this.shortMessage=e,this.version=Fl}walk(e){return Ll(this,e)}}function Ll(r,e){return e?.(r)?r:r&&typeof r=="object"&&"cause"in r&&r.cause!==void 0?Ll(r.cause,e):e?null:r}class Ml extends xr{constructor({size:e,targetSize:t,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:"SizeExceedsPaddingSizeError"})}}function si(r,{dir:e,size:t=32}={}){return typeof r=="string"?lm(r,{dir:e,size:t}):fm(r,{dir:e,size:t})}function lm(r,{dir:e,size:t=32}={}){if(t===null)return r;const i=r.replace("0x","");if(i.length>t*2)throw new Ml({size:Math.ceil(i.length/2),targetSize:t,type:"hex"});return`0x${i[e==="right"?"padEnd":"padStart"](t*2,"0")}`}function fm(r,{dir:e,size:t=32}={}){if(t===null)return r;if(r.length>t)throw new Ml({size:r.length,targetSize:t,type:"bytes"});const i=new Uint8Array(t);for(let s=0;s<t;s++){const n=e==="right";i[n?s:t-s-1]=r[n?s:r.length-s-1]}return i}class dm extends xr{constructor({max:e,min:t,signed:i,size:s,value:n}){super(`Number "${n}" is not in safe ${s?`${s*8}-bit ${i?"signed":"unsigned"} `:""}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:"IntegerOutOfRangeError"})}}class pm extends xr{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function ni(r,{size:e}){if(Eo(r)>e)throw new pm({givenSize:Eo(r),maxSize:e})}function _o(r,e={}){const{signed:t}=e;e.size&&ni(r,{size:e.size});const i=BigInt(r);if(!t)return i;const s=(r.length-2)/2,n=(1n<<BigInt(s)*8n-1n)-1n;return i<=n?i:i-BigInt(`0x${"f".padStart(s*2,"f")}`)-1n}function gm(r,e={}){return Number(_o(r,e))}const ym=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function xo(r,e={}){return typeof r=="number"||typeof r=="bigint"?zl(r,e):typeof r=="string"?bm(r,e):typeof r=="boolean"?wm(r,e):ql(r,e)}function wm(r,e={}){const t=`0x${Number(r)}`;return typeof e.size=="number"?(ni(t,{size:e.size}),si(t,{size:e.size})):t}function ql(r,e={}){let t="";for(let s=0;s<r.length;s++)t+=ym[r[s]];const i=`0x${t}`;return typeof e.size=="number"?(ni(i,{size:e.size}),si(i,{dir:"right",size:e.size})):i}function zl(r,e={}){const{signed:t,size:i}=e,s=BigInt(r);let n;i?t?n=(1n<<BigInt(i)*8n-1n)-1n:n=2n**(BigInt(i)*8n)-1n:typeof r=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&t?-n-1n:0;if(n&&s>n||s<o){const c=typeof r=="bigint"?"n":"";throw new dm({max:n?`${n}${c}`:void 0,min:`${o}${c}`,signed:t,size:i,value:`${r}${c}`})}const a=`0x${(t&&s<0?(1n<<BigInt(i*8))+BigInt(s):s).toString(16)}`;return i?si(a,{size:i}):a}const mm=new TextEncoder;function bm(r,e={}){const t=mm.encode(r);return ql(t,e)}const vm=new TextEncoder;function Em(r,e={}){return typeof r=="number"||typeof r=="bigint"?xm(r,e):typeof r=="boolean"?_m(r,e):ji(r)?Hl(r,e):Vl(r,e)}function _m(r,e={}){const t=new Uint8Array(1);return t[0]=Number(r),typeof e.size=="number"?(ni(t,{size:e.size}),si(t,{size:e.size})):t}const Rt={zero:48,nine:57,A:65,F:70,a:97,f:102};function Fc(r){if(r>=Rt.zero&&r<=Rt.nine)return r-Rt.zero;if(r>=Rt.A&&r<=Rt.F)return r-(Rt.A-10);if(r>=Rt.a&&r<=Rt.f)return r-(Rt.a-10)}function Hl(r,e={}){let t=r;e.size&&(ni(t,{size:e.size}),t=si(t,{dir:"right",size:e.size}));let i=t.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,n=new Uint8Array(s);for(let o=0,a=0;o<s;o++){const c=Fc(i.charCodeAt(a++)),h=Fc(i.charCodeAt(a++));if(c===void 0||h===void 0)throw new xr(`Invalid byte sequence ("${i[a-2]}${i[a-1]}" in "${i}").`);n[o]=c*16+h}return n}function xm(r,e){const t=zl(r,e);return Hl(t)}function Vl(r,e={}){const t=vm.encode(r);return typeof e.size=="number"?(ni(t,{size:e.size}),si(t,{dir:"right",size:e.size})):t}const us=BigInt(2**32-1),Lc=BigInt(32);function Im(r,e=!1){return e?{h:Number(r&us),l:Number(r>>Lc&us)}:{h:Number(r>>Lc&us)|0,l:Number(r&us)|0}}function Sm(r,e=!1){const t=r.length;let i=new Uint32Array(t),s=new Uint32Array(t);for(let n=0;n<t;n++){const{h:o,l:a}=Im(r[n],e);[i[n],s[n]]=[o,a]}return[i,s]}const Dm=(r,e,t)=>r<<t|e>>>32-t,$m=(r,e,t)=>e<<t|r>>>32-t,Om=(r,e,t)=>e<<t-32|r>>>64-t,Pm=(r,e,t)=>r<<t-32|e>>>64-t,Br=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Am(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function ks(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Fi(r,...e){if(!Am(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function LO(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");ks(r.outputLen),ks(r.blockLen)}function Mc(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Cm(r,e){Fi(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Tm(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Kl(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function MO(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function qO(r,e){return r<<32-e|r>>>e}const Rm=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Bm(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function Nm(r){for(let e=0;e<r.length;e++)r[e]=Bm(r[e]);return r}const qc=Rm?r=>r:Nm;function Um(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function Wl(r){return typeof r=="string"&&(r=Um(r)),Fi(r),r}function zO(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];Fi(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const n=r[i];t.set(n,s),s+=n.length}return t}class km{}function jm(r){const e=i=>r().update(Wl(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function HO(r=32){if(Br&&typeof Br.getRandomValues=="function")return Br.getRandomValues(new Uint8Array(r));if(Br&&typeof Br.randomBytes=="function")return Uint8Array.from(Br.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}const Fm=BigInt(0),pi=BigInt(1),Lm=BigInt(2),Mm=BigInt(7),qm=BigInt(256),zm=BigInt(113),Gl=[],Yl=[],Jl=[];for(let r=0,e=pi,t=1,i=0;r<24;r++){[t,i]=[i,(2*t+3*i)%5],Gl.push(2*(5*i+t)),Yl.push((r+1)*(r+2)/2%64);let s=Fm;for(let n=0;n<7;n++)e=(e<<pi^(e>>Mm)*zm)%qm,e&Lm&&(s^=pi<<(pi<<BigInt(n))-pi);Jl.push(s)}const Zl=Sm(Jl,!0),Hm=Zl[0],Vm=Zl[1],zc=(r,e,t)=>t>32?Om(r,e,t):Dm(r,e,t),Hc=(r,e,t)=>t>32?Pm(r,e,t):$m(r,e,t);function Km(r,e=24){const t=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,h=t[c],u=t[c+1],l=zc(h,u,1)^t[a],f=Hc(h,u,1)^t[a+1];for(let p=0;p<50;p+=10)r[o+p]^=l,r[o+p+1]^=f}let s=r[2],n=r[3];for(let o=0;o<24;o++){const a=Yl[o],c=zc(s,n,a),h=Hc(s,n,a),u=Gl[o];s=r[u],n=r[u+1],r[u]=c,r[u+1]=h}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=Hm[i],r[1]^=Vm[i]}Kl(t)}class ga extends km{constructor(e,t,i,s=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=s,this.rounds=n,ks(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Tm(this.state)}clone(){return this._cloneInto()}keccak(){qc(this.state32),Km(this.state32,this.rounds),qc(this.state32),this.posOut=0,this.pos=0}update(e){Mc(this),e=Wl(e),Fi(e);const{blockLen:t,state:i}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(t-this.pos,s-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:s}=this;e[i]^=t,(t&128)!==0&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){Mc(this,!1),Fi(e),this.finish();const t=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,n-s);e.set(t.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ks(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Cm(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Kl(this.state)}_cloneInto(e){const{blockLen:t,suffix:i,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new ga(t,i,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}}const Wm=(r,e,t)=>jm(()=>new ga(e,r,t)),Gm=Wm(1,136,256/8);function Xl(r,e){const t=e||"hex",i=Gm(ji(r,{strict:!1})?Em(r):r);return t==="bytes"?i:xo(i)}class Ym extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&t!==void 0&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const Tn=new Ym(8192);function Jm(r,e){if(Tn.has(`${r}.${e}`))return Tn.get(`${r}.${e}`);const t=r.substring(2).toLowerCase(),i=Xl(Vl(t),"bytes"),s=t.split("");for(let o=0;o<40;o+=2)i[o>>1]>>4>=8&&s[o]&&(s[o]=s[o].toUpperCase()),(i[o>>1]&15)>=8&&s[o+1]&&(s[o+1]=s[o+1].toUpperCase());const n=`0x${s.join("")}`;return Tn.set(`${r}.${e}`,n),n}function Zm(r){const e=Xl(`0x${r.substring(4)}`).substring(26);return Jm(`0x${e}`)}async function Xm({hash:r,signature:e}){const t=ji(r)?r:xo(r),{secp256k1:i}=await Qd(async()=>{const{secp256k1:o}=await import("./secp256k1-DCxl8lbT.js");return{secp256k1:o}},__vite__mapDeps([0,1,2]));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:h,s:u,v:l,yParity:f}=e,p=Number(f??l),d=Vc(p);return new i.Signature(_o(h),_o(u)).addRecoveryBit(d)}const o=ji(e)?e:xo(e);if(Eo(o)!==65)throw new Error("invalid signature length");const a=gm(`0x${o.slice(130)}`),c=Vc(a);return i.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(t.substring(2)).toHex(!1)}`}function Vc(r){if(r===0||r===1)return r;if(r===27)return 0;if(r===28)return 1;throw new Error("Invalid yParityOrV value")}async function Qm({hash:r,signature:e}){return Zm(await Xm({hash:r,signature:e}))}function eb(r){if(r.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let h=0;h<e.length;h++)e[h]=255;for(let h=0;h<r.length;h++){const u=r.charAt(h),l=u.charCodeAt(0);if(e[l]!==255)throw new TypeError(u+" is ambiguous");e[l]=h}const t=r.length,i=r.charAt(0),s=Math.log(t)/Math.log(256),n=Math.log(256)/Math.log(t);function o(h){if(h instanceof Uint8Array||(ArrayBuffer.isView(h)?h=new Uint8Array(h.buffer,h.byteOffset,h.byteLength):Array.isArray(h)&&(h=Uint8Array.from(h))),!(h instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(h.length===0)return"";let u=0,l=0,f=0;const p=h.length;for(;f!==p&&h[f]===0;)f++,u++;const d=(p-f)*n+1>>>0,g=new Uint8Array(d);for(;f!==p;){let S=h[f],E=0;for(let I=d-1;(S!==0||E<l)&&I!==-1;I--,E++)S+=256*g[I]>>>0,g[I]=S%t>>>0,S=S/t>>>0;if(S!==0)throw new Error("Non-zero carry");l=E,f++}let y=d-l;for(;y!==d&&g[y]===0;)y++;let x=i.repeat(u);for(;y<d;++y)x+=r.charAt(g[y]);return x}function a(h){if(typeof h!="string")throw new TypeError("Expected String");if(h.length===0)return new Uint8Array;let u=0,l=0,f=0;for(;h[u]===i;)l++,u++;const p=(h.length-u)*s+1>>>0,d=new Uint8Array(p);for(;u<h.length;){const S=h.charCodeAt(u);if(S>255)return;let E=e[S];if(E===255)return;let I=0;for(let _=p-1;(E!==0||I<f)&&_!==-1;_--,I++)E+=t*d[_]>>>0,d[_]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");f=I,u++}let g=p-f;for(;g!==p&&d[g]===0;)g++;const y=new Uint8Array(l+(p-g));let x=l;for(;g!==p;)y[x++]=d[g++];return y}function c(h){const u=a(h);if(u)return u;throw new Error("Non-base"+t+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var tb="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Ji=eb(tb);function rb(r){const e=r.length;let t=0,i=0;for(;i<e;){let s=r.charCodeAt(i++);if((s&4294967168)===0){t++;continue}else if((s&4294965248)===0)t+=2;else{if(s>=55296&&s<=56319&&i<e){const n=r.charCodeAt(i);(n&64512)===56320&&(++i,s=((s&1023)<<10)+(n&1023)+65536)}(s&4294901760)===0?t+=3:t+=4}}return t}function ib(r,e,t){const i=r.length;let s=t,n=0;for(;n<i;){let o=r.charCodeAt(n++);if((o&4294967168)===0){e[s++]=o;continue}else if((o&4294965248)===0)e[s++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&n<i){const a=r.charCodeAt(n);(a&64512)===56320&&(++n,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[s++]=o>>12&15|224,e[s++]=o>>6&63|128):(e[s++]=o>>18&7|240,e[s++]=o>>12&63|128,e[s++]=o>>6&63|128)}e[s++]=o&63|128}}const sb=new TextEncoder,nb=50;function ob(r,e,t){sb.encodeInto(r,e.subarray(t))}function ab(r,e,t){r.length>nb?ob(r,e,t):ib(r,e,t)}const cb=4096;function Ql(r,e,t){let i=e;const s=i+t,n=[];let o="";for(;i<s;){const a=r[i++];if((a&128)===0)n.push(a);else if((a&224)===192){const c=r[i++]&63;n.push((a&31)<<6|c)}else if((a&240)===224){const c=r[i++]&63,h=r[i++]&63;n.push((a&31)<<12|c<<6|h)}else if((a&248)===240){const c=r[i++]&63,h=r[i++]&63,u=r[i++]&63;let l=(a&7)<<18|c<<12|h<<6|u;l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|l&1023),n.push(l)}else n.push(a);n.length>=cb&&(o+=String.fromCharCode(...n),n.length=0)}return n.length>0&&(o+=String.fromCharCode(...n)),o}const hb=new TextDecoder,ub=200;function lb(r,e,t){const i=r.subarray(e,e+t);return hb.decode(i)}function fb(r,e,t){return t>ub?lb(r,e,t):Ql(r,e,t)}class ls{constructor(e,t){this.type=e,this.data=t}}class Ye extends Error{constructor(e){super(e);const t=Object.create(Ye.prototype);Object.setPrototypeOf(this,t),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:Ye.name})}}const gi=4294967295;function db(r,e,t){const i=t/4294967296,s=t;r.setUint32(e,i),r.setUint32(e+4,s)}function ef(r,e,t){const i=Math.floor(t/4294967296),s=t;r.setUint32(e,i),r.setUint32(e+4,s)}function tf(r,e){const t=r.getInt32(e),i=r.getUint32(e+4);return t*4294967296+i}function pb(r,e){const t=r.getUint32(e),i=r.getUint32(e+4);return t*4294967296+i}const gb=-1,yb=4294967296-1,wb=17179869184-1;function mb({sec:r,nsec:e}){if(r>=0&&e>=0&&r<=wb)if(e===0&&r<=yb){const t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,r),t}else{const t=r/4294967296,i=r&4294967295,s=new Uint8Array(8),n=new DataView(s.buffer);return n.setUint32(0,e<<2|t&3),n.setUint32(4,i),s}else{const t=new Uint8Array(12),i=new DataView(t.buffer);return i.setUint32(0,e),ef(i,4,r),t}}function bb(r){const e=r.getTime(),t=Math.floor(e/1e3),i=(e-t*1e3)*1e6,s=Math.floor(i/1e9);return{sec:t+s,nsec:i-s*1e9}}function vb(r){if(r instanceof Date){const e=bb(r);return mb(e)}else return null}function Eb(r){const e=new DataView(r.buffer,r.byteOffset,r.byteLength);switch(r.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const t=e.getUint32(0),i=e.getUint32(4),s=(t&3)*4294967296+i,n=t>>>2;return{sec:s,nsec:n}}case 12:{const t=tf(e,4),i=e.getUint32(0);return{sec:t,nsec:i}}default:throw new Ye(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${r.length}`)}}function _b(r){const e=Eb(r);return new Date(e.sec*1e3+e.nsec/1e6)}const xb={type:gb,encode:vb,decode:_b};class js{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(xb)}register({type:e,encode:t,decode:i}){if(e>=0)this.encoders[e]=t,this.decoders[e]=i;else{const s=-1-e;this.builtInEncoders[s]=t,this.builtInDecoders[s]=i}}tryToEncode(e,t){for(let i=0;i<this.builtInEncoders.length;i++){const s=this.builtInEncoders[i];if(s!=null){const n=s(e,t);if(n!=null){const o=-1-i;return new ls(o,n)}}}for(let i=0;i<this.encoders.length;i++){const s=this.encoders[i];if(s!=null){const n=s(e,t);if(n!=null){const o=i;return new ls(o,n)}}}return e instanceof ls?e:null}decode(e,t,i){const s=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return s?s(e,t,i):new ls(t,e)}}js.defaultCodec=new js;function Ib(r){return r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer}function Io(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):Ib(r)?new Uint8Array(r):Uint8Array.from(r)}const Sb=100,Db=2048;let $b=class rf{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??js.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??Sb,this.initialBufferSize=e?.initialBufferSize??Db,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new rf({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,t){if(t>this.maxDepth)throw new Error(`Too deep objects in depth ${t}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){const t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(t*2)}resizeBuffer(e){const t=new ArrayBuffer(e),i=new Uint8Array(t),s=new DataView(t);i.set(this.bytes),this.view=s,this.bytes=i}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const i=rb(e);this.ensureBufferSizeToWrite(5+i),this.writeStringHeader(i),ab(e,this.bytes,this.pos),this.pos+=i}encodeObject(e,t){const i=this.extensionCodec.tryToEncode(e,this.context);if(i!=null)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,t);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<4294967296)this.writeU8(198),this.writeU32(t);else throw new Error(`Too large binary: ${t}`);const i=Io(e);this.writeU8a(i)}encodeArray(e,t){const i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<4294967296)this.writeU8(221),this.writeU32(i);else throw new Error(`Too large array: ${i}`);for(const s of e)this.doEncode(s,t+1)}countWithoutUndefined(e,t){let i=0;for(const s of t)e[s]!==void 0&&i++;return i}encodeMap(e,t){const i=Object.keys(e);this.sortKeys&&i.sort();const s=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<4294967296)this.writeU8(223),this.writeU32(s);else throw new Error(`Too large map object: ${s}`);for(const n of i){const o=e[n];this.ignoreUndefined&&o===void 0||(this.encodeString(n),this.doEncode(o,t+1))}}encodeExtension(e){if(typeof e.data=="function"){const i=e.data(this.pos+6),s=i.length;if(s>=4294967296)throw new Error(`Too large extension object: ${s}`);this.writeU8(201),this.writeU32(s),this.writeI8(e.type),this.writeU8a(i);return}const t=e.data.length;if(t===1)this.writeU8(212);else if(t===2)this.writeU8(213);else if(t===4)this.writeU8(214);else if(t===8)this.writeU8(215);else if(t===16)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<4294967296)this.writeU8(201),this.writeU32(t);else throw new Error(`Too large extension object: ${t}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),db(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),ef(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function Ob(r,e){return new $b(e).encodeSharedRef(r)}function Rn(r){return`${r<0?"-":""}0x${Math.abs(r).toString(16).padStart(2,"0")}`}const Pb=16,Ab=16;class Cb{constructor(e=Pb,t=Ab){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=t,this.caches=[];for(let i=0;i<this.maxKeyLength;i++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,t,i){const s=this.caches[i-1];e:for(const n of s){const o=n.bytes;for(let a=0;a<i;a++)if(o[a]!==e[t+a])continue e;return n.str}return null}store(e,t){const i=this.caches[e.length-1],s={bytes:e,str:t};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=s:i.push(s)}decode(e,t,i){const s=this.find(e,t,i);if(s!=null)return this.hit++,s;this.miss++;const n=Ql(e,t,i),o=Uint8Array.prototype.slice.call(e,t,t+i);return this.store(o,n),n}}const So="array",Oi="map_key",sf="map_value",Tb=r=>{if(typeof r=="string"||typeof r=="number")return r;throw new Ye("The type of key must be string or number but "+typeof r)};class Rb{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const t=this.getUninitializedStateFromPool();t.type=So,t.position=0,t.size=e,t.array=new Array(e)}pushMapState(e){const t=this.getUninitializedStateFromPool();t.type=Oi,t.readCount=0,t.size=e,t.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===So){const i=e;i.size=0,i.array=void 0,i.position=0,i.type=void 0}if(e.type===Oi||e.type===sf){const i=e;i.size=0,i.map=void 0,i.readCount=0,i.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const yi=-1,ya=new DataView(new ArrayBuffer(0)),Bb=new Uint8Array(ya.buffer);try{ya.getInt8(0)}catch(r){if(!(r instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const Kc=new RangeError("Insufficient data"),Nb=new Cb;let Ub=class nf{constructor(e){this.totalPos=0,this.pos=0,this.view=ya,this.bytes=Bb,this.headByte=yi,this.stack=new Rb,this.entered=!1,this.extensionCodec=e?.extensionCodec??js.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??gi,this.maxBinLength=e?.maxBinLength??gi,this.maxArrayLength=e?.maxArrayLength??gi,this.maxMapLength=e?.maxMapLength??gi,this.maxExtLength=e?.maxExtLength??gi,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:Nb,this.mapKeyConverter=e?.mapKeyConverter??Tb}clone(){return new nf({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=yi,this.stack.reset()}setBuffer(e){const t=Io(e);this.bytes=t,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===yi&&!this.hasRemaining(1))this.setBuffer(e);else{const t=this.bytes.subarray(this.pos),i=Io(e),s=new Uint8Array(t.length+i.length);s.set(t),s.set(i,t.length),this.setBuffer(s)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:t,pos:i}=this;return new RangeError(`Extra ${t.byteLength-i} of ${t.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let t=!1,i;for await(const a of e){if(t)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{i=this.doDecodeSync(),t=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(t){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return i}const{headByte:s,pos:n,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${Rn(s)} at ${o} (${n} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,t){if(this.entered){yield*this.clone().decodeMultiAsync(e,t);return}try{this.entered=!0;let i=t,s=-1;for await(const n of e){if(t&&s===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(n),i&&(s=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),--s!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let t;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){const s=e-128;if(s!==0){this.pushMapState(s),this.complete();continue e}else t={}}else if(e<160){const s=e-144;if(s!==0){this.pushArrayState(s),this.complete();continue e}else t=[]}else{const s=e-160;t=this.decodeString(s,0)}else if(e===192)t=null;else if(e===194)t=!1;else if(e===195)t=!0;else if(e===202)t=this.readF32();else if(e===203)t=this.readF64();else if(e===204)t=this.readU8();else if(e===205)t=this.readU16();else if(e===206)t=this.readU32();else if(e===207)this.useBigInt64?t=this.readU64AsBigInt():t=this.readU64();else if(e===208)t=this.readI8();else if(e===209)t=this.readI16();else if(e===210)t=this.readI32();else if(e===211)this.useBigInt64?t=this.readI64AsBigInt():t=this.readI64();else if(e===217){const s=this.lookU8();t=this.decodeString(s,1)}else if(e===218){const s=this.lookU16();t=this.decodeString(s,2)}else if(e===219){const s=this.lookU32();t=this.decodeString(s,4)}else if(e===220){const s=this.readU16();if(s!==0){this.pushArrayState(s),this.complete();continue e}else t=[]}else if(e===221){const s=this.readU32();if(s!==0){this.pushArrayState(s),this.complete();continue e}else t=[]}else if(e===222){const s=this.readU16();if(s!==0){this.pushMapState(s),this.complete();continue e}else t={}}else if(e===223){const s=this.readU32();if(s!==0){this.pushMapState(s),this.complete();continue e}else t={}}else if(e===196){const s=this.lookU8();t=this.decodeBinary(s,1)}else if(e===197){const s=this.lookU16();t=this.decodeBinary(s,2)}else if(e===198){const s=this.lookU32();t=this.decodeBinary(s,4)}else if(e===212)t=this.decodeExtension(1,0);else if(e===213)t=this.decodeExtension(2,0);else if(e===214)t=this.decodeExtension(4,0);else if(e===215)t=this.decodeExtension(8,0);else if(e===216)t=this.decodeExtension(16,0);else if(e===199){const s=this.lookU8();t=this.decodeExtension(s,1)}else if(e===200){const s=this.lookU16();t=this.decodeExtension(s,2)}else if(e===201){const s=this.lookU32();t=this.decodeExtension(s,4)}else throw new Ye(`Unrecognized type byte: ${Rn(e)}`);this.complete();const i=this.stack;for(;i.length>0;){const s=i.top();if(s.type===So)if(s.array[s.position]=t,s.position++,s.position===s.size)t=s.array,i.release(s);else continue e;else if(s.type===Oi){if(t==="__proto__")throw new Ye("The key __proto__ is not allowed");s.key=this.mapKeyConverter(t),s.type=sf;continue e}else if(s.map[s.key]=t,s.readCount++,s.readCount===s.size)t=s.map,i.release(s);else{s.key=null,s.type=Oi;continue e}}return t}}readHeadByte(){return this.headByte===yi&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=yi}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new Ye(`Unrecognized array type byte: ${Rn(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new Ye(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new Ye(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,t){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,t):this.decodeBinary(e,t)}decodeUtf8String(e,t){if(e>this.maxStrLength)throw new Ye(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+t+e)throw Kc;const i=this.pos+t;let s;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?s=this.keyDecoder.decode(this.bytes,i,e):s=fb(this.bytes,i,e),this.pos+=t+e,s}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===Oi:!1}decodeBinary(e,t){if(e>this.maxBinLength)throw new Ye(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+t))throw Kc;const i=this.pos+t,s=this.bytes.subarray(i,i+e);return this.pos+=t+e,s}decodeExtension(e,t){if(e>this.maxExtLength)throw new Ye(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const i=this.view.getInt8(this.pos+t),s=this.decodeBinary(e,t+1);return this.extensionCodec.decode(s,i,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=pb(this.view,this.pos);return this.pos+=8,e}readI64(){const e=tf(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function kb(r,e){return new Ub(e).decode(r)}function wa(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function of(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?wa(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function Pi(r,e){e||(e=r.reduce((s,n)=>s+n.length,0));const t=of(e);let i=0;for(const s of r)t.set(s,i),i+=s.length;return wa(t)}function jb(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),h=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,y=0,x=0,S=d.length;x!==S&&d[x]===0;)x++,g++;for(var E=(S-x)*u+1>>>0,I=new Uint8Array(E);x!==S;){for(var _=d[x],m=0,O=E-1;(_!==0||m<y)&&O!==-1;O--,m++)_+=256*I[O]>>>0,I[O]=_%a>>>0,_=_/a>>>0;if(_!==0)throw new Error("Non-zero carry");y=m,x++}for(var D=E-y;D!==E&&I[D]===0;)D++;for(var b=c.repeat(g);D<E;++D)b+=r.charAt(I[D]);return b}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var y=0,x=0;d[g]===c;)y++,g++;for(var S=(d.length-g)*h+1>>>0,E=new Uint8Array(S);d[g];){var I=t[d.charCodeAt(g)];if(I===255)return;for(var _=0,m=S-1;(I!==0||_<x)&&m!==-1;m--,_++)I+=a*E[m]>>>0,E[m]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");x=_,g++}if(d[g]!==" "){for(var O=S-x;O!==S&&E[O]===0;)O++;for(var D=new Uint8Array(y+(S-O)),b=y;O!==S;)D[b++]=E[O++];return D}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:f,decode:p}}var Fb=jb,Lb=Fb;const Mb=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},qb=r=>new TextEncoder().encode(r),zb=r=>new TextDecoder().decode(r);class Hb{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Vb{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return af(this,e)}}class Kb{constructor(e){this.decoders=e}or(e){return af(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const af=(r,e)=>new Kb({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class Wb{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new Hb(e,t,i),this.decoder=new Vb(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Js=({name:r,prefix:e,encode:t,decode:i})=>new Wb(r,e,t,i),Zi=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=Lb(t,e);return Js({prefix:r,name:e,encode:i,decode:n=>Mb(s(n))})},Gb=(r,e,t,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=r.length;for(;r[n-1]==="=";)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,h=0;for(let u=0;u<n;++u){const l=s[r[u]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<t|l,a+=t,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Yb=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,n+=e[s&a>>o];if(o&&(n+=e[s&a<<t-o]),i)for(;n.length*t&7;)n+="=";return n},$e=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>Js({prefix:e,name:r,encode(s){return Yb(s,i,t)},decode(s){return Gb(s,i,t,r)}}),Jb=Js({prefix:"\0",name:"identity",encode:r=>zb(r),decode:r=>qb(r)}),Zb=Object.freeze(Object.defineProperty({__proto__:null,identity:Jb},Symbol.toStringTag,{value:"Module"})),Xb=$e({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Qb=Object.freeze(Object.defineProperty({__proto__:null,base2:Xb},Symbol.toStringTag,{value:"Module"})),e1=$e({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),t1=Object.freeze(Object.defineProperty({__proto__:null,base8:e1},Symbol.toStringTag,{value:"Module"})),r1=Zi({prefix:"9",name:"base10",alphabet:"0123456789"}),i1=Object.freeze(Object.defineProperty({__proto__:null,base10:r1},Symbol.toStringTag,{value:"Module"})),s1=$e({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),n1=$e({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),o1=Object.freeze(Object.defineProperty({__proto__:null,base16:s1,base16upper:n1},Symbol.toStringTag,{value:"Module"})),a1=$e({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),c1=$e({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),h1=$e({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),u1=$e({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),l1=$e({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),f1=$e({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),d1=$e({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),p1=$e({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),g1=$e({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),y1=Object.freeze(Object.defineProperty({__proto__:null,base32:a1,base32hex:l1,base32hexpad:d1,base32hexpadupper:p1,base32hexupper:f1,base32pad:h1,base32padupper:u1,base32upper:c1,base32z:g1},Symbol.toStringTag,{value:"Module"})),w1=Zi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),m1=Zi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),b1=Object.freeze(Object.defineProperty({__proto__:null,base36:w1,base36upper:m1},Symbol.toStringTag,{value:"Module"})),v1=Zi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),E1=Zi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),_1=Object.freeze(Object.defineProperty({__proto__:null,base58btc:v1,base58flickr:E1},Symbol.toStringTag,{value:"Module"})),x1=$e({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),I1=$e({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),S1=$e({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),D1=$e({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),$1=Object.freeze(Object.defineProperty({__proto__:null,base64:x1,base64pad:I1,base64url:S1,base64urlpad:D1},Symbol.toStringTag,{value:"Module"})),cf=Array.from(""),O1=cf.reduce((r,e,t)=>(r[t]=e,r),[]),P1=cf.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function A1(r){return r.reduce((e,t)=>(e+=O1[t],e),"")}function C1(r){const e=[];for(const t of r){const i=P1[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const T1=Js({prefix:"",name:"base256emoji",encode:A1,decode:C1}),R1=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:T1},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Wc={...Zb,...Qb,...t1,...i1,...o1,...y1,...b1,..._1,...$1,...R1};function hf(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Gc=hf("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Bn=hf("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=of(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),uf={utf8:Gc,"utf-8":Gc,hex:Wc.base16,latin1:Bn,ascii:Bn,binary:Bn,...Wc};function nt(r,e="utf8"){const t=uf[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?wa(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function Ve(r,e="utf8"){const t=uf[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}const B1={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var Nn,Yc;function lf(){if(Yc)return Nn;Yc=1;const r="Input must be an string, Buffer or Uint8Array";function e(o){let a;if(o instanceof Uint8Array)a=o;else if(typeof o=="string")a=new TextEncoder().encode(o);else throw new Error(r);return a}function t(o){return Array.prototype.map.call(o,function(a){return(a<16?"0":"")+a.toString(16)}).join("")}function i(o){return(4294967296+o).toString(16).substring(1)}function s(o,a,c){let h=`
`+o+" = ";for(let u=0;u<a.length;u+=2){if(c===32)h+=i(a[u]).toUpperCase(),h+=" ",h+=i(a[u+1]).toUpperCase();else if(c===64)h+=i(a[u+1]).toUpperCase(),h+=i(a[u]).toUpperCase();else throw new Error("Invalid size "+c);u%6===4?h+=`
`+new Array(o.length+4).join(" "):u<a.length-2&&(h+=" ")}console.log(h)}function n(o,a,c){let h=new Date().getTime();const u=new Uint8Array(a);for(let f=0;f<a;f++)u[f]=f%256;const l=new Date().getTime();console.log("Generated random input in "+(l-h)+"ms"),h=l;for(let f=0;f<c;f++){const p=o(u),d=new Date().getTime(),g=d-h;h=d,console.log("Hashed in "+g+"ms: "+p.substring(0,20)+"..."),console.log(Math.round(a/(1<<20)/(g/1e3)*100)/100+" MB PER SECOND")}}return Nn={normalizeInput:e,toHex:t,debugPrint:s,testSpeed:n},Nn}var Un,Jc;function N1(){if(Jc)return Un;Jc=1;const r=lf();function e(x,S,E){const I=x[S]+x[E];let _=x[S+1]+x[E+1];I>=4294967296&&_++,x[S]=I,x[S+1]=_}function t(x,S,E,I){let _=x[S]+E;E<0&&(_+=4294967296);let m=x[S+1]+I;_>=4294967296&&m++,x[S]=_,x[S+1]=m}function i(x,S){return x[S]^x[S+1]<<8^x[S+2]<<16^x[S+3]<<24}function s(x,S,E,I,_,m){const O=h[_],D=h[_+1],b=h[m],$=h[m+1];e(c,x,S),t(c,x,O,D);let P=c[I]^c[x],C=c[I+1]^c[x+1];c[I]=C,c[I+1]=P,e(c,E,I),P=c[S]^c[E],C=c[S+1]^c[E+1],c[S]=P>>>24^C<<8,c[S+1]=C>>>24^P<<8,e(c,x,S),t(c,x,b,$),P=c[I]^c[x],C=c[I+1]^c[x+1],c[I]=P>>>16^C<<16,c[I+1]=C>>>16^P<<16,e(c,E,I),P=c[S]^c[E],C=c[S+1]^c[E+1],c[S]=C>>>31^P<<1,c[S+1]=P>>>31^C<<1}const n=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],a=new Uint8Array(o.map(function(x){return x*2})),c=new Uint32Array(32),h=new Uint32Array(32);function u(x,S){let E=0;for(E=0;E<16;E++)c[E]=x.h[E],c[E+16]=n[E];for(c[24]=c[24]^x.t,c[25]=c[25]^x.t/4294967296,S&&(c[28]=~c[28],c[29]=~c[29]),E=0;E<32;E++)h[E]=i(x.b,4*E);for(E=0;E<12;E++)s(0,8,16,24,a[E*16+0],a[E*16+1]),s(2,10,18,26,a[E*16+2],a[E*16+3]),s(4,12,20,28,a[E*16+4],a[E*16+5]),s(6,14,22,30,a[E*16+6],a[E*16+7]),s(0,10,20,30,a[E*16+8],a[E*16+9]),s(2,12,22,24,a[E*16+10],a[E*16+11]),s(4,14,16,26,a[E*16+12],a[E*16+13]),s(6,8,18,28,a[E*16+14],a[E*16+15]);for(E=0;E<16;E++)x.h[E]=x.h[E]^c[E]^c[E+16]}const l=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function f(x,S,E,I){if(x===0||x>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(S&&S.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(E&&E.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(I&&I.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const _={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:x};l.fill(0),l[0]=x,S&&(l[1]=S.length),l[2]=1,l[3]=1,E&&l.set(E,32),I&&l.set(I,48);for(let m=0;m<16;m++)_.h[m]=n[m]^i(l,m*4);return S&&(p(_,S),_.c=128),_}function p(x,S){for(let E=0;E<S.length;E++)x.c===128&&(x.t+=x.c,u(x,!1),x.c=0),x.b[x.c++]=S[E]}function d(x){for(x.t+=x.c;x.c<128;)x.b[x.c++]=0;u(x,!0);const S=new Uint8Array(x.outlen);for(let E=0;E<x.outlen;E++)S[E]=x.h[E>>2]>>8*(E&3);return S}function g(x,S,E,I,_){E=E||64,x=r.normalizeInput(x),I&&(I=r.normalizeInput(I)),_&&(_=r.normalizeInput(_));const m=f(E,S,I,_);return p(m,x),d(m)}function y(x,S,E,I,_){const m=g(x,S,E,I,_);return r.toHex(m)}return Un={blake2b:g,blake2bHex:y,blake2bInit:f,blake2bUpdate:p,blake2bFinal:d},Un}var kn,Zc;function U1(){if(Zc)return kn;Zc=1;const r=lf();function e(d,g){return d[g]^d[g+1]<<8^d[g+2]<<16^d[g+3]<<24}function t(d,g,y,x,S,E){o[d]=o[d]+o[g]+S,o[x]=i(o[x]^o[d],16),o[y]=o[y]+o[x],o[g]=i(o[g]^o[y],12),o[d]=o[d]+o[g]+E,o[x]=i(o[x]^o[d],8),o[y]=o[y]+o[x],o[g]=i(o[g]^o[y],7)}function i(d,g){return d>>>g^d<<32-g}const s=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),n=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),o=new Uint32Array(16),a=new Uint32Array(16);function c(d,g){let y=0;for(y=0;y<8;y++)o[y]=d.h[y],o[y+8]=s[y];for(o[12]^=d.t,o[13]^=d.t/4294967296,g&&(o[14]=~o[14]),y=0;y<16;y++)a[y]=e(d.b,4*y);for(y=0;y<10;y++)t(0,4,8,12,a[n[y*16+0]],a[n[y*16+1]]),t(1,5,9,13,a[n[y*16+2]],a[n[y*16+3]]),t(2,6,10,14,a[n[y*16+4]],a[n[y*16+5]]),t(3,7,11,15,a[n[y*16+6]],a[n[y*16+7]]),t(0,5,10,15,a[n[y*16+8]],a[n[y*16+9]]),t(1,6,11,12,a[n[y*16+10]],a[n[y*16+11]]),t(2,7,8,13,a[n[y*16+12]],a[n[y*16+13]]),t(3,4,9,14,a[n[y*16+14]],a[n[y*16+15]]);for(y=0;y<8;y++)d.h[y]^=o[y]^o[y+8]}function h(d,g){if(!(d>0&&d<=32))throw new Error("Incorrect output length, should be in [1, 32]");const y=g?g.length:0;if(g&&!(y>0&&y<=32))throw new Error("Incorrect key length, should be in [1, 32]");const x={h:new Uint32Array(s),b:new Uint8Array(64),c:0,t:0,outlen:d};return x.h[0]^=16842752^y<<8^d,y>0&&(u(x,g),x.c=64),x}function u(d,g){for(let y=0;y<g.length;y++)d.c===64&&(d.t+=d.c,c(d,!1),d.c=0),d.b[d.c++]=g[y]}function l(d){for(d.t+=d.c;d.c<64;)d.b[d.c++]=0;c(d,!0);const g=new Uint8Array(d.outlen);for(let y=0;y<d.outlen;y++)g[y]=d.h[y>>2]>>8*(y&3)&255;return g}function f(d,g,y){y=y||32,d=r.normalizeInput(d);const x=h(y,g);return u(x,d),l(x)}function p(d,g,y){const x=f(d,g,y);return r.toHex(x)}return kn={blake2s:f,blake2sHex:p,blake2sInit:h,blake2sUpdate:u,blake2sFinal:l},kn}var jn,Xc;function k1(){if(Xc)return jn;Xc=1;const r=N1(),e=U1();return jn={blake2b:r.blake2b,blake2bHex:r.blake2bHex,blake2bInit:r.blake2bInit,blake2bUpdate:r.blake2bUpdate,blake2bFinal:r.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal},jn}var j1=k1(),F1={};const L1=":";function nr(r){const[e,t]=r.split(L1);return{namespace:e,reference:t}}function ff(r,e){return r.includes(":")?[r]:e.chains||[]}var M1=Object.defineProperty,q1=Object.defineProperties,z1=Object.getOwnPropertyDescriptors,Qc=Object.getOwnPropertySymbols,H1=Object.prototype.hasOwnProperty,V1=Object.prototype.propertyIsEnumerable,Do=(r,e,t)=>e in r?M1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,eh=(r,e)=>{for(var t in e||(e={}))H1.call(e,t)&&Do(r,t,e[t]);if(Qc)for(var t of Qc(e))V1.call(e,t)&&Do(r,t,e[t]);return r},K1=(r,e)=>q1(r,z1(e)),th=(r,e,t)=>Do(r,typeof e!="symbol"?e+"":e,t);const W1="ReactNative",Je={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},G1="js";function Fs(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function cr(){return!zt.getDocument()&&!!zt.getNavigator()&&navigator.product===W1}function Y1(){return cr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function J1(){return cr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function oi(){return!Fs()&&!!zt.getNavigator()&&!!zt.getDocument()}function Xi(){return cr()?Je.reactNative:Fs()?Je.node:oi()?Je.browser:Je.unknown}function rh(){var r;try{return cr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(r=global.Application)==null?void 0:r.applicationId:void 0}catch{return}}function Z1(r,e){const t=new URLSearchParams(r);for(const i of Object.keys(e).sort())if(e.hasOwnProperty(i)){const s=e[i];s!==void 0&&t.set(i,s)}return t.toString()}function X1(r){var e,t;const i=df();try{return r!=null&&r.url&&i.url&&new URL(r.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${r.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),r.url=i.url),(e=r?.icons)!=null&&e.length&&r.icons.length>0&&(r.icons=r.icons.filter(s=>s!=="")),K1(eh(eh({},i),r),{url:r?.url||i.url,name:r?.name||i.name,description:r?.description||i.description,icons:(t=r?.icons)!=null&&t.length&&r.icons.length>0?r.icons:i.icons})}catch(s){return console.warn("Error populating app metadata",s),r||i}}function df(){return um.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Q1(){if(Xi()===Je.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:t,Version:i}=global.Platform;return[t,i].join("-")}const r=im();if(r===null)return"unknown";const e=r.os?r.os.replace(" ","").toLowerCase():"unknown";return r.type==="browser"?[e,r.name,r.version].join("-"):[e,r.version].join("-")}function ev(){var r;const e=Xi();return e===Je.browser?[e,((r=zt.getLocation())==null?void 0:r.host)||"unknown"].join(":"):e}function pf(r,e,t){const i=Q1(),s=ev();return[[r,e].join("-"),[G1,t].join("-"),i,s].join("/")}function tv({protocol:r,version:e,relayUrl:t,sdkVersion:i,auth:s,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){const h=t.split("?"),u=pf(r,e,i),l={auth:s,ua:u,projectId:n,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},f=Z1(h[1]||"",l);return h[0]+"?"+f}function mr(r,e){return r.filter(t=>e.includes(t)).length===r.length}function $o(r){return Object.fromEntries(r.entries())}function Oo(r){return new Map(Object.entries(r))}function pr(r=L.FIVE_MINUTES,e){const t=L.toMiliseconds(r||L.FIVE_MINUTES);let i,s,n,o;return{resolve:a=>{n&&i&&(clearTimeout(n),i(a),o=Promise.resolve(a))},reject:a=>{n&&s&&(clearTimeout(n),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const h=new Error(e);o=Promise.reject(h),c(h)},t),i=a,s=c})}}function $t(r,e,t){return new Promise(async(i,s)=>{const n=setTimeout(()=>s(new Error(t)),e);try{const o=await r;i(o)}catch(o){s(o)}clearTimeout(n)})}function gf(r,e){if(typeof e=="string"&&e.startsWith(`${r}:`))return e;if(r.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(r.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${r}`)}function rv(r){return gf("topic",r)}function iv(r){return gf("id",r)}function yf(r){const[e,t]=r.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")i.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))i.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return i}function de(r,e){return L.fromMiliseconds(Date.now()+L.toMiliseconds(r))}function Dt(r){return Date.now()>=L.toMiliseconds(r)}function re(r,e){return`${r}${e?`:${e}`:""}`}function Ot(r=[],e=[]){return[...new Set([...r,...e])]}async function sv({id:r,topic:e,wcDeepLink:t}){var i;try{if(!t)return;const s=typeof t=="string"?JSON.parse(t):t,n=s?.href;if(typeof n!="string")return;const o=nv(n,r,e),a=Xi();if(a===Je.browser){if(!((i=zt.getDocument())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}ov(o)}else a===Je.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(s){console.error(s)}}function nv(r,e,t){const i=`requestId=${e}&sessionTopic=${t}`;r.endsWith("/")&&(r=r.slice(0,-1));let s=`${r}`;if(r.startsWith("https://t.me")){const n=r.includes("?")?"&startapp=":"?startapp=";s=`${s}${n}${uv(i,!0)}`}else s=`${s}/wc?${i}`;return s}function ov(r){let e="_self";hv()?e="_top":(cv()||r.startsWith("https://")||r.startsWith("http://"))&&(e="_blank"),window.open(r,e,"noreferrer noopener")}async function av(r,e){let t="";try{if(oi()&&(t=localStorage.getItem(e),t))return t;t=await r.getItem(e)}catch(i){console.error(i)}return t}function ih(r,e){if(!r.includes(e))return null;const t=r.split(/([&,?,=])/),i=t.indexOf(e);return t[i+2]}function sh(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}function ma(){return typeof process<"u"&&F1.IS_VITEST==="true"}function cv(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function hv(){try{return window.self!==window.top}catch{return!1}}function uv(r,e=!1){const t=Buffer.from(r).toString("base64");return e?t.replace(/[=]/g,""):t}function wf(r){return Buffer.from(r,"base64").toString("utf-8")}function lv(r){return new Promise(e=>setTimeout(e,r))}let fv=class{constructor({limit:e}){th(this,"limit"),th(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const t=this.set.values().next().value;t&&this.set.delete(t)}this.set.add(e)}}has(e){return this.set.has(e)}};const fs=BigInt(2**32-1),nh=BigInt(32);function mf(r,e=!1){return e?{h:Number(r&fs),l:Number(r>>nh&fs)}:{h:Number(r>>nh&fs)|0,l:Number(r&fs)|0}}function bf(r,e=!1){const t=r.length;let i=new Uint32Array(t),s=new Uint32Array(t);for(let n=0;n<t;n++){const{h:o,l:a}=mf(r[n],e);[i[n],s[n]]=[o,a]}return[i,s]}const oh=(r,e,t)=>r>>>t,ah=(r,e,t)=>r<<32-t|e>>>t,er=(r,e,t)=>r>>>t|e<<32-t,tr=(r,e,t)=>r<<32-t|e>>>t,Si=(r,e,t)=>r<<64-t|e>>>t-32,Di=(r,e,t)=>r>>>t-32|e<<64-t,dv=(r,e)=>e,pv=(r,e)=>r,gv=(r,e,t)=>r<<t|e>>>32-t,yv=(r,e,t)=>e<<t|r>>>32-t,wv=(r,e,t)=>e<<t-32|r>>>64-t,mv=(r,e,t)=>r<<t-32|e>>>64-t;function pt(r,e,t,i){const s=(e>>>0)+(i>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}const ba=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),va=(r,e,t,i)=>e+t+i+(r/2**32|0)|0,bv=(r,e,t,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0),vv=(r,e,t,i,s)=>e+t+i+s+(r/2**32|0)|0,Ev=(r,e,t,i,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0)+(s>>>0),_v=(r,e,t,i,s,n)=>e+t+i+s+n+(r/2**32|0)|0,Nr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Ea(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Ht(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function ot(r,...e){if(!Ea(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function _a(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Ht(r.outputLen),Ht(r.blockLen)}function ar(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function xa(r,e){ot(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Li(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function at(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function Fn(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function bt(r,e){return r<<32-e|r>>>e}const vf=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Ef(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}const kt=vf?r=>r:r=>Ef(r);function xv(r){for(let e=0;e<r.length;e++)r[e]=Ef(r[e]);return r}const rr=vf?r=>r:xv,_f=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Iv=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Mi(r){if(ot(r),_f)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=Iv[r[t]];return e}const Bt={_0:48,_9:57,A:65,F:70,a:97,f:102};function ch(r){if(r>=Bt._0&&r<=Bt._9)return r-Bt._0;if(r>=Bt.A&&r<=Bt.F)return r-(Bt.A-10);if(r>=Bt.a&&r<=Bt.f)return r-(Bt.a-10)}function Ia(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(_f)return Uint8Array.fromHex(r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(t);for(let s=0,n=0;s<t;s++,n+=2){const o=ch(r.charCodeAt(n)),a=ch(r.charCodeAt(n+1));if(o===void 0||a===void 0){const c=r[n]+r[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function Sv(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function yt(r){return typeof r=="string"&&(r=Sv(r)),ot(r),r}function br(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];ot(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const n=r[i];t.set(n,s),s+=n.length}return t}let Zs=class{};function Qi(r){const e=i=>r().update(yt(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Dv(r){const e=(i,s)=>r(s).update(yt(i)).digest(),t=r({});return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=i=>r(i),e}function ai(r=32){if(Nr&&typeof Nr.getRandomValues=="function")return Nr.getRandomValues(new Uint8Array(r));if(Nr&&typeof Nr.randomBytes=="function")return Uint8Array.from(Nr.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}const $v=BigInt(0),wi=BigInt(1),Ov=BigInt(2),Pv=BigInt(7),Av=BigInt(256),Cv=BigInt(113),xf=[],If=[],Sf=[];for(let r=0,e=wi,t=1,i=0;r<24;r++){[t,i]=[i,(2*t+3*i)%5],xf.push(2*(5*i+t)),If.push((r+1)*(r+2)/2%64);let s=$v;for(let n=0;n<7;n++)e=(e<<wi^(e>>Pv)*Cv)%Av,e&Ov&&(s^=wi<<(wi<<BigInt(n))-wi);Sf.push(s)}const Df=bf(Sf,!0),Tv=Df[0],Rv=Df[1],hh=(r,e,t)=>t>32?wv(r,e,t):gv(r,e,t),uh=(r,e,t)=>t>32?mv(r,e,t):yv(r,e,t);function Bv(r,e=24){const t=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,h=t[c],u=t[c+1],l=hh(h,u,1)^t[a],f=uh(h,u,1)^t[a+1];for(let p=0;p<50;p+=10)r[o+p]^=l,r[o+p+1]^=f}let s=r[2],n=r[3];for(let o=0;o<24;o++){const a=If[o],c=hh(s,n,a),h=uh(s,n,a),u=xf[o];s=r[u],n=r[u+1],r[u]=c,r[u+1]=h}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=Tv[i],r[1]^=Rv[i]}at(t)}let Nv=class $f extends Zs{constructor(e,t,i,s=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=s,this.rounds=n,Ht(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Li(this.state)}clone(){return this._cloneInto()}keccak(){rr(this.state32),Bv(this.state32,this.rounds),rr(this.state32),this.posOut=0,this.pos=0}update(e){ar(this),e=yt(e),ot(e);const{blockLen:t,state:i}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(t-this.pos,s-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:s}=this;e[i]^=t,(t&128)!==0&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){ar(this,!1),ot(e),this.finish();const t=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,n-s);e.set(t.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ht(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(xa(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,at(this.state)}_cloneInto(e){const{blockLen:t,suffix:i,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new $f(t,i,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const Uv=(r,e,t)=>Qi(()=>new Nv(e,r,t)),kv=Uv(1,136,256/8);function jv(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(t>>s&n),a=Number(t&n),c=i?4:0,h=i?0:4;r.setUint32(e+c,o,i),r.setUint32(e+h,a,i)}function Fv(r,e,t){return r&e^~r&t}function Lv(r,e,t){return r&e^r&t^e&t}let Of=class extends Zs{constructor(e,t,i,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=s,this.buffer=new Uint8Array(e),this.view=Fn(this.buffer)}update(e){ar(this),e=yt(e),ot(e);const{view:t,buffer:i,blockLen:s}=this,n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=Fn(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ar(this),xa(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;t[o++]=128,at(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(i,0),o=0);for(let l=o;l<s;l++)t[l]=0;jv(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=Fn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=c/4,u=this.get();if(h>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<h;l++)a.setUint32(4*l,u[l],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=n,e.length=s,e.pos=a,s%t&&e.buffer.set(i),e}clone(){return this._cloneInto()}};const Wt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Pe=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Ae=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Mv=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Gt=new Uint32Array(64);let qv=class extends Of{constructor(e=32){super(64,e,8,!1),this.A=Wt[0]|0,this.B=Wt[1]|0,this.C=Wt[2]|0,this.D=Wt[3]|0,this.E=Wt[4]|0,this.F=Wt[5]|0,this.G=Wt[6]|0,this.H=Wt[7]|0}get(){const{A:e,B:t,C:i,D:s,E:n,F:o,G:a,H:c}=this;return[e,t,i,s,n,o,a,c]}set(e,t,i,s,n,o,a,c){this.A=e|0,this.B=t|0,this.C=i|0,this.D=s|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let l=0;l<16;l++,t+=4)Gt[l]=e.getUint32(t,!1);for(let l=16;l<64;l++){const f=Gt[l-15],p=Gt[l-2],d=bt(f,7)^bt(f,18)^f>>>3,g=bt(p,17)^bt(p,19)^p>>>10;Gt[l]=g+Gt[l-7]+d+Gt[l-16]|0}let{A:i,B:s,C:n,D:o,E:a,F:c,G:h,H:u}=this;for(let l=0;l<64;l++){const f=bt(a,6)^bt(a,11)^bt(a,25),p=u+f+Fv(a,c,h)+Mv[l]+Gt[l]|0,d=(bt(i,2)^bt(i,13)^bt(i,22))+Lv(i,s,n)|0;u=h,h=c,c=a,a=o+p|0,o=n,n=s,s=i,i=p+d|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,h=h+this.G|0,u=u+this.H|0,this.set(i,s,n,o,a,c,h,u)}roundClean(){at(Gt)}destroy(){this.set(0,0,0,0,0,0,0,0),at(this.buffer)}};const Pf=bf(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),zv=Pf[0],Hv=Pf[1],Yt=new Uint32Array(80),Jt=new Uint32Array(80);let Sa=class extends Of{constructor(e=64){super(128,e,16,!1),this.Ah=Ae[0]|0,this.Al=Ae[1]|0,this.Bh=Ae[2]|0,this.Bl=Ae[3]|0,this.Ch=Ae[4]|0,this.Cl=Ae[5]|0,this.Dh=Ae[6]|0,this.Dl=Ae[7]|0,this.Eh=Ae[8]|0,this.El=Ae[9]|0,this.Fh=Ae[10]|0,this.Fl=Ae[11]|0,this.Gh=Ae[12]|0,this.Gl=Ae[13]|0,this.Hh=Ae[14]|0,this.Hl=Ae[15]|0}get(){const{Ah:e,Al:t,Bh:i,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:h,El:u,Fh:l,Fl:f,Gh:p,Gl:d,Hh:g,Hl:y}=this;return[e,t,i,s,n,o,a,c,h,u,l,f,p,d,g,y]}set(e,t,i,s,n,o,a,c,h,u,l,f,p,d,g,y){this.Ah=e|0,this.Al=t|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=h|0,this.El=u|0,this.Fh=l|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=y|0}process(e,t){for(let E=0;E<16;E++,t+=4)Yt[E]=e.getUint32(t),Jt[E]=e.getUint32(t+=4);for(let E=16;E<80;E++){const I=Yt[E-15]|0,_=Jt[E-15]|0,m=er(I,_,1)^er(I,_,8)^oh(I,_,7),O=tr(I,_,1)^tr(I,_,8)^ah(I,_,7),D=Yt[E-2]|0,b=Jt[E-2]|0,$=er(D,b,19)^Si(D,b,61)^oh(D,b,6),P=tr(D,b,19)^Di(D,b,61)^ah(D,b,6),C=bv(O,P,Jt[E-7],Jt[E-16]),U=vv(C,m,$,Yt[E-7],Yt[E-16]);Yt[E]=U|0,Jt[E]=C|0}let{Ah:i,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:h,Dl:u,Eh:l,El:f,Fh:p,Fl:d,Gh:g,Gl:y,Hh:x,Hl:S}=this;for(let E=0;E<80;E++){const I=er(l,f,14)^er(l,f,18)^Si(l,f,41),_=tr(l,f,14)^tr(l,f,18)^Di(l,f,41),m=l&p^~l&g,O=f&d^~f&y,D=Ev(S,_,O,Hv[E],Jt[E]),b=_v(D,x,I,m,zv[E],Yt[E]),$=D|0,P=er(i,s,28)^Si(i,s,34)^Si(i,s,39),C=tr(i,s,28)^Di(i,s,34)^Di(i,s,39),U=i&n^i&a^n&a,N=s&o^s&c^o&c;x=g|0,S=y|0,g=p|0,y=d|0,p=l|0,d=f|0,{h:l,l:f}=pt(h|0,u|0,b|0,$|0),h=a|0,u=c|0,a=n|0,c=o|0,n=i|0,o=s|0;const w=ba($,C,N);i=va(w,b,P,U),s=w|0}({h:i,l:s}=pt(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:o}=pt(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=pt(this.Ch|0,this.Cl|0,a|0,c|0),{h,l:u}=pt(this.Dh|0,this.Dl|0,h|0,u|0),{h:l,l:f}=pt(this.Eh|0,this.El|0,l|0,f|0),{h:p,l:d}=pt(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:y}=pt(this.Gh|0,this.Gl|0,g|0,y|0),{h:x,l:S}=pt(this.Hh|0,this.Hl|0,x|0,S|0),this.set(i,s,n,o,a,c,h,u,l,f,p,d,g,y,x,S)}roundClean(){at(Yt,Jt)}destroy(){at(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Vv=class extends Sa{constructor(){super(48),this.Ah=Pe[0]|0,this.Al=Pe[1]|0,this.Bh=Pe[2]|0,this.Bl=Pe[3]|0,this.Ch=Pe[4]|0,this.Cl=Pe[5]|0,this.Dh=Pe[6]|0,this.Dl=Pe[7]|0,this.Eh=Pe[8]|0,this.El=Pe[9]|0,this.Fh=Pe[10]|0,this.Fl=Pe[11]|0,this.Gh=Pe[12]|0,this.Gl=Pe[13]|0,this.Hh=Pe[14]|0,this.Hl=Pe[15]|0}};const Ce=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class Kv extends Sa{constructor(){super(32),this.Ah=Ce[0]|0,this.Al=Ce[1]|0,this.Bh=Ce[2]|0,this.Bl=Ce[3]|0,this.Ch=Ce[4]|0,this.Cl=Ce[5]|0,this.Dh=Ce[6]|0,this.Dl=Ce[7]|0,this.Eh=Ce[8]|0,this.El=Ce[9]|0,this.Fh=Ce[10]|0,this.Fl=Ce[11]|0,this.Gh=Ce[12]|0,this.Gl=Ce[13]|0,this.Hh=Ce[14]|0,this.Hl=Ce[15]|0}}const Xs=Qi(()=>new qv),Wv=Qi(()=>new Sa),Gv=Qi(()=>new Vv),Yv=Qi(()=>new Kv),Jv=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),ge=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),z=new Uint32Array(32);function Zt(r,e,t,i,s,n){const o=s[n],a=s[n+1];let c=z[2*r],h=z[2*r+1],u=z[2*e],l=z[2*e+1],f=z[2*t],p=z[2*t+1],d=z[2*i],g=z[2*i+1],y=ba(c,u,o);h=va(y,h,l,a),c=y|0,{Dh:g,Dl:d}={Dh:g^h,Dl:d^c},{Dh:g,Dl:d}={Dh:dv(g,d),Dl:pv(g)},{h:p,l:f}=pt(p,f,g,d),{Bh:l,Bl:u}={Bh:l^p,Bl:u^f},{Bh:l,Bl:u}={Bh:er(l,u,24),Bl:tr(l,u,24)},z[2*r]=c,z[2*r+1]=h,z[2*e]=u,z[2*e+1]=l,z[2*t]=f,z[2*t+1]=p,z[2*i]=d,z[2*i+1]=g}function Xt(r,e,t,i,s,n){const o=s[n],a=s[n+1];let c=z[2*r],h=z[2*r+1],u=z[2*e],l=z[2*e+1],f=z[2*t],p=z[2*t+1],d=z[2*i],g=z[2*i+1],y=ba(c,u,o);h=va(y,h,l,a),c=y|0,{Dh:g,Dl:d}={Dh:g^h,Dl:d^c},{Dh:g,Dl:d}={Dh:er(g,d,16),Dl:tr(g,d,16)},{h:p,l:f}=pt(p,f,g,d),{Bh:l,Bl:u}={Bh:l^p,Bl:u^f},{Bh:l,Bl:u}={Bh:Si(l,u,63),Bl:Di(l,u,63)},z[2*r]=c,z[2*r+1]=h,z[2*e]=u,z[2*e+1]=l,z[2*t]=f,z[2*t+1]=p,z[2*i]=d,z[2*i+1]=g}function Zv(r,e={},t,i,s){if(Ht(t),r<0||r>t)throw new Error("outputLen bigger than keyLen");const{key:n,salt:o,personalization:a}=e;if(n!==void 0&&(n.length<1||n.length>t))throw new Error("key length must be undefined or 1.."+t);if(o!==void 0&&o.length!==i)throw new Error("salt must be undefined or "+i);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}class Xv extends Zs{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Ht(e),Ht(t),this.blockLen=e,this.outputLen=t,this.buffer=new Uint8Array(e),this.buffer32=Li(this.buffer)}update(e){ar(this),e=yt(e),ot(e);const{blockLen:t,buffer:i,buffer32:s}=this,n=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<n;){this.pos===t&&(rr(s),this.compress(s,0,!1),rr(s),this.pos=0);const h=Math.min(t-this.pos,n-c),u=o+c;if(h===t&&!(u%4)&&c+h<n){const l=new Uint32Array(a,u,Math.floor((n-c)/4));rr(l);for(let f=0;c+t<n;f+=s.length,c+=t)this.length+=t,this.compress(l,f,!1);rr(l);continue}i.set(e.subarray(c,c+h),this.pos),this.pos+=h,this.length+=h,c+=h}return this}digestInto(e){ar(this),xa(e,this);const{pos:t,buffer32:i}=this;this.finished=!0,at(this.buffer.subarray(t)),rr(i),this.compress(i,0,!0),rr(i);const s=Li(e);this.get().forEach((n,o)=>s[o]=kt(n))}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){const{buffer:t,length:i,finished:s,destroyed:n,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(t),e.destroyed=n,e.finished=s,e.length=i,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class Qv extends Xv{constructor(e={}){const t=e.dkLen===void 0?64:e.dkLen;super(128,t),this.v0l=ge[0]|0,this.v0h=ge[1]|0,this.v1l=ge[2]|0,this.v1h=ge[3]|0,this.v2l=ge[4]|0,this.v2h=ge[5]|0,this.v3l=ge[6]|0,this.v3h=ge[7]|0,this.v4l=ge[8]|0,this.v4h=ge[9]|0,this.v5l=ge[10]|0,this.v5h=ge[11]|0,this.v6l=ge[12]|0,this.v6h=ge[13]|0,this.v7l=ge[14]|0,this.v7h=ge[15]|0,Zv(t,e,64,16,16);let{key:i,personalization:s,salt:n}=e,o=0;if(i!==void 0&&(i=yt(i),o=i.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,n!==void 0){n=yt(n);const a=Li(n);this.v4l^=kt(a[0]),this.v4h^=kt(a[1]),this.v5l^=kt(a[2]),this.v5h^=kt(a[3])}if(s!==void 0){s=yt(s);const a=Li(s);this.v6l^=kt(a[0]),this.v6h^=kt(a[1]),this.v7l^=kt(a[2]),this.v7h^=kt(a[3])}if(i!==void 0){const a=new Uint8Array(this.blockLen);a.set(i),this.update(a)}}get(){let{v0l:e,v0h:t,v1l:i,v1h:s,v2l:n,v2h:o,v3l:a,v3h:c,v4l:h,v4h:u,v5l:l,v5h:f,v6l:p,v6h:d,v7l:g,v7h:y}=this;return[e,t,i,s,n,o,a,c,h,u,l,f,p,d,g,y]}set(e,t,i,s,n,o,a,c,h,u,l,f,p,d,g,y){this.v0l=e|0,this.v0h=t|0,this.v1l=i|0,this.v1h=s|0,this.v2l=n|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=h|0,this.v4h=u|0,this.v5l=l|0,this.v5h=f|0,this.v6l=p|0,this.v6h=d|0,this.v7l=g|0,this.v7h=y|0}compress(e,t,i){this.get().forEach((c,h)=>z[h]=c),z.set(ge,16);let{h:s,l:n}=mf(BigInt(this.length));z[24]=ge[8]^n,z[25]=ge[9]^s,i&&(z[28]=~z[28],z[29]=~z[29]);let o=0;const a=Jv;for(let c=0;c<12;c++)Zt(0,4,8,12,e,t+2*a[o++]),Xt(0,4,8,12,e,t+2*a[o++]),Zt(1,5,9,13,e,t+2*a[o++]),Xt(1,5,9,13,e,t+2*a[o++]),Zt(2,6,10,14,e,t+2*a[o++]),Xt(2,6,10,14,e,t+2*a[o++]),Zt(3,7,11,15,e,t+2*a[o++]),Xt(3,7,11,15,e,t+2*a[o++]),Zt(0,5,10,15,e,t+2*a[o++]),Xt(0,5,10,15,e,t+2*a[o++]),Zt(1,6,11,12,e,t+2*a[o++]),Xt(1,6,11,12,e,t+2*a[o++]),Zt(2,7,8,13,e,t+2*a[o++]),Xt(2,7,8,13,e,t+2*a[o++]),Zt(3,4,9,14,e,t+2*a[o++]),Xt(3,4,9,14,e,t+2*a[o++]);this.v0l^=z[0]^z[16],this.v0h^=z[1]^z[17],this.v1l^=z[2]^z[18],this.v1h^=z[3]^z[19],this.v2l^=z[4]^z[20],this.v2h^=z[5]^z[21],this.v3l^=z[6]^z[22],this.v3h^=z[7]^z[23],this.v4l^=z[8]^z[24],this.v4h^=z[9]^z[25],this.v5l^=z[10]^z[26],this.v5h^=z[11]^z[27],this.v6l^=z[12]^z[28],this.v6h^=z[13]^z[29],this.v7l^=z[14]^z[30],this.v7h^=z[15]^z[31],at(z)}destroy(){this.destroyed=!0,at(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const e2=Dv(r=>new Qv(r)),t2="https://rpc.walletconnect.org/v1";function Af(r){const e=`Ethereum Signed Message:
${r.length}`,t=new TextEncoder().encode(e+r);return"0x"+Buffer.from(kv(t)).toString("hex")}async function r2(r,e,t,i,s,n){switch(t.t){case"eip191":return await i2(r,e,t.s);case"eip1271":return await s2(r,e,t.s,i,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}async function i2(r,e,t){return(await Qm({hash:Af(e),signature:t})).toLowerCase()===r.toLowerCase()}async function s2(r,e,t,i,s,n){const o=nr(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",h=t.substring(2),u=(h.length/2).toString(16).padStart(64,"0"),l=(e.startsWith("0x")?e:Af(e)).substring(2),f=a+l+c+u+h,p=await fetch(`${n||t2}/?chainId=${i}&projectId=${s}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:n2(),jsonrpc:"2.0",method:"eth_call",params:[{to:r,data:f},"latest"]})}),{result:d}=await p.json();return d?d.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function n2(){return Date.now()+Math.floor(Math.random()*1e3)}function o2(r){const e=atob(r),t=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o);const i=t[0];if(i===0)throw new Error("No signatures found");const s=1+i*64;if(t.length<s)throw new Error("Transaction data too short for claimed signature count");if(t.length<100)throw new Error("Transaction too short");const n=Buffer.from(r,"base64").slice(1,65);return Ji.encode(n)}function a2(r){const e=new Uint8Array(Buffer.from(r,"base64")),t=Array.from("TransactionData::").map(n=>n.charCodeAt(0)),i=new Uint8Array(t.length+e.length);i.set(t),i.set(e,t.length);const s=e2(i,{dkLen:32});return Ji.encode(s)}function lh(r){const e=new Uint8Array(Xs(c2(r)));return Ji.encode(e)}function c2(r){if(r instanceof Uint8Array)return r;if(Array.isArray(r))return new Uint8Array(r);if(typeof r=="object"&&r!=null&&r.data)return new Uint8Array(Object.values(r.data));if(typeof r=="object"&&r)return new Uint8Array(Object.values(r));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function fh(r){const e=Buffer.from(r,"base64"),t=kb(e).txn;if(!t)throw new Error("Invalid signed transaction: missing 'txn' field");const i=Ob(t),s=Buffer.from("TX"),n=Buffer.concat([s,Buffer.from(i)]),o=Yv(n);return ap.encode(o).replace(/=+$/,"")}function Ln(r){const e=[];let t=BigInt(r);for(;t>=BigInt(128);)e.push(Number(t&BigInt(127)|BigInt(128))),t>>=BigInt(7);return e.push(Number(t)),Buffer.from(e)}function h2(r){const e=Buffer.from(r.signed.bodyBytes,"base64"),t=Buffer.from(r.signed.authInfoBytes,"base64"),i=Buffer.from(r.signature.signature,"base64"),s=[];s.push(Buffer.from([10])),s.push(Ln(e.length)),s.push(e),s.push(Buffer.from([18])),s.push(Ln(t.length)),s.push(t),s.push(Buffer.from([26])),s.push(Ln(i.length)),s.push(i);const n=Buffer.concat(s),o=Xs(n);return Buffer.from(o).toString("hex").toUpperCase()}var u2=Object.defineProperty,l2=Object.defineProperties,f2=Object.getOwnPropertyDescriptors,dh=Object.getOwnPropertySymbols,d2=Object.prototype.hasOwnProperty,p2=Object.prototype.propertyIsEnumerable,ph=(r,e,t)=>e in r?u2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,g2=(r,e)=>{for(var t in e||(e={}))d2.call(e,t)&&ph(r,t,e[t]);if(dh)for(var t of dh(e))p2.call(e,t)&&ph(r,t,e[t]);return r},y2=(r,e)=>l2(r,f2(e));const w2="did:pkh:",Da=r=>r?.split(":"),m2=r=>{const e=r&&Da(r);if(e)return r.includes(w2)?e[3]:e[1]},Po=r=>{const e=r&&Da(r);if(e)return e[2]+":"+e[3]},Ls=r=>{const e=r&&Da(r);if(e)return e.pop()};async function gh(r){const{cacao:e,projectId:t}=r,{s:i,p:s}=e,n=Cf(s,s.iss),o=Ls(s.iss);return await r2(o,n,i,Po(s.iss),t)}const Cf=(r,e)=>{const t=`${r.domain} wants you to sign in with your Ethereum account:`,i=Ls(e);if(!r.aud&&!r.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=r.statement||void 0;const n=`URI: ${r.aud||r.uri}`,o=`Version: ${r.version}`,a=`Chain ID: ${m2(e)}`,c=`Nonce: ${r.nonce}`,h=`Issued At: ${r.iat}`,u=r.exp?`Expiration Time: ${r.exp}`:void 0,l=r.nbf?`Not Before: ${r.nbf}`:void 0,f=r.requestId?`Request ID: ${r.requestId}`:void 0,p=r.resources?`Resources:${r.resources.map(g=>`
- ${g}`).join("")}`:void 0,d=Ds(r.resources);if(d){const g=qi(d);s=$2(s,g)}return[t,i,"",s,"",n,o,a,c,h,u,l,f,p].filter(g=>g!=null).join(`
`)};function b2(r){return Buffer.from(JSON.stringify(r)).toString("base64")}function v2(r){return JSON.parse(Buffer.from(r,"base64").toString("utf-8"))}function Ir(r){if(!r)throw new Error("No recap provided, value is undefined");if(!r.att)throw new Error("No `att` property found");const e=Object.keys(r.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(t=>{const i=r.att[t];if(Array.isArray(i))throw new Error(`Resource must be an object: ${t}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(i).forEach(s=>{const n=i[s];if(!Array.isArray(n))throw new Error(`Ability limits ${s} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function E2(r,e,t,i={}){return t?.sort((s,n)=>s.localeCompare(n)),{att:{[r]:_2(e,t,i)}}}function _2(r,e,t={}){e=e?.sort((s,n)=>s.localeCompare(n));const i=e.map(s=>({[`${r}/${s}`]:[t]}));return Object.assign({},...i)}function Tf(r){return Ir(r),`urn:recap:${b2(r).replace(/=/g,"")}`}function qi(r){const e=v2(r.replace("urn:recap:",""));return Ir(e),e}function x2(r,e,t){const i=E2(r,e,t);return Tf(i)}function I2(r){return r&&r.includes("urn:recap:")}function S2(r,e){const t=qi(r),i=qi(e),s=D2(t,i);return Tf(s)}function D2(r,e){Ir(r),Ir(e);const t=Object.keys(r.att).concat(Object.keys(e.att)).sort((s,n)=>s.localeCompare(n)),i={att:{}};return t.forEach(s=>{var n,o;Object.keys(((n=r.att)==null?void 0:n[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,h;i.att[s]=y2(g2({},i.att[s]),{[a]:((c=r.att[s])==null?void 0:c[a])||((h=e.att[s])==null?void 0:h[a])})})}),i}function $2(r="",e){Ir(e);const t="I further authorize the stated URI to perform the following actions on my behalf: ";if(r.includes(t))return r;const i=[];let s=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(l=>({ability:l.split("/")[0],action:l.split("/")[1]}));c.sort((l,f)=>l.action.localeCompare(f.action));const h={};c.forEach(l=>{h[l.ability]||(h[l.ability]=[]),h[l.ability].push(l.action)});const u=Object.keys(h).map(l=>(s++,`(${s}) '${l}': '${h[l].join("', '")}' for '${a}'.`));i.push(u.join(", ").replace(".,","."))});const n=i.join(" "),o=`${t}${n}`;return`${r?r+" ":""}${o}`}function yh(r){var e;const t=qi(r);Ir(t);const i=(e=t.att)==null?void 0:e.eip155;return i?Object.keys(i).map(s=>s.split("/")[1]):[]}function wh(r){const e=qi(r);Ir(e);const t=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(s=>{var n;(n=s?.[0])!=null&&n.chains&&t.push(s[0].chains)})}),[...new Set(t.flat())]}function Ds(r){if(!r)return;const e=r?.[r.length-1];return I2(e)?e:void 0}function Rf(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Ao(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function Mn(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function qe(r,...e){if(!Rf(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function mh(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function O2(r,e){qe(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function or(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function ti(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function P2(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}const A2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function C2(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function Co(r){if(typeof r=="string")r=C2(r);else if(Rf(r))r=To(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function T2(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function R2(r,e){if(r.length!==e.length)return!1;let t=0;for(let i=0;i<r.length;i++)t|=r[i]^e[i];return t===0}const B2=(r,e)=>{function t(i,...s){if(qe(i),!A2)throw new Error("Non little-endian hardware is not yet supported");if(r.nonceLength!==void 0){const h=s[0];if(!h)throw new Error("nonce / iv required");r.varSizeNonce?qe(h):qe(h,r.nonceLength)}const n=r.tagLength;n&&s[1]!==void 0&&qe(s[1]);const o=e(i,...s),a=(h,u)=>{if(u!==void 0){if(h!==2)throw new Error("cipher output not supported");qe(u)}};let c=!1;return{encrypt(h,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,qe(h),a(o.encrypt.length,u),o.encrypt(h,u)},decrypt(h,u){if(qe(h),n&&h.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,u),o.decrypt(h,u)}}}return Object.assign(t,r),t};function bh(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!U2(e))throw new Error("invalid output, must be aligned");return e}function vh(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(t>>s&n),a=Number(t&n);r.setUint32(e+4,o,i),r.setUint32(e+0,a,i)}function N2(r,e,t){Ao(t);const i=new Uint8Array(16),s=P2(i);return vh(s,0,BigInt(e),t),vh(s,8,BigInt(r),t),i}function U2(r){return r.byteOffset%4===0}function To(r){return Uint8Array.from(r)}const Bf=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),k2=Bf("expand 16-byte k"),j2=Bf("expand 32-byte k"),F2=or(k2),L2=or(j2);function Z(r,e){return r<<e|r>>>32-e}function Ro(r){return r.byteOffset%4===0}const ds=64,M2=16,Nf=2**32-1,Eh=new Uint32Array;function q2(r,e,t,i,s,n,o,a){const c=s.length,h=new Uint8Array(ds),u=or(h),l=Ro(s)&&Ro(n),f=l?or(s):Eh,p=l?or(n):Eh;for(let d=0;d<c;o++){if(r(e,t,i,u,o,a),o>=Nf)throw new Error("arx: counter overflow");const g=Math.min(ds,c-d);if(l&&g===ds){const y=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let x=0,S;x<M2;x++)S=y+x,p[S]=f[S]^u[x];d+=ds;continue}for(let y=0,x;y<g;y++)x=d+y,n[x]=s[x]^h[y];d+=g}}function z2(r,e){const{allowShortKeys:t,extendNonceFn:i,counterLength:s,counterRight:n,rounds:o}=T2({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return Mn(s),Mn(o),Ao(n),Ao(t),(a,c,h,u,l=0)=>{qe(a),qe(c),qe(h);const f=h.length;if(u===void 0&&(u=new Uint8Array(f)),qe(u),Mn(l),l<0||l>=Nf)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const p=[];let d=a.length,g,y;if(d===32)p.push(g=To(a)),y=L2;else if(d===16&&t)g=new Uint8Array(32),g.set(a),g.set(a,16),y=F2,p.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);Ro(c)||p.push(c=To(c));const x=or(g);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(y,x,or(c.subarray(0,16)),x),c=c.subarray(16)}const S=16-s;if(S!==c.length)throw new Error(`arx: nonce must be ${S} or 16 bytes`);if(S!==12){const I=new Uint8Array(12);I.set(c,n?0:12-c.length),c=I,p.push(c)}const E=or(c);return q2(r,y,x,E,h,u,l,o),ti(...p),u}}const _e=(r,e)=>r[e++]&255|(r[e++]&255)<<8;class H2{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Co(e),qe(e,32);const t=_e(e,0),i=_e(e,2),s=_e(e,4),n=_e(e,6),o=_e(e,8),a=_e(e,10),c=_e(e,12),h=_e(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|i<<3)&8191,this.r[2]=(i>>>10|s<<6)&7939,this.r[3]=(s>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|h<<8)&8191,this.r[9]=h>>>5&127;for(let u=0;u<8;u++)this.pad[u]=_e(e,16+2*u)}process(e,t,i=!1){const s=i?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],h=o[2],u=o[3],l=o[4],f=o[5],p=o[6],d=o[7],g=o[8],y=o[9],x=_e(e,t+0),S=_e(e,t+2),E=_e(e,t+4),I=_e(e,t+6),_=_e(e,t+8),m=_e(e,t+10),O=_e(e,t+12),D=_e(e,t+14);let b=n[0]+(x&8191),$=n[1]+((x>>>13|S<<3)&8191),P=n[2]+((S>>>10|E<<6)&8191),C=n[3]+((E>>>7|I<<9)&8191),U=n[4]+((I>>>4|_<<12)&8191),N=n[5]+(_>>>1&8191),w=n[6]+((_>>>14|m<<2)&8191),v=n[7]+((m>>>11|O<<5)&8191),A=n[8]+((O>>>8|D<<8)&8191),B=n[9]+(D>>>5|s),T=0,R=T+b*a+$*(5*y)+P*(5*g)+C*(5*d)+U*(5*p);T=R>>>13,R&=8191,R+=N*(5*f)+w*(5*l)+v*(5*u)+A*(5*h)+B*(5*c),T+=R>>>13,R&=8191;let k=T+b*c+$*a+P*(5*y)+C*(5*g)+U*(5*d);T=k>>>13,k&=8191,k+=N*(5*p)+w*(5*f)+v*(5*l)+A*(5*u)+B*(5*h),T+=k>>>13,k&=8191;let q=T+b*h+$*c+P*a+C*(5*y)+U*(5*g);T=q>>>13,q&=8191,q+=N*(5*d)+w*(5*p)+v*(5*f)+A*(5*l)+B*(5*u),T+=q>>>13,q&=8191;let H=T+b*u+$*h+P*c+C*a+U*(5*y);T=H>>>13,H&=8191,H+=N*(5*g)+w*(5*d)+v*(5*p)+A*(5*f)+B*(5*l),T+=H>>>13,H&=8191;let M=T+b*l+$*u+P*h+C*c+U*a;T=M>>>13,M&=8191,M+=N*(5*y)+w*(5*g)+v*(5*d)+A*(5*p)+B*(5*f),T+=M>>>13,M&=8191;let V=T+b*f+$*l+P*u+C*h+U*c;T=V>>>13,V&=8191,V+=N*a+w*(5*y)+v*(5*g)+A*(5*d)+B*(5*p),T+=V>>>13,V&=8191;let K=T+b*p+$*f+P*l+C*u+U*h;T=K>>>13,K&=8191,K+=N*c+w*a+v*(5*y)+A*(5*g)+B*(5*d),T+=K>>>13,K&=8191;let te=T+b*d+$*p+P*f+C*l+U*u;T=te>>>13,te&=8191,te+=N*h+w*c+v*a+A*(5*y)+B*(5*g),T+=te>>>13,te&=8191;let ee=T+b*g+$*d+P*p+C*f+U*l;T=ee>>>13,ee&=8191,ee+=N*u+w*h+v*c+A*a+B*(5*y),T+=ee>>>13,ee&=8191;let G=T+b*y+$*g+P*d+C*p+U*f;T=G>>>13,G&=8191,G+=N*l+w*u+v*h+A*c+B*a,T+=G>>>13,G&=8191,T=(T<<2)+T|0,T=T+R|0,R=T&8191,T=T>>>13,k+=T,n[0]=R,n[1]=k,n[2]=q,n[3]=H,n[4]=M,n[5]=V,n[6]=K,n[7]=te,n[8]=ee,n[9]=G}finalize(){const{h:e,pad:t}=this,i=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,i[0]=e[0]+5,s=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+s,s=i[a]>>>13,i[a]&=8191;i[9]-=8192;let n=(s^1)-1;for(let a=0;a<10;a++)i[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;ti(i)}update(e){mh(this),e=Co(e),qe(e);const{buffer:t,blockLen:i}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(i-this.pos,s-n);if(o===i){for(;i<=s-n;n+=i)this.process(e,n);continue}t.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===i&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){ti(this.h,this.r,this.buffer,this.pad)}digestInto(e){mh(this),O2(e,this),this.finished=!0;const{buffer:t,h:i}=this;let{pos:s}=this;if(s){for(t[s++]=1;s<16;s++)t[s]=0;this.process(t,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=i[o]>>>0,e[n++]=i[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}}function V2(r){const e=(i,s)=>r(s).update(Co(i)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=i=>r(i),e}const K2=V2(r=>new H2(r));function W2(r,e,t,i,s,n=20){let o=r[0],a=r[1],c=r[2],h=r[3],u=e[0],l=e[1],f=e[2],p=e[3],d=e[4],g=e[5],y=e[6],x=e[7],S=s,E=t[0],I=t[1],_=t[2],m=o,O=a,D=c,b=h,$=u,P=l,C=f,U=p,N=d,w=g,v=y,A=x,B=S,T=E,R=I,k=_;for(let H=0;H<n;H+=2)m=m+$|0,B=Z(B^m,16),N=N+B|0,$=Z($^N,12),m=m+$|0,B=Z(B^m,8),N=N+B|0,$=Z($^N,7),O=O+P|0,T=Z(T^O,16),w=w+T|0,P=Z(P^w,12),O=O+P|0,T=Z(T^O,8),w=w+T|0,P=Z(P^w,7),D=D+C|0,R=Z(R^D,16),v=v+R|0,C=Z(C^v,12),D=D+C|0,R=Z(R^D,8),v=v+R|0,C=Z(C^v,7),b=b+U|0,k=Z(k^b,16),A=A+k|0,U=Z(U^A,12),b=b+U|0,k=Z(k^b,8),A=A+k|0,U=Z(U^A,7),m=m+P|0,k=Z(k^m,16),v=v+k|0,P=Z(P^v,12),m=m+P|0,k=Z(k^m,8),v=v+k|0,P=Z(P^v,7),O=O+C|0,B=Z(B^O,16),A=A+B|0,C=Z(C^A,12),O=O+C|0,B=Z(B^O,8),A=A+B|0,C=Z(C^A,7),D=D+U|0,T=Z(T^D,16),N=N+T|0,U=Z(U^N,12),D=D+U|0,T=Z(T^D,8),N=N+T|0,U=Z(U^N,7),b=b+$|0,R=Z(R^b,16),w=w+R|0,$=Z($^w,12),b=b+$|0,R=Z(R^b,8),w=w+R|0,$=Z($^w,7);let q=0;i[q++]=o+m|0,i[q++]=a+O|0,i[q++]=c+D|0,i[q++]=h+b|0,i[q++]=u+$|0,i[q++]=l+P|0,i[q++]=f+C|0,i[q++]=p+U|0,i[q++]=d+N|0,i[q++]=g+w|0,i[q++]=y+v|0,i[q++]=x+A|0,i[q++]=S+B|0,i[q++]=E+T|0,i[q++]=I+R|0,i[q++]=_+k|0}const G2=z2(W2,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Y2=new Uint8Array(16),_h=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(Y2.subarray(t))},J2=new Uint8Array(32);function xh(r,e,t,i,s){const n=r(e,t,J2),o=K2.create(n);s&&_h(o,s),_h(o,i);const a=N2(i.length,s?s.length:0,!0);o.update(a);const c=o.digest();return ti(n,a),c}const Z2=r=>(e,t,i)=>({encrypt(s,n){const o=s.length;n=bh(o+16,n,!1),n.set(s);const a=n.subarray(0,-16);r(e,t,a,a,1);const c=xh(r,e,t,a,i);return n.set(c,o),ti(c),n},decrypt(s,n){n=bh(s.length-16,n,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=xh(r,e,t,o,i);if(!R2(a,c))throw new Error("invalid tag");return n.set(s.subarray(0,-16)),r(e,t,n,n,1),ti(c),n}}),Uf=B2({blockSize:64,nonceLength:12,tagLength:16},Z2(G2));let kf=class extends Zs{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,_a(e);const i=yt(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),at(n)}update(e){return ar(this),this.iHash.update(e),this}digestInto(e){ar(this),ot(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:i,finished:s,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Qs=(r,e,t)=>new kf(r,e).update(t).digest();Qs.create=(r,e)=>new kf(r,e);function X2(r,e,t){return _a(r),t===void 0&&(t=new Uint8Array(r.outputLen)),Qs(r,yt(t),yt(e))}const qn=Uint8Array.from([0]),Ih=Uint8Array.of();function Q2(r,e,t,i=32){_a(r),Ht(i);const s=r.outputLen;if(i>255*s)throw new Error("Length should be <= 255*HashLen");const n=Math.ceil(i/s);t===void 0&&(t=Ih);const o=new Uint8Array(n*s),a=Qs.create(r,e),c=a._cloneInto(),h=new Uint8Array(a.outputLen);for(let u=0;u<n;u++)qn[0]=u+1,c.update(u===0?Ih:h).update(t).update(qn).digestInto(h),o.set(h,s*u),a._cloneInto(c);return a.destroy(),c.destroy(),at(h,qn),o.slice(0,i)}const eE=(r,e,t,i,s)=>Q2(r,X2(r,e,t),i,s),en=Xs,$a=BigInt(0),Bo=BigInt(1);function Ms(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}function ps(r){const e=r.toString(16);return e.length&1?"0"+e:e}function jf(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?$a:BigInt("0x"+r)}function tn(r){return jf(Mi(r))}function qs(r){return ot(r),jf(Mi(Uint8Array.from(r).reverse()))}function Oa(r,e){return Ia(r.toString(16).padStart(e*2,"0"))}function Pa(r,e){return Oa(r,e).reverse()}function Me(r,e,t){let i;if(typeof e=="string")try{i=Ia(e)}catch(n){throw new Error(r+" must be hex string or Uint8Array, cause: "+n)}else if(Ea(e))i=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const s=i.length;if(typeof t=="number"&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return i}const zn=r=>typeof r=="bigint"&&$a<=r;function tE(r,e,t){return zn(r)&&zn(e)&&zn(t)&&e<=r&&r<t}function No(r,e,t,i){if(!tE(e,t,i))throw new Error("expected valid "+r+": "+t+" <= n < "+i+", got "+e)}function rE(r){let e;for(e=0;r>$a;r>>=Bo,e+=1);return e}const rn=r=>(Bo<<BigInt(r))-Bo;function iE(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");const i=f=>new Uint8Array(f),s=f=>Uint8Array.of(f);let n=i(r),o=i(r),a=0;const c=()=>{n.fill(1),o.fill(0),a=0},h=(...f)=>t(o,n,...f),u=(f=i(0))=>{o=h(s(0),f),n=h(),f.length!==0&&(o=h(s(1),f),n=h())},l=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const p=[];for(;f<e;){n=h();const d=n.slice();p.push(d),f+=n.length}return br(...p)};return(f,p)=>{c(),u(f);let d;for(;!(d=p(l()));)u();return c(),d}}function sn(r,e,t={}){if(!r||typeof r!="object")throw new Error("expected valid options object");function i(s,n,o){const a=r[s];if(o&&a===void 0)return;const c=typeof a;if(c!==n||a===null)throw new Error(`param "${s}" is invalid: expected ${n}, got ${c}`)}Object.entries(e).forEach(([s,n])=>i(s,n,!1)),Object.entries(t).forEach(([s,n])=>i(s,n,!0))}function Sh(r){const e=new WeakMap;return(t,...i)=>{const s=e.get(t);if(s!==void 0)return s;const n=r(t,...i);return e.set(t,n),n}}const He=BigInt(0),Be=BigInt(1),vr=BigInt(2),sE=BigInt(3),Ff=BigInt(4),Lf=BigInt(5),Mf=BigInt(8);function st(r,e){const t=r%e;return t>=He?t:e+t}function dt(r,e,t){let i=r;for(;e-- >He;)i*=i,i%=t;return i}function Dh(r,e){if(r===He)throw new Error("invert: expected non-zero number");if(e<=He)throw new Error("invert: expected positive modulus, got "+e);let t=st(r,e),i=e,s=He,n=Be;for(;t!==He;){const o=i/t,a=i%t,c=s-n*o;i=t,t=a,s=n,n=c}if(i!==Be)throw new Error("invert: does not exist");return st(s,e)}function qf(r,e){const t=(r.ORDER+Be)/Ff,i=r.pow(e,t);if(!r.eql(r.sqr(i),e))throw new Error("Cannot find square root");return i}function nE(r,e){const t=(r.ORDER-Lf)/Mf,i=r.mul(e,vr),s=r.pow(i,t),n=r.mul(e,s),o=r.mul(r.mul(n,vr),s),a=r.mul(n,r.sub(o,r.ONE));if(!r.eql(r.sqr(a),e))throw new Error("Cannot find square root");return a}function oE(r){if(r<BigInt(3))throw new Error("sqrt is not defined for small field");let e=r-Be,t=0;for(;e%vr===He;)e/=vr,t++;let i=vr;const s=ci(r);for(;$h(s,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return qf;let n=s.pow(i,e);const o=(e+Be)/vr;return function(a,c){if(a.is0(c))return c;if($h(a,c)!==1)throw new Error("Cannot find square root");let h=t,u=a.mul(a.ONE,n),l=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(l,a.ONE);){if(a.is0(l))return a.ZERO;let p=1,d=a.sqr(l);for(;!a.eql(d,a.ONE);)if(p++,d=a.sqr(d),p===h)throw new Error("Cannot find square root");const g=Be<<BigInt(h-p-1),y=a.pow(u,g);h=p,u=a.sqr(y),l=a.mul(l,u),f=a.mul(f,y)}return f}}function aE(r){return r%Ff===sE?qf:r%Mf===Lf?nE:oE(r)}const cE=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function hE(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},t=cE.reduce((i,s)=>(i[s]="function",i),e);return sn(r,t),r}function uE(r,e,t){if(t<He)throw new Error("invalid exponent, negatives unsupported");if(t===He)return r.ONE;if(t===Be)return e;let i=r.ONE,s=e;for(;t>He;)t&Be&&(i=r.mul(i,s)),s=r.sqr(s),t>>=Be;return i}function zf(r,e,t=!1){const i=new Array(e.length).fill(t?r.ZERO:void 0),s=e.reduce((o,a,c)=>r.is0(a)?o:(i[c]=o,r.mul(o,a)),r.ONE),n=r.inv(s);return e.reduceRight((o,a,c)=>r.is0(a)?o:(i[c]=r.mul(o,i[c]),r.mul(o,a)),n),i}function $h(r,e){const t=(r.ORDER-Be)/vr,i=r.pow(e,t),s=r.eql(i,r.ONE),n=r.eql(i,r.ZERO),o=r.eql(i,r.neg(r.ONE));if(!s&&!n&&!o)throw new Error("invalid Legendre symbol result");return s?1:n?0:-1}function lE(r,e){e!==void 0&&Ht(e);const t=e!==void 0?e:r.toString(2).length,i=Math.ceil(t/8);return{nBitLength:t,nByteLength:i}}function ci(r,e,t=!1,i={}){if(r<=He)throw new Error("invalid field: expected ORDER > 0, got "+r);let s,n;if(typeof e=="object"&&e!=null){if(i.sqrt||t)throw new Error("cannot specify opts in two arguments");const u=e;u.BITS&&(s=u.BITS),u.sqrt&&(n=u.sqrt),typeof u.isLE=="boolean"&&(t=u.isLE)}else typeof e=="number"&&(s=e),i.sqrt&&(n=i.sqrt);const{nBitLength:o,nByteLength:a}=lE(r,s);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c;const h=Object.freeze({ORDER:r,isLE:t,BITS:o,BYTES:a,MASK:rn(o),ZERO:He,ONE:Be,create:u=>st(u,r),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return He<=u&&u<r},is0:u=>u===He,isValidNot0:u=>!h.is0(u)&&h.isValid(u),isOdd:u=>(u&Be)===Be,neg:u=>st(-u,r),eql:(u,l)=>u===l,sqr:u=>st(u*u,r),add:(u,l)=>st(u+l,r),sub:(u,l)=>st(u-l,r),mul:(u,l)=>st(u*l,r),pow:(u,l)=>uE(h,u,l),div:(u,l)=>st(u*Dh(l,r),r),sqrN:u=>u*u,addN:(u,l)=>u+l,subN:(u,l)=>u-l,mulN:(u,l)=>u*l,inv:u=>Dh(u,r),sqrt:n||(u=>(c||(c=aE(r)),c(h,u))),toBytes:u=>t?Pa(u,a):Oa(u,a),fromBytes:u=>{if(u.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+u.length);return t?qs(u):tn(u)},invertBatch:u=>zf(h,u),cmov:(u,l,f)=>f?l:u});return Object.freeze(h)}function Hf(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function Vf(r){const e=Hf(r);return e+Math.ceil(e/2)}function fE(r,e,t=!1){const i=r.length,s=Hf(e),n=Vf(e);if(i<16||i<n||i>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+i);const o=t?qs(r):tn(r),a=st(o,e-Be)+Be;return t?Pa(a,s):Oa(a,s)}const ri=BigInt(0),Er=BigInt(1);function Ai(r,e){const t=e.negate();return r?t:e}function dE(r,e,t){const i=n=>n.pz,s=zf(r.Fp,t.map(i));return t.map((n,o)=>n.toAffine(s[o])).map(r.fromAffine)}function Kf(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Hn(r,e){Kf(r,e);const t=Math.ceil(e/r)+1,i=2**(r-1),s=2**r,n=rn(r),o=BigInt(r);return{windows:t,windowSize:i,mask:n,maxNumber:s,shiftBy:o}}function Oh(r,e,t){const{windowSize:i,mask:s,maxNumber:n,shiftBy:o}=t;let a=Number(r&s),c=r>>o;a>i&&(a-=n,c+=Er);const h=e*i,u=h+Math.abs(a)-1,l=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:l,isNeg:f,isNegF:p,offsetF:h}}function pE(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,i)=>{if(!(t instanceof e))throw new Error("invalid point at index "+i)})}function gE(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,i)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+i)})}const Vn=new WeakMap,Wf=new WeakMap;function Kn(r){return Wf.get(r)||1}function Ph(r){if(r!==ri)throw new Error("invalid wNAF")}function yE(r,e){return{constTimeNegate:Ai,hasPrecomputes(t){return Kn(t)!==1},unsafeLadder(t,i,s=r.ZERO){let n=t;for(;i>ri;)i&Er&&(s=s.add(n)),n=n.double(),i>>=Er;return s},precomputeWindow(t,i){const{windows:s,windowSize:n}=Hn(i,e),o=[];let a=t,c=a;for(let h=0;h<s;h++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,i,s){let n=r.ZERO,o=r.BASE;const a=Hn(t,e);for(let c=0;c<a.windows;c++){const{nextN:h,offset:u,isZero:l,isNeg:f,isNegF:p,offsetF:d}=Oh(s,c,a);s=h,l?o=o.add(Ai(p,i[d])):n=n.add(Ai(f,i[u]))}return Ph(s),{p:n,f:o}},wNAFUnsafe(t,i,s,n=r.ZERO){const o=Hn(t,e);for(let a=0;a<o.windows&&s!==ri;a++){const{nextN:c,offset:h,isZero:u,isNeg:l}=Oh(s,a,o);if(s=c,!u){const f=i[h];n=n.add(l?f.negate():f)}}return Ph(s),n},getPrecomputes(t,i,s){let n=Vn.get(i);return n||(n=this.precomputeWindow(i,t),t!==1&&(typeof s=="function"&&(n=s(n)),Vn.set(i,n))),n},wNAFCached(t,i,s){const n=Kn(t);return this.wNAF(n,this.getPrecomputes(n,t,s),i)},wNAFCachedUnsafe(t,i,s,n){const o=Kn(t);return o===1?this.unsafeLadder(t,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,t,s),i,n)},setWindowSize(t,i){Kf(i,e),Wf.set(t,i),Vn.delete(t)}}}function wE(r,e,t,i){let s=e,n=r.ZERO,o=r.ZERO;for(;t>ri||i>ri;)t&Er&&(n=n.add(s)),i&Er&&(o=o.add(s)),s=s.double(),t>>=Er,i>>=Er;return{p1:n,p2:o}}function mE(r,e,t,i){pE(t,r),gE(i,e);const s=t.length,n=i.length;if(s!==n)throw new Error("arrays of points and scalars must have equal length");const o=r.ZERO,a=rE(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const h=rn(c),u=new Array(Number(h)+1).fill(o),l=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=l;p>=0;p-=c){u.fill(o);for(let g=0;g<n;g++){const y=i[g],x=Number(y>>BigInt(p)&h);u[x]=u[x].add(t[g])}let d=o;for(let g=u.length-1,y=o;g>0;g--)y=y.add(u[g]),d=d.add(y);if(f=f.add(d),p!==0)for(let g=0;g<c;g++)f=f.double()}return f}function Ah(r,e){if(e){if(e.ORDER!==r)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return hE(e),e}else return ci(r)}function bE(r,e,t={}){if(!e||typeof e!="object")throw new Error(`expected valid ${r} CURVE object`);for(const o of["p","n","h"]){const a=e[o];if(!(typeof a=="bigint"&&a>ri))throw new Error(`CURVE.${o} must be positive bigint`)}const i=Ah(e.p,t.Fp),s=Ah(e.n,t.Fn),n=["Gx","Gy","a","b"];for(const o of n)if(!i.isValid(e[o]))throw new Error(`CURVE.${o} must be valid field element of CURVE.Fp`);return{Fp:i,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const mi=BigInt(0),Ur=BigInt(1),gs=BigInt(2);function vE(r){return sn(r,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...r})}function EE(r){const e=vE(r),{P:t,type:i,adjustScalarBytes:s,powPminus2:n,randomBytes:o}=e,a=i==="x25519";if(!a&&i!=="x448")throw new Error("invalid type");const c=o||ai,h=a?255:448,u=a?32:56,l=BigInt(a?9:5),f=BigInt(a?121665:39081),p=a?gs**BigInt(254):gs**BigInt(447),d=a?BigInt(8)*gs**BigInt(251)-Ur:BigInt(4)*gs**BigInt(445)-Ur,g=p+d+Ur,y=b=>st(b,t),x=S(l);function S(b){return Pa(y(b),u)}function E(b){const $=Me("u coordinate",b,u);return a&&($[31]&=127),y(qs($))}function I(b){return qs(s(Me("scalar",b,u)))}function _(b,$){const P=D(E($),I(b));if(P===mi)throw new Error("invalid private or public key received");return S(P)}function m(b){return _(b,x)}function O(b,$,P){const C=y(b*($-P));return $=y($-C),P=y(P+C),{x_2:$,x_3:P}}function D(b,$){No("u",b,mi,t),No("scalar",$,p,g);const P=$,C=b;let U=Ur,N=mi,w=b,v=Ur,A=mi;for(let T=BigInt(h-1);T>=mi;T--){const R=P>>T&Ur;A^=R,{x_2:U,x_3:w}=O(A,U,w),{x_2:N,x_3:v}=O(A,N,v),A=R;const k=U+N,q=y(k*k),H=U-N,M=y(H*H),V=q-M,K=w+v,te=w-v,ee=y(te*k),G=y(K*H),he=ee+G,Ee=ee-G;w=y(he*he),v=y(C*y(Ee*Ee)),U=y(q*M),N=y(V*(q+y(f*V)))}({x_2:U,x_3:w}=O(A,U,w)),{x_2:N,x_3:v}=O(A,N,v);const B=n(N);return y(U*B)}return{scalarMult:_,scalarMultBase:m,getSharedSecret:(b,$)=>_(b,$),getPublicKey:b=>m(b),utils:{randomPrivateKey:()=>c(u)},GuBytes:x.slice()}}BigInt(0);const _E=BigInt(1),Ch=BigInt(2),xE=BigInt(3),IE=BigInt(5);BigInt(8);const Gf={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function SE(r){const e=BigInt(10),t=BigInt(20),i=BigInt(40),s=BigInt(80),n=Gf.p,o=r*r%n*r%n,a=dt(o,Ch,n)*o%n,c=dt(a,_E,n)*r%n,h=dt(c,IE,n)*c%n,u=dt(h,e,n)*h%n,l=dt(u,t,n)*u%n,f=dt(l,i,n)*l%n,p=dt(f,s,n)*f%n,d=dt(p,s,n)*f%n,g=dt(d,e,n)*h%n;return{pow_p_5_8:dt(g,Ch,n)*r%n,b2:o}}function DE(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}const Uo=(()=>{const r=Gf.p;return EE({P:r,type:"x25519",powPminus2:e=>{const{pow_p_5_8:t,b2:i}=SE(e);return st(dt(t,xE,r)*i,r)},adjustScalarBytes:DE})})();function Th(r){r.lowS!==void 0&&Ms("lowS",r.lowS),r.prehash!==void 0&&Ms("prehash",r.prehash)}class $E extends Error{constructor(e=""){super(e)}}const Ft={Err:$E,_tlv:{encode:(r,e)=>{const{Err:t}=Ft;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const i=e.length/2,s=ps(i);if(s.length/2&128)throw new t("tlv.encode: long form length too big");const n=i>127?ps(s.length/2|128):"";return ps(r)+n+s+e},decode(r,e){const{Err:t}=Ft;let i=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[i++]!==r)throw new t("tlv.decode: wrong tlv");const s=e[i++],n=!!(s&128);let o=0;if(!n)o=s;else{const c=s&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const h=e.subarray(i,i+c);if(h.length!==c)throw new t("tlv.decode: length bytes not complete");if(h[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const u of h)o=o<<8|u;if(i+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(r){const{Err:e}=Ft;if(r<Ci)throw new e("integer: negative integers are not allowed");let t=ps(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=Ft;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return tn(r)}},toSig(r){const{Err:e,_int:t,_tlv:i}=Ft,s=Me("signature",r),{v:n,l:o}=i.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,n),{v:h,l:u}=i.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(h)}},hexFromSig(r){const{_tlv:e,_int:t}=Ft,i=e.encode(2,t.encode(r.r)),s=e.encode(2,t.encode(r.s)),n=i+s;return e.encode(48,n)}},Ci=BigInt(0),Ti=BigInt(1),OE=BigInt(2),ys=BigInt(3),PE=BigInt(4);function AE(r,e,t){function i(s){const n=r.sqr(s),o=r.mul(n,s);return r.add(r.add(o,r.mul(s,e)),t)}return i}function Yf(r,e,t){const{BYTES:i}=r;function s(n){let o;if(typeof n=="bigint")o=n;else{let a=Me("private key",n);if(e){if(!e.includes(a.length*2))throw new Error("invalid private key");const c=new Uint8Array(i);c.set(a,c.length-a.length),a=c}try{o=r.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${i}, got ${typeof n}`)}}if(t&&(o=r.create(o)),!r.isValidNot0(o))throw new Error("invalid private key: out of range [1..N-1]");return o}return s}function CE(r,e={}){const{Fp:t,Fn:i}=bE("weierstrass",r,e),{h:s,n}=r;sn(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:o}=e;if(o&&(!t.is0(r.a)||typeof o.beta!="bigint"||typeof o.splitScalar!="function"))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!t.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function c(D,b,$){const{x:P,y:C}=b.toAffine(),U=t.toBytes(P);if(Ms("isCompressed",$),$){a();const N=!t.isOdd(C);return br(Jf(N),U)}else return br(Uint8Array.of(4),U,t.toBytes(C))}function h(D){ot(D);const b=t.BYTES,$=b+1,P=2*b+1,C=D.length,U=D[0],N=D.subarray(1);if(C===$&&(U===2||U===3)){const w=t.fromBytes(N);if(!t.isValid(w))throw new Error("bad point: is not on curve, wrong x");const v=f(w);let A;try{A=t.sqrt(v)}catch(T){const R=T instanceof Error?": "+T.message:"";throw new Error("bad point: is not on curve, sqrt error"+R)}a();const B=t.isOdd(A);return(U&1)===1!==B&&(A=t.neg(A)),{x:w,y:A}}else if(C===P&&U===4){const w=t.fromBytes(N.subarray(b*0,b*1)),v=t.fromBytes(N.subarray(b*1,b*2));if(!p(w,v))throw new Error("bad point: is not on curve");return{x:w,y:v}}else throw new Error(`bad point: got length ${C}, expected compressed=${$} or uncompressed=${P}`)}const u=e.toBytes||c,l=e.fromBytes||h,f=AE(t,r.a,r.b);function p(D,b){const $=t.sqr(b),P=f(D);return t.eql($,P)}if(!p(r.Gx,r.Gy))throw new Error("bad curve params: generator point");const d=t.mul(t.pow(r.a,ys),PE),g=t.mul(t.sqr(r.b),BigInt(27));if(t.is0(t.add(d,g)))throw new Error("bad curve params: a or b");function y(D,b,$=!1){if(!t.isValid(b)||$&&t.is0(b))throw new Error(`bad point coordinate ${D}`);return b}function x(D){if(!(D instanceof _))throw new Error("ProjectivePoint expected")}const S=Sh((D,b)=>{const{px:$,py:P,pz:C}=D;if(t.eql(C,t.ONE))return{x:$,y:P};const U=D.is0();b==null&&(b=U?t.ONE:t.inv(C));const N=t.mul($,b),w=t.mul(P,b),v=t.mul(C,b);if(U)return{x:t.ZERO,y:t.ZERO};if(!t.eql(v,t.ONE))throw new Error("invZ was invalid");return{x:N,y:w}}),E=Sh(D=>{if(D.is0()){if(e.allowInfinityPoint&&!t.is0(D.py))return;throw new Error("bad point: ZERO")}const{x:b,y:$}=D.toAffine();if(!t.isValid(b)||!t.isValid($))throw new Error("bad point: x or y not field elements");if(!p(b,$))throw new Error("bad point: equation left != right");if(!D.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function I(D,b,$,P,C){return $=new _(t.mul($.px,D),$.py,$.pz),b=Ai(P,b),$=Ai(C,$),b.add($)}class _{constructor(b,$,P){this.px=y("x",b),this.py=y("y",$,!0),this.pz=y("z",P),Object.freeze(this)}static fromAffine(b){const{x:$,y:P}=b||{};if(!b||!t.isValid($)||!t.isValid(P))throw new Error("invalid affine point");if(b instanceof _)throw new Error("projective point not allowed");return t.is0($)&&t.is0(P)?_.ZERO:new _($,P,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(b){return dE(_,"pz",b)}static fromBytes(b){return ot(b),_.fromHex(b)}static fromHex(b){const $=_.fromAffine(l(Me("pointHex",b)));return $.assertValidity(),$}static fromPrivateKey(b){const $=Yf(i,e.allowedPrivateKeyLengths,e.wrapPrivateKey);return _.BASE.multiply($(b))}static msm(b,$){return mE(_,i,b,$)}precompute(b=8,$=!0){return O.setWindowSize(this,b),$||this.multiply(ys),this}_setWindowSize(b){this.precompute(b)}assertValidity(){E(this)}hasEvenY(){const{y:b}=this.toAffine();if(!t.isOdd)throw new Error("Field doesn't support isOdd");return!t.isOdd(b)}equals(b){x(b);const{px:$,py:P,pz:C}=this,{px:U,py:N,pz:w}=b,v=t.eql(t.mul($,w),t.mul(U,C)),A=t.eql(t.mul(P,w),t.mul(N,C));return v&&A}negate(){return new _(this.px,t.neg(this.py),this.pz)}double(){const{a:b,b:$}=r,P=t.mul($,ys),{px:C,py:U,pz:N}=this;let w=t.ZERO,v=t.ZERO,A=t.ZERO,B=t.mul(C,C),T=t.mul(U,U),R=t.mul(N,N),k=t.mul(C,U);return k=t.add(k,k),A=t.mul(C,N),A=t.add(A,A),w=t.mul(b,A),v=t.mul(P,R),v=t.add(w,v),w=t.sub(T,v),v=t.add(T,v),v=t.mul(w,v),w=t.mul(k,w),A=t.mul(P,A),R=t.mul(b,R),k=t.sub(B,R),k=t.mul(b,k),k=t.add(k,A),A=t.add(B,B),B=t.add(A,B),B=t.add(B,R),B=t.mul(B,k),v=t.add(v,B),R=t.mul(U,N),R=t.add(R,R),B=t.mul(R,k),w=t.sub(w,B),A=t.mul(R,T),A=t.add(A,A),A=t.add(A,A),new _(w,v,A)}add(b){x(b);const{px:$,py:P,pz:C}=this,{px:U,py:N,pz:w}=b;let v=t.ZERO,A=t.ZERO,B=t.ZERO;const T=r.a,R=t.mul(r.b,ys);let k=t.mul($,U),q=t.mul(P,N),H=t.mul(C,w),M=t.add($,P),V=t.add(U,N);M=t.mul(M,V),V=t.add(k,q),M=t.sub(M,V),V=t.add($,C);let K=t.add(U,w);return V=t.mul(V,K),K=t.add(k,H),V=t.sub(V,K),K=t.add(P,C),v=t.add(N,w),K=t.mul(K,v),v=t.add(q,H),K=t.sub(K,v),B=t.mul(T,V),v=t.mul(R,H),B=t.add(v,B),v=t.sub(q,B),B=t.add(q,B),A=t.mul(v,B),q=t.add(k,k),q=t.add(q,k),H=t.mul(T,H),V=t.mul(R,V),q=t.add(q,H),H=t.sub(k,H),H=t.mul(T,H),V=t.add(V,H),k=t.mul(q,V),A=t.add(A,k),k=t.mul(K,V),v=t.mul(M,v),v=t.sub(v,k),k=t.mul(M,q),B=t.mul(K,B),B=t.add(B,k),new _(v,A,B)}subtract(b){return this.add(b.negate())}is0(){return this.equals(_.ZERO)}multiply(b){const{endo:$}=e;if(!i.isValidNot0(b))throw new Error("invalid scalar: out of range");let P,C;const U=N=>O.wNAFCached(this,N,_.normalizeZ);if($){const{k1neg:N,k1:w,k2neg:v,k2:A}=$.splitScalar(b),{p:B,f:T}=U(w),{p:R,f:k}=U(A);C=T.add(k),P=I($.beta,B,R,N,v)}else{const{p:N,f:w}=U(b);P=N,C=w}return _.normalizeZ([P,C])[0]}multiplyUnsafe(b){const{endo:$}=e,P=this;if(!i.isValid(b))throw new Error("invalid scalar: out of range");if(b===Ci||P.is0())return _.ZERO;if(b===Ti)return P;if(O.hasPrecomputes(this))return this.multiply(b);if($){const{k1neg:C,k1:U,k2neg:N,k2:w}=$.splitScalar(b),{p1:v,p2:A}=wE(_,P,U,w);return I($.beta,v,A,C,N)}else return O.wNAFCachedUnsafe(P,b)}multiplyAndAddUnsafe(b,$,P){const C=this.multiplyUnsafe($).add(b.multiplyUnsafe(P));return C.is0()?void 0:C}toAffine(b){return S(this,b)}isTorsionFree(){const{isTorsionFree:b}=e;return s===Ti?!0:b?b(_,this):O.wNAFCachedUnsafe(this,n).is0()}clearCofactor(){const{clearCofactor:b}=e;return s===Ti?this:b?b(_,this):this.multiplyUnsafe(s)}toBytes(b=!0){return Ms("isCompressed",b),this.assertValidity(),u(_,this,b)}toRawBytes(b=!0){return this.toBytes(b)}toHex(b=!0){return Mi(this.toBytes(b))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}_.BASE=new _(r.Gx,r.Gy,t.ONE),_.ZERO=new _(t.ZERO,t.ONE,t.ZERO),_.Fp=t,_.Fn=i;const m=i.BITS,O=yE(_,e.endo?Math.ceil(m/2):m);return _}function Jf(r){return Uint8Array.of(r?2:3)}function TE(r,e,t={}){sn(e,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const i=e.randomBytes||ai,s=e.hmac||((P,...C)=>Qs(e.hash,P,br(...C))),{Fp:n,Fn:o}=r,{ORDER:a,BITS:c}=o;function h(P){const C=a>>Ti;return P>C}function u(P){return h(P)?o.neg(P):P}function l(P,C){if(!o.isValidNot0(C))throw new Error(`invalid signature ${P}: out of range 1..CURVE.n`)}class f{constructor(C,U,N){l("r",C),l("s",U),this.r=C,this.s=U,N!=null&&(this.recovery=N),Object.freeze(this)}static fromCompact(C){const U=o.BYTES,N=Me("compactSignature",C,U*2);return new f(o.fromBytes(N.subarray(0,U)),o.fromBytes(N.subarray(U,U*2)))}static fromDER(C){const{r:U,s:N}=Ft.toSig(Me("DER",C));return new f(U,N)}assertValidity(){}addRecoveryBit(C){return new f(this.r,this.s,C)}recoverPublicKey(C){const U=n.ORDER,{r:N,s:w,recovery:v}=this;if(v==null||![0,1,2,3].includes(v))throw new Error("recovery id invalid");if(a*OE<U&&v>1)throw new Error("recovery id is ambiguous for h>1 curve");const A=v===2||v===3?N+a:N;if(!n.isValid(A))throw new Error("recovery id 2 or 3 invalid");const B=n.toBytes(A),T=r.fromHex(br(Jf((v&1)===0),B)),R=o.inv(A),k=E(Me("msgHash",C)),q=o.create(-k*R),H=o.create(w*R),M=r.BASE.multiplyUnsafe(q).add(T.multiplyUnsafe(H));if(M.is0())throw new Error("point at infinify");return M.assertValidity(),M}hasHighS(){return h(this.s)}normalizeS(){return this.hasHighS()?new f(this.r,o.neg(this.s),this.recovery):this}toBytes(C){if(C==="compact")return br(o.toBytes(this.r),o.toBytes(this.s));if(C==="der")return Ia(Ft.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Mi(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Mi(this.toBytes("compact"))}}const p=Yf(o,t.allowedPrivateKeyLengths,t.wrapPrivateKey),d={isValidPrivateKey(P){try{return p(P),!0}catch{return!1}},normPrivateKeyToScalar:p,randomPrivateKey:()=>{const P=a;return fE(i(Vf(P)),P)},precompute(P=8,C=r.BASE){return C.precompute(P,!1)}};function g(P,C=!0){return r.fromPrivateKey(P).toBytes(C)}function y(P){if(typeof P=="bigint")return!1;if(P instanceof r)return!0;const C=Me("key",P).length,U=n.BYTES,N=U+1,w=2*U+1;if(!(t.allowedPrivateKeyLengths||o.BYTES===N))return C===N||C===w}function x(P,C,U=!0){if(y(P)===!0)throw new Error("first arg must be private key");if(y(C)===!1)throw new Error("second arg must be public key");return r.fromHex(C).multiply(p(P)).toBytes(U)}const S=e.bits2int||function(P){if(P.length>8192)throw new Error("input is too large");const C=tn(P),U=P.length*8-c;return U>0?C>>BigInt(U):C},E=e.bits2int_modN||function(P){return o.create(S(P))},I=rn(c);function _(P){return No("num < 2^"+c,P,Ci,I),o.toBytes(P)}function m(P,C,U=O){if(["recovered","canonical"].some(M=>M in U))throw new Error("sign() legacy options not supported");const{hash:N}=e;let{lowS:w,prehash:v,extraEntropy:A}=U;w==null&&(w=!0),P=Me("msgHash",P),Th(U),v&&(P=Me("prehashed msgHash",N(P)));const B=E(P),T=p(C),R=[_(T),_(B)];if(A!=null&&A!==!1){const M=A===!0?i(n.BYTES):A;R.push(Me("extraEntropy",M))}const k=br(...R),q=B;function H(M){const V=S(M);if(!o.isValidNot0(V))return;const K=o.inv(V),te=r.BASE.multiply(V).toAffine(),ee=o.create(te.x);if(ee===Ci)return;const G=o.create(K*o.create(q+ee*T));if(G===Ci)return;let he=(te.x===ee?0:2)|Number(te.y&Ti),Ee=G;return w&&h(G)&&(Ee=u(G),he^=1),new f(ee,Ee,he)}return{seed:k,k2sig:H}}const O={lowS:e.lowS,prehash:!1},D={lowS:e.lowS,prehash:!1};function b(P,C,U=O){const{seed:N,k2sig:w}=m(P,C,U);return iE(e.hash.outputLen,o.BYTES,s)(N,w)}r.BASE.precompute(8);function $(P,C,U,N=D){const w=P;C=Me("msgHash",C),U=Me("publicKey",U),Th(N);const{lowS:v,prehash:A,format:B}=N;if("strict"in N)throw new Error("options.strict was renamed to lowS");if(B!==void 0&&!["compact","der","js"].includes(B))throw new Error('format must be "compact", "der" or "js"');const T=typeof w=="string"||Ea(w),R=!T&&!B&&typeof w=="object"&&w!==null&&typeof w.r=="bigint"&&typeof w.s=="bigint";if(!T&&!R)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let k,q;try{if(R)if(B===void 0||B==="js")k=new f(w.r,w.s);else throw new Error("invalid format");if(T){try{B!=="compact"&&(k=f.fromDER(w))}catch(he){if(!(he instanceof Ft.Err))throw he}!k&&B!=="der"&&(k=f.fromCompact(w))}q=r.fromHex(U)}catch{return!1}if(!k||v&&k.hasHighS())return!1;A&&(C=e.hash(C));const{r:H,s:M}=k,V=E(C),K=o.inv(M),te=o.create(V*K),ee=o.create(H*K),G=r.BASE.multiplyUnsafe(te).add(q.multiplyUnsafe(ee));return G.is0()?!1:o.create(G.x)===H}return Object.freeze({getPublicKey:g,getSharedSecret:x,sign:b,verify:$,utils:d,Point:r,Signature:f})}function RE(r){const e={a:r.a,b:r.b,p:r.Fp.ORDER,n:r.n,h:r.h,Gx:r.Gx,Gy:r.Gy},t=r.Fp,i=ci(e.n,r.nBitLength),s={Fp:t,Fn:i,allowedPrivateKeyLengths:r.allowedPrivateKeyLengths,allowInfinityPoint:r.allowInfinityPoint,endo:r.endo,wrapPrivateKey:r.wrapPrivateKey,isTorsionFree:r.isTorsionFree,clearCofactor:r.clearCofactor,fromBytes:r.fromBytes,toBytes:r.toBytes};return{CURVE:e,curveOpts:s}}function BE(r){const{CURVE:e,curveOpts:t}=RE(r),i={hash:r.hash,hmac:r.hmac,randomBytes:r.randomBytes,lowS:r.lowS,bits2int:r.bits2int,bits2int_modN:r.bits2int_modN};return{CURVE:e,curveOpts:t,ecdsaOpts:i}}function NE(r,e){return Object.assign({},e,{ProjectivePoint:e.Point,CURVE:r})}function UE(r){const{CURVE:e,curveOpts:t,ecdsaOpts:i}=BE(r),s=CE(e,t),n=TE(s,i,t);return NE(r,n)}function ko(r,e){const t=i=>UE({...r,hash:i});return{...t(e),create:t}}const Zf={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Xf={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Qf={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},kE=ci(Zf.p),jE=ci(Xf.p),FE=ci(Qf.p),LE=ko({...Zf,Fp:kE,lowS:!1},Xs);ko({...Xf,Fp:jE,lowS:!1},Gv),ko({...Qf,Fp:FE,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},Wv);const ME=LE,ed="base10",Ne="base16",ze="base64pad",ir="base64url",es="utf8",td=0,Lt=1,ts=2,qE=0,Rh=1,Ri=12,Aa=32;function zE(){const r=Uo.utils.randomPrivateKey(),e=Uo.getPublicKey(r);return{privateKey:Ve(r,Ne),publicKey:Ve(e,Ne)}}function jo(){const r=ai(Aa);return Ve(r,Ne)}function HE(r,e){const t=Uo.getSharedSecret(nt(r,Ne),nt(e,Ne)),i=eE(en,t,void 0,void 0,Aa);return Ve(i,Ne)}function $s(r){const e=en(nt(r,Ne));return Ve(e,Ne)}function rt(r){const e=en(nt(r,es));return Ve(e,Ne)}function rd(r){return nt(`${r}`,ed)}function Sr(r){return Number(Ve(r,ed))}function id(r){return r.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function sd(r){const e=r.replace(/-/g,"+").replace(/_/g,"/"),t=(4-e.length%4)%4;return e+"=".repeat(t)}function VE(r){const e=rd(typeof r.type<"u"?r.type:td);if(Sr(e)===Lt&&typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof r.senderPublicKey<"u"?nt(r.senderPublicKey,Ne):void 0,i=typeof r.iv<"u"?nt(r.iv,Ne):ai(Ri),s=nt(r.symKey,Ne),n=Uf(s,i).encrypt(nt(r.message,es)),o=nd({type:e,sealed:n,iv:i,senderPublicKey:t});return r.encoding===ir?id(o):o}function KE(r){const e=nt(r.symKey,Ne),{sealed:t,iv:i}=zi({encoded:r.encoded,encoding:r.encoding}),s=Uf(e,i).decrypt(t);if(s===null)throw new Error("Failed to decrypt");return Ve(s,es)}function WE(r,e){const t=rd(ts),i=ai(Ri),s=nt(r,es),n=nd({type:t,sealed:s,iv:i});return e===ir?id(n):n}function GE(r,e){const{sealed:t}=zi({encoded:r,encoding:e});return Ve(t,es)}function nd(r){if(Sr(r.type)===ts)return Ve(Pi([r.type,r.sealed]),ze);if(Sr(r.type)===Lt){if(typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Ve(Pi([r.type,r.senderPublicKey,r.iv,r.sealed]),ze)}return Ve(Pi([r.type,r.iv,r.sealed]),ze)}function zi(r){const e=(r.encoding||ze)===ir?sd(r.encoded):r.encoded,t=nt(e,ze),i=t.slice(qE,Rh),s=Rh;if(Sr(i)===Lt){const c=s+Aa,h=c+Ri,u=t.slice(s,c),l=t.slice(c,h),f=t.slice(h);return{type:i,sealed:f,iv:l,senderPublicKey:u}}if(Sr(i)===ts){const c=t.slice(s),h=ai(Ri);return{type:i,sealed:c,iv:h}}const n=s+Ri,o=t.slice(s,n),a=t.slice(n);return{type:i,sealed:a,iv:o}}function YE(r,e){const t=zi({encoded:r,encoding:e?.encoding});return od({type:Sr(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?Ve(t.senderPublicKey,Ne):void 0,receiverPublicKey:e?.receiverPublicKey})}function od(r){const e=r?.type||td;if(e===Lt){if(typeof r?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof r?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:r?.senderPublicKey,receiverPublicKey:r?.receiverPublicKey}}function Bh(r){return r.type===Lt&&typeof r.senderPublicKey=="string"&&typeof r.receiverPublicKey=="string"}function Nh(r){return r.type===ts}function JE(r){const e=Buffer.from(r.x,"base64"),t=Buffer.from(r.y,"base64");return Pi([new Uint8Array([4]),e,t])}function ZE(r,e){const[t,i,s]=r.split("."),n=Buffer.from(sd(s),"base64");if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32),a=n.slice(32,64),c=`${t}.${i}`,h=en(c),u=JE(e);if(!ME.verify(Pi([o,a]),h,u))throw new Error("Invalid signature");return vo(r).payload}const XE="irn";function zs(r){return r?.relay||{protocol:XE}}function Zr(r){const e=B1[r];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${r}`);return e}function QE(r,e="-"){const t={},i="relay"+e;return Object.keys(r).forEach(s=>{if(s.startsWith(i)){const n=s.replace(i,""),o=r[s];t[n]=o}}),t}function Uh(r){if(!r.includes("wc:")){const h=wf(r);h!=null&&h.includes("wc:")&&(r=h)}r=r.includes("wc://")?r.replace("wc://",""):r,r=r.includes("wc:")?r.replace("wc:",""):r;const e=r.indexOf(":"),t=r.indexOf("?")!==-1?r.indexOf("?"):void 0,i=r.substring(0,e),s=r.substring(e+1,t).split("@"),n=typeof t<"u"?r.substring(t):"",o=new URLSearchParams(n),a={};o.forEach((h,u)=>{a[u]=h});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:e_(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:QE(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function e_(r){return r.startsWith("//")?r.substring(2):r}function t_(r,e="-"){const t="relay",i={};return Object.keys(r).forEach(s=>{const n=s,o=t+e+n;r[n]&&(i[o]=r[n])}),i}function kh(r){const e=new URLSearchParams,t=t_(r.relay);Object.keys(t).sort().forEach(s=>{e.set(s,t[s])}),e.set("symKey",r.symKey),r.expiryTimestamp&&e.set("expiryTimestamp",r.expiryTimestamp.toString()),r.methods&&e.set("methods",r.methods.join(","));const i=e.toString();return`${r.protocol}:${r.topic}@${r.version}?${i}`}function ws(r,e,t){return`${r}?wc_ev=${t}&topic=${e}`}var r_=Object.defineProperty,i_=Object.defineProperties,s_=Object.getOwnPropertyDescriptors,jh=Object.getOwnPropertySymbols,n_=Object.prototype.hasOwnProperty,o_=Object.prototype.propertyIsEnumerable,Fh=(r,e,t)=>e in r?r_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,a_=(r,e)=>{for(var t in e||(e={}))n_.call(e,t)&&Fh(r,t,e[t]);if(jh)for(var t of jh(e))o_.call(e,t)&&Fh(r,t,e[t]);return r},c_=(r,e)=>i_(r,s_(e));function hi(r){const e=[];return r.forEach(t=>{const[i,s]=t.split(":");e.push(`${i}:${s}`)}),e}function h_(r){const e=[];return Object.values(r).forEach(t=>{e.push(...hi(t.accounts))}),e}function u_(r,e){const t=[];return Object.values(r).forEach(i=>{hi(i.accounts).includes(e)&&t.push(...i.methods)}),t}function l_(r,e){const t=[];return Object.values(r).forEach(i=>{hi(i.accounts).includes(e)&&t.push(...i.events)}),t}function nn(r){return r.includes(":")}function Xr(r){return nn(r)?r.split(":")[0]:r}function Lh(r){var e,t,i;const s={};if(!Pt(r))return s;for(const[n,o]of Object.entries(r)){const a=nn(n)?[n]:o.chains,c=o.methods||[],h=o.events||[],u=Xr(n);s[u]=c_(a_({},s[u]),{chains:Ot(a,(e=s[u])==null?void 0:e.chains),methods:Ot(c,(t=s[u])==null?void 0:t.methods),events:Ot(h,(i=s[u])==null?void 0:i.events)})}return s}function f_(r){const e={};return r?.forEach(t=>{var i;const[s,n]=t.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(t),(i=e[s].chains)==null||i.push(`${s}:${n}`)}),e}function Mh(r,e){e=e.map(i=>i.replace("did:pkh:",""));const t=f_(e);for(const[i,s]of Object.entries(t))s.methods?s.methods=Ot(s.methods,r):s.methods=r,s.events=["chainChanged","accountsChanged"];return t}function d_(r,e){var t,i,s,n,o,a;const c=Lh(r),h=Lh(e),u={},l=Object.keys(c).concat(Object.keys(h));for(const f of l)u[f]={chains:Ot((t=c[f])==null?void 0:t.chains,(i=h[f])==null?void 0:i.chains),methods:Ot((s=c[f])==null?void 0:s.methods,(n=h[f])==null?void 0:n.methods),events:Ot((o=c[f])==null?void 0:o.events,(a=h[f])==null?void 0:a.events)};return u}const p_={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},g_={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function F(r,e){const{message:t,code:i}=g_[r];return{message:e?`${t} ${e}`:t,code:i}}function ce(r,e){const{message:t,code:i}=p_[r];return{message:e?`${t} ${e}`:t,code:i}}function Mt(r,e){return!!Array.isArray(r)}function Pt(r){return Object.getPrototypeOf(r)===Object.prototype&&Object.keys(r).length}function we(r){return typeof r>"u"}function pe(r,e){return e&&we(r)?!0:typeof r=="string"&&!!r.trim().length}function Ca(r,e){return e&&we(r)?!0:typeof r=="number"&&!isNaN(r)}function y_(r,e){const{requiredNamespaces:t}=e,i=Object.keys(r.namespaces),s=Object.keys(t);let n=!0;return mr(s,i)?(i.forEach(o=>{const{accounts:a,methods:c,events:h}=r.namespaces[o],u=hi(a),l=t[o];(!mr(ff(o,l),u)||!mr(l.methods,c)||!mr(l.events,h))&&(n=!1)}),n):!1}function Hs(r){return pe(r,!1)&&r.includes(":")?r.split(":").length===2:!1}function w_(r){if(pe(r,!1)&&r.includes(":")){const e=r.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&Hs(t)}}return!1}function m_(r){function e(t){try{return typeof new URL(t)<"u"}catch{return!1}}try{if(pe(r,!1)){if(e(r))return!0;const t=wf(r);return e(t)}}catch{}return!1}function b_(r){var e;return(e=r?.proposer)==null?void 0:e.publicKey}function v_(r){return r?.topic}function E_(r,e){let t=null;return pe(r?.publicKey,!1)||(t=F("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function qh(r){let e=!0;return Mt(r)?r.length&&(e=r.every(t=>pe(t,!1))):e=!1,e}function __(r,e,t){let i=null;return Mt(e)&&e.length?e.forEach(s=>{i||Hs(s)||(i=ce("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):Hs(r)||(i=ce("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function x_(r,e,t){let i=null;return Object.entries(r).forEach(([s,n])=>{if(i)return;const o=__(s,ff(s,n),`${e} ${t}`);o&&(i=o)}),i}function I_(r,e){let t=null;return Mt(r)?r.forEach(i=>{t||w_(i)||(t=ce("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):t=ce("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function S_(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=I_(i?.accounts,`${e} namespace`);s&&(t=s)}),t}function D_(r,e){let t=null;return qh(r?.methods)?qh(r?.events)||(t=ce("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=ce("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function ad(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=D_(i,`${e}, namespace`);s&&(t=s)}),t}function $_(r,e,t){let i=null;if(r&&Pt(r)){const s=ad(r,e);s&&(i=s);const n=x_(r,e,t);n&&(i=n)}else i=F("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return i}function Wn(r,e){let t=null;if(r&&Pt(r)){const i=ad(r,e);i&&(t=i);const s=S_(r,e);s&&(t=s)}else t=F("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function cd(r){return pe(r.protocol,!0)}function O_(r,e){let t=!1;return r?r&&Mt(r)&&r.length&&r.forEach(i=>{t=cd(i)}):t=!0,t}function P_(r){return typeof r=="number"}function Le(r){return typeof r<"u"&&typeof r!==null}function A_(r){return!(!r||typeof r!="object"||!r.code||!Ca(r.code,!1)||!r.message||!pe(r.message,!1))}function C_(r){return!(we(r)||!pe(r.method,!1))}function T_(r){return!(we(r)||we(r.result)&&we(r.error)||!Ca(r.id,!1)||!pe(r.jsonrpc,!1))}function R_(r){return!(we(r)||!pe(r.name,!1))}function zh(r,e){return!(!Hs(e)||!h_(r).includes(e))}function B_(r,e,t){return pe(t,!1)?u_(r,e).includes(t):!1}function N_(r,e,t){return pe(t,!1)?l_(r,e).includes(t):!1}function Hh(r,e,t){let i=null;const s=U_(r),n=k_(e),o=Object.keys(s),a=Object.keys(n),c=Vh(Object.keys(r)),h=Vh(Object.keys(e)),u=c.filter(l=>!h.includes(l));return u.length&&(i=F("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),mr(o,a)||(i=F("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(l=>{if(!l.includes(":")||i)return;const f=hi(e[l].accounts);f.includes(l)||(i=F("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${l}
        Required: ${l}
        Approved: ${f.toString()}`))}),o.forEach(l=>{i||(mr(s[l].methods,n[l].methods)?mr(s[l].events,n[l].events)||(i=F("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${l}`)):i=F("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${l}`))}),i}function U_(r){const e={};return Object.keys(r).forEach(t=>{var i;t.includes(":")?e[t]=r[t]:(i=r[t].chains)==null||i.forEach(s=>{e[s]={methods:r[t].methods,events:r[t].events}})}),e}function Vh(r){return[...new Set(r.map(e=>e.includes(":")?e.split(":")[0]:e))]}function k_(r){const e={};return Object.keys(r).forEach(t=>{t.includes(":")?e[t]=r[t]:hi(r[t].accounts)?.forEach(s=>{e[s]={accounts:r[t].accounts.filter(n=>n.includes(`${s}:`)),methods:r[t].methods,events:r[t].events}})}),e}function j_(r,e){return Ca(r,!1)&&r<=e.max&&r>=e.min}function Kh(){const r=Xi();return new Promise(e=>{switch(r){case Je.browser:e(F_());break;case Je.reactNative:e(L_());break;case Je.node:e(M_());break;default:e(!0)}})}function F_(){return oi()&&navigator?.onLine}async function L_(){return cr()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function M_(){return!0}function q_(r){switch(Xi()){case Je.browser:z_(r);break;case Je.reactNative:H_(r);break}}function z_(r){!cr()&&oi()&&(window.addEventListener("online",()=>r(!0)),window.addEventListener("offline",()=>r(!1)))}function H_(r){cr()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>r(e?.isConnected))}function V_(){var r;return oi()&&zt.getDocument()?((r=zt.getDocument())==null?void 0:r.visibilityState)==="visible":!0}const Gn={};class bi{static get(e){return Gn[e]}static set(e,t){Gn[e]=t}static delete(e){delete Gn[e]}}function K_(r){const e=Ji.decode(r);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function W_({publicKey:r,signature:e,payload:t}){var i;const s=Fo(t.method),n=128|parseInt(((i=t.version)==null?void 0:i.toString())||"4"),o=J_(t.address),a=t.era==="00"?new Uint8Array([0]):Fo(t.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(t.nonce,16),h=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${Y_(t.tip)}`),l=X_(u),f=new Uint8Array([0,...r,o,...e,...a,...h,...l,...s]),p=Z_(f.length+1);return new Uint8Array([...p,n,...f])}function G_(r){const e=Fo(r),t=j1.blake2b(e,void 0,32);return"0x"+Buffer.from(t).toString("hex")}function Fo(r){return new Uint8Array(r.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function Y_(r){return r.startsWith("0x")?r.slice(2):r}function J_(r){const e=Ji.decode(r)[0];return e===42?0:e===60?2:1}function Z_(r){if(r<64)return new Uint8Array([r<<2]);if(r<16384){const e=r<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(r<1<<30){const e=r<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function X_(r){if(r<BigInt(1)<<BigInt(6))return new Uint8Array([Number(r<<BigInt(2))]);if(r<BigInt(1)<<BigInt(14)){const e=r<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(r<BigInt(1)<<BigInt(30)){const e=r<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function Q_(r){const e=Uint8Array.from(Buffer.from(r.signature,"hex")),t=K_(r.transaction.address),i=W_({publicKey:t,signature:e,payload:r.transaction}),s=Buffer.from(i).toString("hex");return G_(s)}const e3="PARSE_ERROR",t3="INVALID_REQUEST",r3="METHOD_NOT_FOUND",i3="INVALID_PARAMS",hd="INTERNAL_ERROR",Ta="SERVER_ERROR",s3=[-32700,-32600,-32601,-32602,-32603],Bi={[e3]:{code:-32700,message:"Parse error"},[t3]:{code:-32600,message:"Invalid Request"},[r3]:{code:-32601,message:"Method not found"},[i3]:{code:-32602,message:"Invalid params"},[hd]:{code:-32603,message:"Internal error"},[Ta]:{code:-32e3,message:"Server error"}},ud=Ta;function n3(r){return s3.includes(r)}function Wh(r){return Object.keys(Bi).includes(r)?Bi[r]:Bi[ud]}function o3(r){const e=Object.values(Bi).find(t=>t.code===r);return e||Bi[ud]}function ld(r,e,t){return r.message.includes("getaddrinfo ENOTFOUND")||r.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${t} RPC url at ${e}`):r}var Yn={};var Lo=function(r,e){return Lo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])},Lo(r,e)};function a3(r,e){Lo(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Mo=function(){return Mo=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Mo.apply(this,arguments)};function c3(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(r);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(t[i[s]]=r[i[s]]);return t}function h3(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n}function u3(r,e){return function(t,i){e(t,i,r)}}function l3(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function f3(r,e,t,i){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{h(i.next(u))}catch(l){o(l)}}function c(u){try{h(i.throw(u))}catch(l){o(l)}}function h(u){u.done?n(u.value):s(u.value).then(a,c)}h((i=i.apply(r,e||[])).next())})}function d3(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(h){return function(u){return c([h,u])}}function c(h){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(n=h[0]&2?s.return:h[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,h[1])).done)return n;switch(s=0,n&&(h=[h[0]&2,n.value]),h[0]){case 0:case 1:n=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,s=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!n||h[1]>n[0]&&h[1]<n[3])){t.label=h[1];break}if(h[0]===6&&t.label<n[1]){t.label=n[1],n=h;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(h);break}n[2]&&t.ops.pop(),t.trys.pop();continue}h=e.call(r,t)}catch(u){h=[6,u],s=0}finally{i=n=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function p3(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}function g3(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function qo(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function fd(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),s,n=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return n}function y3(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(fd(arguments[e]));return r}function w3(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var i=Array(r),s=0,e=0;e<t;e++)for(var n=arguments[e],o=0,a=n.length;o<a;o++,s++)i[s]=n[o];return i}function Hi(r){return this instanceof Hi?(this.v=r,this):new Hi(r)}function m3(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),s,n=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(f){i[f]&&(s[f]=function(p){return new Promise(function(d,g){n.push([f,p,d,g])>1||a(f,p)})})}function a(f,p){try{c(i[f](p))}catch(d){l(n[0][3],d)}}function c(f){f.value instanceof Hi?Promise.resolve(f.value.v).then(h,u):l(n[0][2],f)}function h(f){a("next",f)}function u(f){a("throw",f)}function l(f,p){f(p),n.shift(),n.length&&a(n[0][0],n[0][1])}}function b3(r){var e,t;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=r[s]?function(o){return(t=!t)?{value:Hi(r[s](o)),done:s==="return"}:n?n(o):o}:n}}function v3(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof qo=="function"?qo(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=r[n]&&function(o){return new Promise(function(a,c){o=r[n](o),s(a,c,o.done,o.value)})}}function s(n,o,a,c){Promise.resolve(c).then(function(h){n({value:h,done:a})},o)}}function E3(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function _3(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function x3(r){return r&&r.__esModule?r:{default:r}}function I3(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function S3(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}const D3=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Mo},__asyncDelegator:b3,__asyncGenerator:m3,__asyncValues:v3,__await:Hi,__awaiter:f3,__classPrivateFieldGet:I3,__classPrivateFieldSet:S3,__createBinding:p3,__decorate:h3,__exportStar:g3,__extends:a3,__generator:d3,__importDefault:x3,__importStar:_3,__makeTemplateObject:E3,__metadata:l3,__param:u3,__read:fd,__rest:c3,__spread:y3,__spreadArrays:w3,__values:qo},Symbol.toStringTag,{value:"Module"})),$3=tl(D3);var Nt={},Gh;function O3(){if(Gh)return Nt;Gh=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.isBrowserCryptoAvailable=Nt.getSubtleCrypto=Nt.getBrowerCrypto=void 0;function r(){return(St===null||St===void 0?void 0:St.crypto)||(St===null||St===void 0?void 0:St.msCrypto)||{}}Nt.getBrowerCrypto=r;function e(){const i=r();return i.subtle||i.webkitSubtle}Nt.getSubtleCrypto=e;function t(){return!!r()&&!!e()}return Nt.isBrowserCryptoAvailable=t,Nt}var Ut={},Yh;function P3(){if(Yh)return Ut;Yh=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.isBrowser=Ut.isNode=Ut.isReactNative=void 0;function r(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Ut.isReactNative=r;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Ut.isNode=e;function t(){return!r()&&!e()}return Ut.isBrowser=t,Ut}var Jh;function A3(){return Jh||(Jh=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=$3;e.__exportStar(O3(),r),e.__exportStar(P3(),r)})(Yn)),Yn}var C3=A3();function xt(r=3){const e=Date.now()*Math.pow(10,r),t=Math.floor(Math.random()*Math.pow(10,r));return e+t}function sr(r=6){return BigInt(xt(r))}function gt(r,e,t){return{id:t||xt(),jsonrpc:"2.0",method:r,params:e}}function Vi(r,e){return{id:r,jsonrpc:"2.0",result:e}}function on(r,e,t){return{id:r,jsonrpc:"2.0",error:T3(e)}}function T3(r,e){return typeof r>"u"?Wh(hd):(typeof r=="string"&&(r=Object.assign(Object.assign({},Wh(Ta)),{message:r})),n3(r.code)&&(r=o3(r.code)),r)}class R3{}class B3 extends R3{constructor(){super()}}class N3 extends B3{constructor(e){super()}}const U3="^https?:",k3="^wss?:";function j3(r){const e=r.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function dd(r,e){const t=j3(r);return typeof t>"u"?!1:new RegExp(e).test(t)}function Zh(r){return dd(r,U3)}function Xh(r){return dd(r,k3)}function F3(r){return new RegExp("wss?://localhost(:d{2,5})?").test(r)}function pd(r){return typeof r=="object"&&"id"in r&&"jsonrpc"in r&&r.jsonrpc==="2.0"}function Ra(r){return pd(r)&&"method"in r}function an(r){return pd(r)&&(It(r)||it(r))}function It(r){return"result"in r}function it(r){return"error"in r}let ht=class extends N3{constructor(e){super(e),this.events=new ct.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(gt(e.method,e.params||[],e.id||sr().toString()),t)}async requestStrict(e,t){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${e.id}`,n=>{it(n)?s(n.error):i(n.result)});try{await this.connection.send(e,t)}catch(n){s(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),an(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const L3=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),M3=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Qh=r=>r.split("?")[0],eu=10,q3=L3();let z3=class{constructor(e){if(this.url=e,this.events=new ct.EventEmitter,this.registering=!1,!Xh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(qt(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!Xh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,i)=>{const s=C3.isReactNative()?void 0:{rejectUnauthorized:!F3(e)},n=new q3(e,[],s);M3()?n.onerror=o=>{const a=o;i(this.emitError(a.error))}:n.on("error",o=>{i(this.emitError(o))}),n.onopen=()=>{this.onOpen(n),t(n)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?_r(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),s=i.message||i.toString(),n=on(e,s);this.events.emit("payload",n)}parseError(e,t=this.url){return ld(e,Qh(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>eu&&this.events.setMaxListeners(eu)}emitError(e){const t=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${Qh(this.url)}`));return this.events.emit("register_error",t),t}};var H3={};const gd="wc",yd=2,zo="core",At=`${gd}@2:${zo}:`,V3={logger:"error"},K3={database:":memory:"},W3="crypto",tu="client_ed25519_seed",G3=L.ONE_DAY,Y3="keychain",J3="0.3",Z3="messages",X3="0.3",Q3=L.SIX_HOURS,ex="publisher",wd="irn",tx="error",md="wss://relay.walletconnect.org",rx="relayer",ue={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},ix="_subscription",Xe={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},sx=.1,Ho="2.21.8",ae={link_mode:"link_mode",relay:"relay"},Os={inbound:"inbound",outbound:"outbound"},nx="0.3",ox="WALLETCONNECT_CLIENT_ID",ru="WALLETCONNECT_LINK_MODE_APPS",Ge={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},ax="subscription",cx="0.3",hx="pairing",ux="0.3",vi={wc_pairingDelete:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:L.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:L.ONE_DAY,prompt:!1,tag:0},res:{ttl:L.ONE_DAY,prompt:!1,tag:0}}},yr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},ft={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},lx="history",fx="0.3",dx="expirer",tt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},px="0.3",gx="verify-api",yx="https://verify.walletconnect.com",bd="https://verify.walletconnect.org",Ni=bd,wx=`${Ni}/v3`,mx=[yx,bd],bx="echo",vx="https://echo.walletconnect.com",_t={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},jt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Qt={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Ei={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},fr={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},_i={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},Ex=.1,_x="event-client",xx=86400,Ix="https://pulse.walletconnect.org/batch";function Sx(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),h=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,y=0,x=0,S=d.length;x!==S&&d[x]===0;)x++,g++;for(var E=(S-x)*u+1>>>0,I=new Uint8Array(E);x!==S;){for(var _=d[x],m=0,O=E-1;(_!==0||m<y)&&O!==-1;O--,m++)_+=256*I[O]>>>0,I[O]=_%a>>>0,_=_/a>>>0;if(_!==0)throw new Error("Non-zero carry");y=m,x++}for(var D=E-y;D!==E&&I[D]===0;)D++;for(var b=c.repeat(g);D<E;++D)b+=r.charAt(I[D]);return b}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var y=0,x=0;d[g]===c;)y++,g++;for(var S=(d.length-g)*h+1>>>0,E=new Uint8Array(S);d[g];){var I=t[d.charCodeAt(g)];if(I===255)return;for(var _=0,m=S-1;(I!==0||_<x)&&m!==-1;m--,_++)I+=a*E[m]>>>0,E[m]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");x=_,g++}if(d[g]!==" "){for(var O=S-x;O!==S&&E[O]===0;)O++;for(var D=new Uint8Array(y+(S-O)),b=y;O!==S;)D[b++]=E[O++];return D}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:f,decode:p}}var Dx=Sx,$x=Dx;const vd=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},Ox=r=>new TextEncoder().encode(r),Px=r=>new TextDecoder().decode(r);class Ax{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Cx{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ed(this,e)}}class Tx{constructor(e){this.decoders=e}or(e){return Ed(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ed=(r,e)=>new Tx({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class Rx{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new Ax(e,t,i),this.decoder=new Cx(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const cn=({name:r,prefix:e,encode:t,decode:i})=>new Rx(r,e,t,i),rs=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=$x(t,e);return cn({prefix:r,name:e,encode:i,decode:n=>vd(s(n))})},Bx=(r,e,t,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=r.length;for(;r[n-1]==="=";)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,h=0;for(let u=0;u<n;++u){const l=s[r[u]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<t|l,a+=t,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Nx=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,n+=e[s&a>>o];if(o&&(n+=e[s&a<<t-o]),i)for(;n.length*t&7;)n+="=";return n},Oe=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>cn({prefix:e,name:r,encode(s){return Nx(s,i,t)},decode(s){return Bx(s,i,t,r)}}),Ux=cn({prefix:"\0",name:"identity",encode:r=>Px(r),decode:r=>Ox(r)});var kx=Object.freeze({__proto__:null,identity:Ux});const jx=Oe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Fx=Object.freeze({__proto__:null,base2:jx});const Lx=Oe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Mx=Object.freeze({__proto__:null,base8:Lx});const qx=rs({prefix:"9",name:"base10",alphabet:"0123456789"});var zx=Object.freeze({__proto__:null,base10:qx});const Hx=Oe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Vx=Oe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Kx=Object.freeze({__proto__:null,base16:Hx,base16upper:Vx});const Wx=Oe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Gx=Oe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Yx=Oe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Jx=Oe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Zx=Oe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Xx=Oe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Qx=Oe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),eI=Oe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),tI=Oe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var rI=Object.freeze({__proto__:null,base32:Wx,base32upper:Gx,base32pad:Yx,base32padupper:Jx,base32hex:Zx,base32hexupper:Xx,base32hexpad:Qx,base32hexpadupper:eI,base32z:tI});const iI=rs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),sI=rs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var nI=Object.freeze({__proto__:null,base36:iI,base36upper:sI});const oI=rs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),aI=rs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var cI=Object.freeze({__proto__:null,base58btc:oI,base58flickr:aI});const hI=Oe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),uI=Oe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),lI=Oe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),fI=Oe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var dI=Object.freeze({__proto__:null,base64:hI,base64pad:uI,base64url:lI,base64urlpad:fI});const _d=Array.from(""),pI=_d.reduce((r,e,t)=>(r[t]=e,r),[]),gI=_d.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function yI(r){return r.reduce((e,t)=>(e+=pI[t],e),"")}function wI(r){const e=[];for(const t of r){const i=gI[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const mI=cn({prefix:"",name:"base256emoji",encode:yI,decode:wI});var bI=Object.freeze({__proto__:null,base256emoji:mI}),vI=xd,iu=128,EI=-128,_I=Math.pow(2,31);function xd(r,e,t){e=e||[],t=t||0;for(var i=t;r>=_I;)e[t++]=r&255|iu,r/=128;for(;r&EI;)e[t++]=r&255|iu,r>>>=7;return e[t]=r|0,xd.bytes=t-i+1,e}var xI=Vo,II=128,su=127;function Vo(r,i){var t=0,i=i||0,s=0,n=i,o,a=r.length;do{if(n>=a)throw Vo.bytes=0,new RangeError("Could not decode varint");o=r[n++],t+=s<28?(o&su)<<s:(o&su)*Math.pow(2,s),s+=7}while(o>=II);return Vo.bytes=n-i,t}var SI=Math.pow(2,7),DI=Math.pow(2,14),$I=Math.pow(2,21),OI=Math.pow(2,28),PI=Math.pow(2,35),AI=Math.pow(2,42),CI=Math.pow(2,49),TI=Math.pow(2,56),RI=Math.pow(2,63),BI=function(r){return r<SI?1:r<DI?2:r<$I?3:r<OI?4:r<PI?5:r<AI?6:r<CI?7:r<TI?8:r<RI?9:10},NI={encode:vI,decode:xI,encodingLength:BI},Id=NI;const nu=(r,e,t=0)=>(Id.encode(r,e,t),e),ou=r=>Id.encodingLength(r),Ko=(r,e)=>{const t=e.byteLength,i=ou(r),s=i+ou(t),n=new Uint8Array(s+t);return nu(r,n,0),nu(t,n,i),n.set(e,s),new UI(r,t,e,n)};class UI{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const Sd=({name:r,code:e,encode:t})=>new kI(r,e,t);class kI{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ko(this.code,t):t.then(i=>Ko(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Dd=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),jI=Sd({name:"sha2-256",code:18,encode:Dd("SHA-256")}),FI=Sd({name:"sha2-512",code:19,encode:Dd("SHA-512")});var LI=Object.freeze({__proto__:null,sha256:jI,sha512:FI});const $d=0,MI="identity",Od=vd,qI=r=>Ko($d,Od(r)),zI={code:$d,name:MI,encode:Od,digest:qI};var HI=Object.freeze({__proto__:null,identity:zI});new TextEncoder,new TextDecoder;const au={...kx,...Fx,...Mx,...zx,...Kx,...rI,...nI,...cI,...dI,...bI};({...LI,...HI});function Pd(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function VI(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Pd(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function Ad(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const cu=Ad("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Jn=Ad("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=VI(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),KI={utf8:cu,"utf-8":cu,hex:au.base16,latin1:Jn,ascii:Jn,binary:Jn,...au};function WI(r,e="utf8"){const t=KI[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Pd(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}var GI=Object.defineProperty,YI=(r,e,t)=>e in r?GI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,vt=(r,e,t)=>YI(r,typeof e!="symbol"?e+"":e,t);class JI{constructor(e,t){this.core=e,this.logger=t,vt(this,"keychain",new Map),vt(this,"name",Y3),vt(this,"version",J3),vt(this,"initialized",!1),vt(this,"storagePrefix",At),vt(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),vt(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),vt(this,"set",async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()}),vt(this,"get",i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:n}=F("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return s}),vt(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=Ue(t,this.name)}get context(){return Ke(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,$o(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Oo(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var ZI=Object.defineProperty,XI=(r,e,t)=>e in r?ZI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xe=(r,e,t)=>XI(r,typeof e!="symbol"?e+"":e,t);class QI{constructor(e,t,i){this.core=e,this.logger=t,xe(this,"name",W3),xe(this,"keychain"),xe(this,"randomSessionIdentifier",jo()),xe(this,"initialized",!1),xe(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),xe(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),xe(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),n=Rc(s);return kl(n.publicKey)}),xe(this,"generateKeyPair",()=>{this.isInitialized();const s=zE();return this.setPrivateKey(s.publicKey,s.privateKey)}),xe(this,"signJWT",async s=>{this.isInitialized();const n=await this.getClientSeed(),o=Rc(n),a=this.randomSessionIdentifier;return await Gw(a,s,G3,o)}),xe(this,"generateSharedKey",(s,n,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=HE(a,n);return this.setSymKey(c,o)}),xe(this,"setSymKey",async(s,n)=>{this.isInitialized();const o=n||$s(s);return await this.keychain.set(o,s),o}),xe(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),xe(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),xe(this,"encode",async(s,n,o)=>{this.isInitialized();const a=od(o),c=qt(n);if(Nh(a))return WE(c,o?.encoding);if(Bh(a)){const f=a.senderPublicKey,p=a.receiverPublicKey;s=await this.generateSharedKey(f,p)}const h=this.getSymKey(s),{type:u,senderPublicKey:l}=a;return VE({type:u,symKey:h,message:c,senderPublicKey:l,encoding:o?.encoding})}),xe(this,"decode",async(s,n,o)=>{this.isInitialized();const a=YE(n,o);if(Nh(a)){const c=GE(n,o?.encoding);return _r(c)}if(Bh(a)){const c=a.receiverPublicKey,h=a.senderPublicKey;s=await this.generateSharedKey(c,h)}try{const c=this.getSymKey(s),h=KE({symKey:c,encoded:n,encoding:o?.encoding});return _r(h)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),xe(this,"getPayloadType",(s,n=ze)=>{const o=zi({encoded:s,encoding:n});return Sr(o.type)}),xe(this,"getPayloadSenderPublicKey",(s,n=ze)=>{const o=zi({encoded:s,encoding:n});return o.senderPublicKey?Ve(o.senderPublicKey,Ne):void 0}),this.core=e,this.logger=Ue(t,this.name),this.keychain=i||new JI(this.core,this.logger)}get context(){return Ke(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(tu)}catch{e=jo(),await this.keychain.set(tu,e)}return WI(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var eS=Object.defineProperty,tS=Object.defineProperties,rS=Object.getOwnPropertyDescriptors,hu=Object.getOwnPropertySymbols,iS=Object.prototype.hasOwnProperty,sS=Object.prototype.propertyIsEnumerable,Wo=(r,e,t)=>e in r?eS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,nS=(r,e)=>{for(var t in e||(e={}))iS.call(e,t)&&Wo(r,t,e[t]);if(hu)for(var t of hu(e))sS.call(e,t)&&Wo(r,t,e[t]);return r},oS=(r,e)=>tS(r,rS(e)),We=(r,e,t)=>Wo(r,typeof e!="symbol"?e+"":e,t);class aS extends Kg{constructor(e,t){super(e,t),this.logger=e,this.core=t,We(this,"messages",new Map),We(this,"messagesWithoutClientAck",new Map),We(this,"name",Z3),We(this,"version",X3),We(this,"initialized",!1),We(this,"storagePrefix",At),We(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),We(this,"set",async(i,s,n)=>{this.isInitialized();const o=rt(s);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(i,a),n===Os.inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,oS(nS({},c),{[o]:s}))}return await this.persist(),o}),We(this,"get",i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s}),We(this,"getWithoutAck",i=>{this.isInitialized();const s={};for(const n of i){const o=this.messagesWithoutClientAck.get(n)||{};s[n]=Object.values(o)}return s}),We(this,"has",(i,s)=>{this.isInitialized();const n=this.get(i),o=rt(s);return typeof n[o]<"u"}),We(this,"ack",async(i,s)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(i);if(typeof n>"u")return;const o=rt(s);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,n),await this.persist()}),We(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=Ue(e,this.name),this.core=t}get context(){return Ke(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,$o(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,$o(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Oo(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Oo(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var cS=Object.defineProperty,hS=Object.defineProperties,uS=Object.getOwnPropertyDescriptors,uu=Object.getOwnPropertySymbols,lS=Object.prototype.hasOwnProperty,fS=Object.prototype.propertyIsEnumerable,Go=(r,e,t)=>e in r?cS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,kr=(r,e)=>{for(var t in e||(e={}))lS.call(e,t)&&Go(r,t,e[t]);if(uu)for(var t of uu(e))fS.call(e,t)&&Go(r,t,e[t]);return r},lu=(r,e)=>hS(r,uS(e)),Qe=(r,e,t)=>Go(r,typeof e!="symbol"?e+"":e,t);class dS extends Wg{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,Qe(this,"events",new ct.EventEmitter),Qe(this,"name",ex),Qe(this,"queue",new Map),Qe(this,"publishTimeout",L.toMiliseconds(L.ONE_MINUTE)),Qe(this,"initialPublishTimeout",L.toMiliseconds(L.ONE_SECOND*15)),Qe(this,"needsTransportRestart",!1),Qe(this,"publish",async(i,s,n)=>{var o,a,c,h,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:n}});const l=n?.ttl||Q3,f=n?.prompt||!1,p=n?.tag||0,d=n?.id||sr().toString(),g=Zr(zs().protocol),y={id:d,method:n?.publishMethod||g.publish,params:kr({topic:i,message:s,ttl:l,prompt:f,tag:p,attestation:n?.attestation},n?.tvf&&{tvf:n.tvf})},x=`Failed to publish payload, please try again. id:${d} tag:${p}`;try{we((o=y.params)==null?void 0:o.prompt)&&((a=y.params)==null||delete a.prompt),we((c=y.params)==null?void 0:c.tag)&&((h=y.params)==null||delete h.tag);const S=new Promise(async E=>{const I=({id:m})=>{var O;((O=y.id)==null?void 0:O.toString())===m.toString()&&(this.removeRequestFromQueue(m),this.relayer.events.removeListener(ue.publish,I),E())};this.relayer.events.on(ue.publish,I);const _=$t(new Promise((m,O)=>{this.rpcPublish(y,n).then(m).catch(D=>{this.logger.warn(D,D?.message),O(D)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${d} tag:${p}`);try{await _,this.events.removeListener(ue.publish,I)}catch(m){this.queue.set(d,{request:y,opts:n,attempt:1}),this.logger.warn(m,m?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:d,topic:i,message:s,opts:n}}),await $t(S,this.publishTimeout,x)}catch(S){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(S),(u=n?.internal)!=null&&u.throwOnFailedPublish)throw S}finally{this.queue.delete(d)}}),Qe(this,"publishCustom",async i=>{var s,n,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:i});const{payload:h,opts:u={}}=i,{attestation:l,tvf:f,publishMethod:p,prompt:d,tag:g,ttl:y=L.FIVE_MINUTES}=u,x=u.id||sr().toString(),S=Zr(zs().protocol),E=p||S.publish,I={id:x,method:E,params:kr(lu(kr({},h),{ttl:y,prompt:d,tag:g,attestation:l}),f)},_=`Failed to publish custom payload, please try again. id:${x} tag:${g}`;try{we((s=I.params)==null?void 0:s.prompt)&&((n=I.params)==null||delete n.prompt),we((o=I.params)==null?void 0:o.tag)&&((a=I.params)==null||delete a.tag);const m=new Promise(async O=>{const D=({id:$})=>{var P;((P=I.id)==null?void 0:P.toString())===$.toString()&&(this.removeRequestFromQueue($),this.relayer.events.removeListener(ue.publish,D),O())};this.relayer.events.on(ue.publish,D);const b=$t(new Promise(($,P)=>{this.rpcPublish(I,u).then($).catch(C=>{this.logger.warn(C,C?.message),P(C)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${E} id:${x} tag:${g}`);try{await b,this.events.removeListener(ue.publish,D)}catch($){this.queue.set(x,{request:I,opts:u,attempt:1}),this.logger.warn($,$?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:x,payload:h,opts:u}}),await $t(m,this.publishTimeout,_)}catch(m){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(m),(c=u?.internal)!=null&&c.throwOnFailedPublish)throw m}finally{this.queue.delete(x)}}),Qe(this,"on",(i,s)=>{this.events.on(i,s)}),Qe(this,"once",(i,s)=>{this.events.once(i,s)}),Qe(this,"off",(i,s)=>{this.events.off(i,s)}),Qe(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.relayer=e,this.logger=Ue(t,this.name),this.registerEventListeners()}get context(){return Ke(this.logger)}async rpcPublish(e,t){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const i=await this.relayer.request(e);return this.relayer.events.emit(ue.publish,kr(kr({},e),t)),this.logger.debug("Successfully Published Payload"),i}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{var i;const s=e.attempt+1;this.queue.set(t,lu(kr({},e),{attempt:s})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(i=e.request.params)==null?void 0:i.tag}, attempt: ${s}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on($r.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ue.connection_stalled);return}this.checkQueue()}),this.relayer.on(ue.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var pS=Object.defineProperty,gS=(r,e,t)=>e in r?pS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,jr=(r,e,t)=>gS(r,typeof e!="symbol"?e+"":e,t);class yS{constructor(){jr(this,"map",new Map),jr(this,"set",(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])}),jr(this,"get",e=>this.map.get(e)||[]),jr(this,"exists",(e,t)=>this.get(e).includes(t)),jr(this,"delete",(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(n=>n!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),jr(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var wS=Object.defineProperty,mS=Object.defineProperties,bS=Object.getOwnPropertyDescriptors,fu=Object.getOwnPropertySymbols,vS=Object.prototype.hasOwnProperty,ES=Object.prototype.propertyIsEnumerable,Yo=(r,e,t)=>e in r?wS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xi=(r,e)=>{for(var t in e||(e={}))vS.call(e,t)&&Yo(r,t,e[t]);if(fu)for(var t of fu(e))ES.call(e,t)&&Yo(r,t,e[t]);return r},Zn=(r,e)=>mS(r,bS(e)),ne=(r,e,t)=>Yo(r,typeof e!="symbol"?e+"":e,t);class _S extends Jg{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,ne(this,"subscriptions",new Map),ne(this,"topicMap",new yS),ne(this,"events",new ct.EventEmitter),ne(this,"name",ax),ne(this,"version",cx),ne(this,"pending",new Map),ne(this,"cached",[]),ne(this,"initialized",!1),ne(this,"storagePrefix",At),ne(this,"subscribeTimeout",L.toMiliseconds(L.ONE_MINUTE)),ne(this,"initialSubscribeTimeout",L.toMiliseconds(L.ONE_SECOND*15)),ne(this,"clientId"),ne(this,"batchSubscribeTopicsLimit",500),ne(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ne(this,"subscribe",async(i,s)=>{var n;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const o=zs(s),a={topic:i,relay:o,transportType:s?.transportType};(n=s?.internal)!=null&&n.skipSubscribe||this.pending.set(i,a);const c=await this.rpcSubscribe(i,o,s);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),ne(this,"unsubscribe",async(i,s)=>{this.isInitialized(),typeof s?.id<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)}),ne(this,"isSubscribed",i=>new Promise(s=>{s(this.topicMap.topics.includes(i))})),ne(this,"isKnownTopic",i=>new Promise(s=>{s(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(n=>n.topic===i))})),ne(this,"on",(i,s)=>{this.events.on(i,s)}),ne(this,"once",(i,s)=>{this.events.once(i,s)}),ne(this,"off",(i,s)=>{this.events.off(i,s)}),ne(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),ne(this,"start",async()=>{await this.onConnect()}),ne(this,"stop",async()=>{await this.onDisconnect()}),ne(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ne(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(s=>{i.push(s)}),await this.batchSubscribe(i)}),ne(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on($r.pulse,async()=>{await this.checkPending()}),this.events.on(Ge.created,async i=>{const s=Ge.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()}),this.events.on(Ge.deleted,async i=>{const s=Ge.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()})}),this.relayer=e,this.logger=Ue(t,this.name),this.clientId=""}get context(){return Ke(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const s=zs(i);await this.restartToComplete({topic:e,id:t,relay:s}),await this.rpcUnsubscribe(e,t,s);const n=ce("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t,i){var s,n;const o=await this.getSubscriptionId(e);if((s=i?.internal)!=null&&s.skipSubscribe)return o;(!i||i?.transportType===ae.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});const a={method:Zr(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(n=i?.internal)==null?void 0:n.throwOnFailedPublish;try{if(i?.transportType===ae.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(l=>this.logger.warn(l))},L.toMiliseconds(L.ONE_SECOND)),o;const h=new Promise(async l=>{const f=p=>{p.topic===e&&(this.events.removeListener(Ge.created,f),l(p.id))};this.events.on(Ge.created,f);try{const p=await $t(new Promise((d,g)=>{this.relayer.request(a).catch(y=>{this.logger.warn(y,y?.message),g(y)}).then(d)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Ge.created,f),l(p)}catch{}}),u=await $t(h,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(h){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ue.connection_stalled),c)throw h}return null}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,i={method:Zr(t.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await $t(new Promise(s=>{this.relayer.request(i).catch(n=>this.logger.warn(n)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(ue.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const t=e[0].relay,i={method:Zr(t.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await $t(new Promise((n,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(ue.connection_stalled)}return s}rpcUnsubscribe(e,t,i){const s={method:Zr(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,Zn(xi({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,xi({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,xi({},t)),this.topicMap.set(t.topic,e),this.events.emit(Ge.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=F("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Ge.deleted,Zn(xi({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ge.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<t;i++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Ge.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(t=>{var i;return t.topic===((i=this.subscriptions.get(t.id))==null?void 0:i.topic)})){const{message:t}=F("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async t=>Zn(xi({},t),{id:await this.getSubscriptionId(t.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await lv(L.toMiliseconds(L.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return rt(e+await this.getClientId())}}var xS=Object.defineProperty,du=Object.getOwnPropertySymbols,IS=Object.prototype.hasOwnProperty,SS=Object.prototype.propertyIsEnumerable,Jo=(r,e,t)=>e in r?xS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,pu=(r,e)=>{for(var t in e||(e={}))IS.call(e,t)&&Jo(r,t,e[t]);if(du)for(var t of du(e))SS.call(e,t)&&Jo(r,t,e[t]);return r},X=(r,e,t)=>Jo(r,typeof e!="symbol"?e+"":e,t);class DS extends Gg{constructor(e){super(e),X(this,"protocol","wc"),X(this,"version",2),X(this,"core"),X(this,"logger"),X(this,"events",new ct.EventEmitter),X(this,"provider"),X(this,"messages"),X(this,"subscriber"),X(this,"publisher"),X(this,"name",rx),X(this,"transportExplicitlyClosed",!1),X(this,"initialized",!1),X(this,"connectionAttemptInProgress",!1),X(this,"relayUrl"),X(this,"projectId"),X(this,"packageName"),X(this,"bundleId"),X(this,"hasExperiencedNetworkDisruption",!1),X(this,"pingTimeout"),X(this,"heartBeatTimeout",L.toMiliseconds(L.THIRTY_SECONDS+L.FIVE_SECONDS)),X(this,"reconnectTimeout"),X(this,"connectPromise"),X(this,"reconnectInProgress",!1),X(this,"requestsInFlight",[]),X(this,"connectTimeout",L.toMiliseconds(L.ONE_SECOND*15)),X(this,"request",async t=>{var i,s;this.logger.debug("Publishing Request Payload");const n=t.id||sr().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:t.method,topic:(i=t.params)==null?void 0:i.topic},"relayer.request - publishing...");const o=`${n}:${((s=t.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(t);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),X(this,"resetPingTimeout",()=>{Fs()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var t,i,s,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(n=(s=(i=(t=this.provider)==null?void 0:t.connection)==null?void 0:i.socket)==null?void 0:s.terminate)==null||n.call(s)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),X(this,"onPayloadHandler",t=>{this.onProviderPayload(t),this.resetPingTimeout()}),X(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(ue.connect)}),X(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),X(this,"onProviderErrorHandler",t=>{this.logger.fatal(`Fatal socket error: ${t.message}`),this.events.emit(ue.error,t),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),X(this,"registerProviderListeners",()=>{this.provider.on(Xe.payload,this.onPayloadHandler),this.provider.on(Xe.connect,this.onConnectHandler),this.provider.on(Xe.disconnect,this.onDisconnectHandler),this.provider.on(Xe.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Ue(e.logger,this.name):Wi(Ks({level:e.logger||tx})),this.messages=new aS(this.logger,e.core),this.subscriber=new _S(this,this.logger),this.publisher=new dS(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||md,Y1()?this.packageName=rh():J1()&&(this.bundleId=rh()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return Ke(this.logger)}get connected(){var e,t,i;return((i=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,t,i;return((i=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:ae.relay},Os.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,t){var i,s,n;this.isInitialized(),(!(t!=null&&t.transportType)||t?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((i=t?.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(s=t?.internal)==null?void 0:s.throwOnFailedPublish;let a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c;const h=u=>{u.topic===e&&(this.subscriber.off(Ge.created,h),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(Ge.created,h)}),new Promise(async(u,l)=>{a=await this.subscriber.subscribe(e,pu({internal:{throwOnFailedPublish:o}},t)).catch(f=>{o&&l(f)})||a,u()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await $t(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,i)=>{await this.connect(e).then(t).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Kh())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const t=e.sort((i,s)=>i.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(const i of t)try{await this.onMessageEvent(i)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+s?.message)}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){const{topic:i}=e;if(!t.sessionExists){const s=de(L.FIVE_MINUTES),n={topic:i,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,n)}this.events.emit(ue.message,e),await this.recordMessageEvent(e,Os.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(i,s)=>{const n=()=>{s(new Error("Connection interrupted while trying to connect"))};this.provider.once(Xe.disconnect,n),await $t(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(Xe.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Xe.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Xe.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const s=i;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(i=>setTimeout(i,L.toMiliseconds(t*1))),t++}}startPingTimeout(){var e,t,i,s,n;if(Fs())try{(t=(e=this.provider)==null?void 0:e.connection)!=null&&t.socket&&((n=(s=(i=this.provider)==null?void 0:i.connection)==null?void 0:s.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new ht(new z3(tv({sdkVersion:Ho,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){const{topic:i,message:s}=e;await this.messages.set(i,s,t)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;const s=this.messages.has(t,i);return s&&this.logger.warn(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Ra(e)){if(!e.method.endsWith(ix))return;const t=e.params,{topic:i,message:s,publishedAt:n,attestation:o}=t.data,a={topic:i,message:s,publishedAt:n,transportType:ae.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(pu({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else an(e)&&this.events.emit(ue.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Os.inbound),this.events.emit(ue.message,e))}async acknowledgePayload(e){const t=Vi(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(Xe.payload,this.onPayloadHandler),this.provider.off(Xe.connect,this.onConnectHandler),this.provider.off(Xe.disconnect,this.onDisconnectHandler),this.provider.off(Xe.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Kh();q_(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(i=>this.logger.error(i,i?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on($r.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&V_())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(t){this.logger.warn(t,t?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(ue.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},L.toMiliseconds(sx)))))}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function $S(r,e){return r===e||Number.isNaN(r)&&Number.isNaN(e)}function gu(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function yu(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const OS="[object RegExp]",PS="[object String]",AS="[object Number]",CS="[object Boolean]",wu="[object Arguments]",TS="[object Symbol]",RS="[object Date]",BS="[object Map]",NS="[object Set]",US="[object Array]",kS="[object Function]",jS="[object ArrayBuffer]",Xn="[object Object]",FS="[object Error]",LS="[object DataView]",MS="[object Uint8Array]",qS="[object Uint8ClampedArray]",zS="[object Uint16Array]",HS="[object Uint32Array]",VS="[object BigUint64Array]",KS="[object Int8Array]",WS="[object Int16Array]",GS="[object Int32Array]",YS="[object BigInt64Array]",JS="[object Float32Array]",ZS="[object Float64Array]";function XS(){}function mu(r){if(!r||typeof r!="object")return!1;const e=Object.getPrototypeOf(r);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(r)==="[object Object]":!1}function QS(r,e,t){return $i(r,e,void 0,void 0,void 0,void 0,t)}function $i(r,e,t,i,s,n,o){const a=o(r,e,t,i,s,n);if(a!==void 0)return a;if(typeof r==typeof e)switch(typeof r){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return r===e;case"number":return r===e||Object.is(r,e);case"function":return r===e;case"object":return Ui(r,e,n,o)}return Ui(r,e,n,o)}function Ui(r,e,t,i){if(Object.is(r,e))return!0;let s=yu(r),n=yu(e);if(s===wu&&(s=Xn),n===wu&&(n=Xn),s!==n)return!1;switch(s){case PS:return r.toString()===e.toString();case AS:{const c=r.valueOf(),h=e.valueOf();return $S(c,h)}case CS:case RS:case TS:return Object.is(r.valueOf(),e.valueOf());case OS:return r.source===e.source&&r.flags===e.flags;case kS:return r===e}t=t??new Map;const o=t.get(r),a=t.get(e);if(o!=null&&a!=null)return o===e;t.set(r,e),t.set(e,r);try{switch(s){case BS:{if(r.size!==e.size)return!1;for(const[c,h]of r.entries())if(!e.has(c)||!$i(h,e.get(c),c,r,e,t,i))return!1;return!0}case NS:{if(r.size!==e.size)return!1;const c=Array.from(r.values()),h=Array.from(e.values());for(let u=0;u<c.length;u++){const l=c[u],f=h.findIndex(p=>$i(l,p,void 0,r,e,t,i));if(f===-1)return!1;h.splice(f,1)}return!0}case US:case MS:case qS:case zS:case HS:case VS:case KS:case WS:case GS:case YS:case JS:case ZS:{if(typeof Buffer<"u"&&Buffer.isBuffer(r)!==Buffer.isBuffer(e)||r.length!==e.length)return!1;for(let c=0;c<r.length;c++)if(!$i(r[c],e[c],c,r,e,t,i))return!1;return!0}case jS:return r.byteLength!==e.byteLength?!1:Ui(new Uint8Array(r),new Uint8Array(e),t,i);case LS:return r.byteLength!==e.byteLength||r.byteOffset!==e.byteOffset?!1:Ui(new Uint8Array(r),new Uint8Array(e),t,i);case FS:return r.name===e.name&&r.message===e.message;case Xn:{if(!(Ui(r.constructor,e.constructor,t,i)||mu(r)&&mu(e)))return!1;const c=[...Object.keys(r),...gu(r)],h=[...Object.keys(e),...gu(e)];if(c.length!==h.length)return!1;for(let u=0;u<c.length;u++){const l=c[u],f=r[l];if(!Object.hasOwn(e,l))return!1;const p=e[l];if(!$i(f,p,l,r,e,t,i))return!1}return!0}default:return!1}}finally{t.delete(r),t.delete(e)}}function e8(r,e){return QS(r,e,XS)}var t8=Object.defineProperty,bu=Object.getOwnPropertySymbols,r8=Object.prototype.hasOwnProperty,i8=Object.prototype.propertyIsEnumerable,Zo=(r,e,t)=>e in r?t8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,vu=(r,e)=>{for(var t in e||(e={}))r8.call(e,t)&&Zo(r,t,e[t]);if(bu)for(var t of bu(e))i8.call(e,t)&&Zo(r,t,e[t]);return r},je=(r,e,t)=>Zo(r,typeof e!="symbol"?e+"":e,t);class Pr extends Yg{constructor(e,t,i,s=At,n=void 0){super(e,t,i,s),this.core=e,this.logger=t,this.name=i,je(this,"map",new Map),je(this,"version",nx),je(this,"cached",[]),je(this,"initialized",!1),je(this,"getKey"),je(this,"storagePrefix",At),je(this,"recentlyDeleted",[]),je(this,"recentlyDeletedLimit",200),je(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!we(o)?this.map.set(this.getKey(o),o):b_(o)?this.map.set(o.id,o):v_(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),je(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),je(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),je(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>e8(a[c],o[c]))):this.values)),je(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=vu(vu({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),je(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Ue(t,this.name),this.storagePrefix=s,this.getKey=n}get context(){return Ke(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:s}=F("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:i}=F("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=F("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var s8=Object.defineProperty,n8=(r,e,t)=>e in r?s8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Y=(r,e,t)=>n8(r,typeof e!="symbol"?e+"":e,t);class o8{constructor(e,t){this.core=e,this.logger=t,Y(this,"name",hx),Y(this,"version",ux),Y(this,"events",new oa),Y(this,"pairings"),Y(this,"initialized",!1),Y(this,"storagePrefix",At),Y(this,"ignoredPayloadTypes",[Lt]),Y(this,"registeredMethods",[]),Y(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),Y(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),Y(this,"create",async i=>{this.isInitialized();const s=jo(),n=await this.core.crypto.setSymKey(s),o=de(L.FIVE_MINUTES),a={protocol:wd},c={topic:n,expiry:o,relay:a,active:!1,methods:i?.methods},h=kh({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:a,expiryTimestamp:o,methods:i?.methods});return this.events.emit(yr.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:i?.transportType,internal:i?.internal}),{topic:n,uri:h}}),Y(this,"pair",async i=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:i?.uri,trace:[_t.pairing_started]}});this.isValidPair(i,s);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:h}=Uh(i.uri);s.props.properties.topic=n,s.addTrace(_t.pairing_uri_validation_success),s.addTrace(_t.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(n)){if(u=this.pairings.get(n),s.addTrace(_t.existing_pairing),u.active)throw s.setError(jt.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(_t.pairing_not_expired)}const l=c||de(L.FIVE_MINUTES),f={topic:n,relay:a,expiry:l,active:!1,methods:h};this.core.expirer.set(n,l),await this.pairings.set(n,f),s.addTrace(_t.store_new_pairing),i.activatePairing&&await this.activate({topic:n}),this.events.emit(yr.create,f),s.addTrace(_t.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),s.addTrace(_t.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(jt.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(p){throw s.setError(jt.subscribe_pairing_topic_failure),p}return s.addTrace(_t.subscribe_pairing_topic_success),f}),Y(this,"activate",async({topic:i})=>{this.isInitialized();const s=de(L.FIVE_MINUTES);this.core.expirer.set(i,s),await this.pairings.update(i,{active:!0,expiry:s})}),Y(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=pr();this.events.once(re("pairing_ping",n),({error:h})=>{h?c(h):a()}),await o()}}),Y(this,"updateExpiry",async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})}),Y(this,"updateMetadata",async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})}),Y(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),Y(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",ce("USER_DISCONNECTED")),await this.deletePairing(s))}),Y(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:s,relay:n,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(s);return kh({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),Y(this,"sendRequest",async(i,s,n)=>{const o=gt(s,n),a=await this.core.crypto.encode(i,o),c=vi[s].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),Y(this,"sendResult",async(i,s,n)=>{const o=Vi(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,h=vi[c].res;await this.core.relayer.publish(s,a,h),await this.core.history.resolve(o)}),Y(this,"sendError",async(i,s,n)=>{const o=on(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,h=vi[c]?vi[c].res:vi.unregistered_method.res;await this.core.relayer.publish(s,a,h),await this.core.history.resolve(o)}),Y(this,"deletePairing",async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,ce("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])}),Y(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(s=>Dt(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))}),Y(this,"onRelayEventRequest",async i=>{const{topic:s,payload:n}=i;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,n);default:return await this.onUnknownRpcMethodRequest(s,n)}}),Y(this,"onRelayEventResponse",async i=>{const{topic:s,payload:n}=i,o=(await this.core.history.get(s,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(o)}}),Y(this,"onPairingPingRequest",async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit(yr.ping,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),Y(this,"onPairingPingResponse",(i,s)=>{const{id:n}=s;setTimeout(()=>{It(s)?this.events.emit(re("pairing_ping",n),{}):it(s)&&this.events.emit(re("pairing_ping",n),{error:s.error})},500)}),Y(this,"onPairingDeleteRequest",async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(yr.delete,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),Y(this,"onUnknownRpcMethodRequest",async(i,s)=>{const{id:n,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=ce("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,i,a),this.logger.error(a)}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),Y(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(ce("WC_METHOD_UNSUPPORTED",i))}),Y(this,"isValidPair",(i,s)=>{var n;if(!Le(i)){const{message:a}=F("MISSING_OR_INVALID",`pair() params: ${i}`);throw s.setError(jt.malformed_pairing_uri),new Error(a)}if(!m_(i.uri)){const{message:a}=F("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw s.setError(jt.malformed_pairing_uri),new Error(a)}const o=Uh(i?.uri);if(!((n=o?.relay)!=null&&n.protocol)){const{message:a}=F("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(jt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=F("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(jt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&L.toMiliseconds(o?.expiryTimestamp)<Date.now()){s.setError(jt.pairing_expired);const{message:a}=F("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),Y(this,"isValidPing",async i=>{if(!Le(i)){const{message:n}=F("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),Y(this,"isValidDisconnect",async i=>{if(!Le(i)){const{message:n}=F("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),Y(this,"isValidPairingTopic",async i=>{if(!pe(i,!1)){const{message:s}=F("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=F("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(Dt(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=F("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}}),this.core=e,this.logger=Ue(t,this.name),this.pairings=new Pr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ke(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(ue.message,async e=>{const{topic:t,message:i,transportType:s}=e;if(this.pairings.keys.includes(t)&&s!==ae.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const n=await this.core.crypto.decode(t,i);Ra(n)?(this.core.history.set(t,n),await this.onRelayEventRequest({topic:t,payload:n})):an(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n}),this.core.history.delete(t,n.id)),await this.core.relayer.messages.ack(t,i)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(tt.expired,async e=>{const{topic:t}=yf(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(yr.expire,{topic:t}))})}}var a8=Object.defineProperty,c8=(r,e,t)=>e in r?a8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ie=(r,e,t)=>c8(r,typeof e!="symbol"?e+"":e,t);class h8 extends Vg{constructor(e,t){super(e,t),this.core=e,this.logger=t,Ie(this,"records",new Map),Ie(this,"events",new ct.EventEmitter),Ie(this,"name",lx),Ie(this,"version",fx),Ie(this,"cached",[]),Ie(this,"initialized",!1),Ie(this,"storagePrefix",At),Ie(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ie(this,"set",(i,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const o={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n,expiry:de(L.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(ft.created,o)}),Ie(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=it(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.persist(),this.events.emit(ft.updated,s))}),Ie(this,"get",async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s))),Ie(this,"delete",(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(ft.deleted,n)}}),this.persist()}),Ie(this,"exists",async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1)),Ie(this,"on",(i,s)=>{this.events.on(i,s)}),Ie(this,"once",(i,s)=>{this.events.once(i,s)}),Ie(this,"off",(i,s)=>{this.events.off(i,s)}),Ie(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=Ue(t,this.name)}get context(){return Ke(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:gt(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=F("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(ft.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=F("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(ft.created,e=>{const t=ft.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(ft.updated,e=>{const t=ft.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(ft.deleted,e=>{const t=ft.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on($r.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{L.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(ft.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var u8=Object.defineProperty,l8=(r,e,t)=>e in r?u8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Te=(r,e,t)=>l8(r,typeof e!="symbol"?e+"":e,t);class f8 extends Zg{constructor(e,t){super(e,t),this.core=e,this.logger=t,Te(this,"expirations",new Map),Te(this,"events",new ct.EventEmitter),Te(this,"name",dx),Te(this,"version",px),Te(this,"cached",[]),Te(this,"initialized",!1),Te(this,"storagePrefix",At),Te(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Te(this,"has",i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}}),Te(this,"set",(i,s)=>{this.isInitialized();const n=this.formatTarget(i),o={target:n,expiry:s};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(tt.created,{target:n,expiration:o})}),Te(this,"get",i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)}),Te(this,"del",i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(tt.deleted,{target:s,expiration:n})}}),Te(this,"on",(i,s)=>{this.events.on(i,s)}),Te(this,"once",(i,s)=>{this.events.once(i,s)}),Te(this,"off",(i,s)=>{this.events.off(i,s)}),Te(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=Ue(t,this.name)}get context(){return Ke(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return rv(e);if(typeof e=="number")return iv(e);const{message:t}=F("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(tt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=F("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=F("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;L.toMiliseconds(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(tt.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on($r.pulse,()=>this.checkExpirations()),this.events.on(tt.created,e=>{const t=tt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(tt.expired,e=>{const t=tt.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(tt.deleted,e=>{const t=tt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var d8=Object.defineProperty,p8=(r,e,t)=>e in r?d8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,fe=(r,e,t)=>p8(r,typeof e!="symbol"?e+"":e,t);class g8 extends Xg{constructor(e,t,i){super(e,t,i),this.core=e,this.logger=t,this.store=i,fe(this,"name",gx),fe(this,"abortController"),fe(this,"isDevEnv"),fe(this,"verifyUrlV3",wx),fe(this,"storagePrefix",At),fe(this,"version",yd),fe(this,"publicKey"),fe(this,"fetchPromise"),fe(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&L.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),fe(this,"register",async s=>{if(!oi()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const h=zt.getDocument(),u=this.startAbortTimer(L.ONE_SECOND*5),l=await new Promise((f,p)=>{const d=()=>{window.removeEventListener("message",y),h.body.removeChild(g),p("attestation aborted")};this.abortController.signal.addEventListener("abort",d);const g=h.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",d,{signal:this.abortController.signal});const y=x=>{if(x.data&&typeof x.data=="string")try{const S=JSON.parse(x.data);if(S.type==="verify_attestation"){if(vo(S.attestation).payload.id!==o)return;clearInterval(u),h.body.removeChild(g),this.abortController.signal.removeEventListener("abort",d),window.removeEventListener("message",y),f(S.attestation===null?"":S.attestation)}}catch(S){this.logger.warn(S)}};h.body.appendChild(g),window.addEventListener("message",y,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",l),l}catch(h){this.logger.warn(h)}return""}),fe(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=s;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(vo(n).payload.id!==a)return;const h=await this.isValidJwtAttestation(n);if(h){if(!h.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return h}}if(!o)return;const c=this.getVerifyUrl(s?.verifyUrl);return this.fetchAttestation(o,c)}),fe(this,"fetchAttestation",async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);const o=this.startAbortTimer(L.ONE_SECOND*5),a=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),fe(this,"getVerifyUrl",s=>{let n=s||Ni;return mx.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${Ni}`),n=Ni),n}),fe(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(L.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}}),fe(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),fe(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),fe(this,"isValidJwtAttestation",async s=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),fe(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),fe(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),fe(this,"validateAttestation",(s,n)=>{const o=ZE(s,n.publicKey),a={hasExpired:L.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Ue(t,this.name),this.abortController=new AbortController,this.isDevEnv=ma(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Ke(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),L.toMiliseconds(e))}}var y8=Object.defineProperty,w8=(r,e,t)=>e in r?y8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Eu=(r,e,t)=>w8(r,typeof e!="symbol"?e+"":e,t);class m8 extends Qg{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,Eu(this,"context",bx),Eu(this,"registerDeviceToken",async i=>{const{clientId:s,token:n,notificationType:o,enableEncrypted:a=!1}=i,c=`${vx}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:n,always_raw:a})})}),this.logger=Ue(t,this.context)}}var b8=Object.defineProperty,_u=Object.getOwnPropertySymbols,v8=Object.prototype.hasOwnProperty,E8=Object.prototype.propertyIsEnumerable,Xo=(r,e,t)=>e in r?b8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ii=(r,e)=>{for(var t in e||(e={}))v8.call(e,t)&&Xo(r,t,e[t]);if(_u)for(var t of _u(e))E8.call(e,t)&&Xo(r,t,e[t]);return r},me=(r,e,t)=>Xo(r,typeof e!="symbol"?e+"":e,t);class _8 extends ey{constructor(e,t,i=!0){super(e,t,i),this.core=e,this.logger=t,me(this,"context",_x),me(this,"storagePrefix",At),me(this,"storageVersion",Ex),me(this,"events",new Map),me(this,"shouldPersist",!1),me(this,"init",async()=>{if(!ma())try{const s={eventId:sh(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:pf(this.core.relayer.protocol,this.core.relayer.version,Ho)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),me(this,"createEvent",s=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=s,h=sh(),u=this.core.projectId||"",l=Date.now(),f=Ii({eventId:h,timestamp:l,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(h));return this.telemetryEnabled&&(this.events.set(h,f),this.shouldPersist=!0),f}),me(this,"getEvent",s=>{const{eventId:n,topic:o}=s;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Ii(Ii({},a),this.setMethods(a.eventId))}),me(this,"deleteEvent",s=>{const{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0}),me(this,"setEventListeners",()=>{this.core.heartbeat.on($r.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{L.fromMiliseconds(Date.now())-L.fromMiliseconds(s.timestamp)>xx&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),me(this,"setMethods",s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)})),me(this,"addTrace",(s,n)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(n),this.events.set(s,o),this.shouldPersist=!0)}),me(this,"setError",(s,n)=>{const o=this.events.get(s);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),me(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),me(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,Ii(Ii({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}}),me(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[n,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),me(this,"sendEvent",async s=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${Ix}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Ho}${n}`,{method:"POST",body:JSON.stringify(s)})}),me(this,"getAppDomain",()=>df().url),this.logger=Ue(t,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var x8=Object.defineProperty,xu=Object.getOwnPropertySymbols,I8=Object.prototype.hasOwnProperty,S8=Object.prototype.propertyIsEnumerable,Qo=(r,e,t)=>e in r?x8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Iu=(r,e)=>{for(var t in e||(e={}))I8.call(e,t)&&Qo(r,t,e[t]);if(xu)for(var t of xu(e))S8.call(e,t)&&Qo(r,t,e[t]);return r},oe=(r,e,t)=>Qo(r,typeof e!="symbol"?e+"":e,t);let D8=class Cd extends Mg{constructor(e){var t;super(e),oe(this,"protocol",gd),oe(this,"version",yd),oe(this,"name",zo),oe(this,"relayUrl"),oe(this,"projectId"),oe(this,"customStoragePrefix"),oe(this,"events",new ct.EventEmitter),oe(this,"logger"),oe(this,"heartbeat"),oe(this,"relayer"),oe(this,"crypto"),oe(this,"storage"),oe(this,"history"),oe(this,"expirer"),oe(this,"pairing"),oe(this,"verify"),oe(this,"echoClient"),oe(this,"linkModeSupportedApps"),oe(this,"eventClient"),oe(this,"initialized",!1),oe(this,"logChunkController"),oe(this,"on",(a,c)=>this.events.on(a,c)),oe(this,"once",(a,c)=>this.events.once(a,c)),oe(this,"off",(a,c)=>this.events.off(a,c)),oe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),oe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:h})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:ae.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:h})});const i=this.getGlobalCore(e?.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||md,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=Ks({level:typeof e?.logger=="string"&&e.logger?e.logger:V3.logger,name:zo}),{logger:n,chunkLoggerController:o}=jg({opts:s,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(t=this.logChunkController)!=null&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Ue(n,this.name),this.heartbeat=new Fp,this.crypto=new QI(this,this.logger,e?.keychain),this.history=new h8(this,this.logger),this.expirer=new f8(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Eg(Iu(Iu({},K3),e?.storageOptions)),this.relayer=new DS({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new o8(this,this.logger),this.verify=new g8(this,this.logger,this.storage),this.echoClient=new m8(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new _8(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const t=new Cd(e);await t.initialize();const i=await t.crypto.getClientId();return await t.storage.setItem(ox,i),t}get context(){return Ke(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(ru,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(ru)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const t=`_walletConnectCore_${e}`,i=`${t}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[t]}catch(t){console.warn("Failed to get global WalletConnect core",t);return}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${((t=e.opts)==null?void 0:t.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&H3.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const $8=D8,Td="wc",Rd=2,Bd="client",Ba=`${Td}@${Rd}:${Bd}:`,Qn={name:Bd,logger:"error"},Su="WALLETCONNECT_DEEPLINK_CHOICE",O8="proposal",Du="Proposal expired",P8="session",Fr=L.SEVEN_DAYS,A8="engine",Se={wc_sessionPropose:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1104},res:{ttl:L.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1106},res:{ttl:L.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1112},res:{ttl:L.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1114},res:{ttl:L.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:L.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:L.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1119}}},eo={min:L.FIVE_MINUTES,max:L.SEVEN_DAYS},Et={idle:"IDLE",active:"ACTIVE"},C8={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},T8="request",R8=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],B8="wc",N8="auth",U8="authKeys",k8="pairingTopics",j8="requests",hn=`${B8}@${1.5}:${N8}:`,Ps=`${hn}:PUB_KEY`;var F8=Object.defineProperty,L8=Object.defineProperties,M8=Object.getOwnPropertyDescriptors,$u=Object.getOwnPropertySymbols,q8=Object.prototype.hasOwnProperty,z8=Object.prototype.propertyIsEnumerable,ea=(r,e,t)=>e in r?F8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ie=(r,e)=>{for(var t in e||(e={}))q8.call(e,t)&&ea(r,t,e[t]);if($u)for(var t of $u(e))z8.call(e,t)&&ea(r,t,e[t]);return r},Re=(r,e)=>L8(r,M8(e)),j=(r,e,t)=>ea(r,typeof e!="symbol"?e+"":e,t);let H8=class extends sy{constructor(e){super(e),j(this,"name",A8),j(this,"events",new oa),j(this,"initialized",!1),j(this,"requestQueue",{state:Et.idle,queue:[]}),j(this,"sessionRequestQueue",{state:Et.idle,queue:[]}),j(this,"emittedSessionRequests",new fv({limit:500})),j(this,"requestQueueDelay",L.ONE_SECOND),j(this,"expectedPairingMethodMap",new Map),j(this,"recentlyDeletedMap",new Map),j(this,"recentlyDeletedLimit",200),j(this,"relayMessageCache",[]),j(this,"pendingSessions",new Map),j(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Se)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},L.toMiliseconds(this.requestQueueDelay)))}),j(this,"connect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=Re(ie({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(i),i.optionalNamespaces=d_(i.requiredNamespaces,i.optionalNamespaces),i.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:h}=i;let u=s,l,f=!1;try{if(u){const m=this.client.core.pairing.pairings.get(u);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),f=m.active}}catch(m){throw this.client.logger.error(`connect() -> pairing.get(${u}) failed`),m}if(!u||!f){const{topic:m,uri:O}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});u=m,l=O}if(!u){const{message:m}=F("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(m)}const p=await this.client.core.crypto.generateKeyPair(),d=Se.wc_sessionPropose.req.ttl||L.FIVE_MINUTES,g=de(d),y=Re(ie(ie({requiredNamespaces:n,optionalNamespaces:o,relays:h??[{protocol:wd}],proposer:{publicKey:p,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:u},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:xt()}),x=re("session_connect",y.id),{reject:S,resolve:E,done:I}=pr(d,Du),_=({id:m})=>{m===y.id&&(this.client.events.off("proposal_expire",_),this.pendingSessions.delete(y.id),this.events.emit(x,{error:{message:Du,code:0}}))};return this.client.events.on("proposal_expire",_),this.events.once(x,({error:m,session:O})=>{this.client.events.off("proposal_expire",_),m?S(m):O&&E(O)}),await this.sendProposeSession({proposal:y,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:y.id}}}),await this.setProposal(y.id,y),{uri:l,approval:I}}),j(this,"pair",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(t)}catch(i){throw this.client.logger.error("pair() failed"),i}}),j(this,"approve",async t=>{var i,s,n;const o=this.client.core.eventClient.createEvent({properties:{topic:(i=t?.id)==null?void 0:i.toString(),trace:[Qt.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(b){throw o.setError(Ei.no_internet_connection),b}try{await this.isValidProposalId(t?.id)}catch(b){throw this.client.logger.error(`approve() -> proposal.get(${t?.id}) failed`),o.setError(Ei.proposal_not_found),b}try{await this.isValidApprove(t)}catch(b){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Ei.session_approve_namespace_validation_failure),b}const{id:a,relayProtocol:c,namespaces:h,sessionProperties:u,scopedProperties:l,sessionConfig:f}=t,p=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:d,proposer:g,requiredNamespaces:y,optionalNamespaces:x}=p;let S=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:d});S||(S=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:Qt.session_approve_started,properties:{topic:d,trace:[Qt.session_approve_started,Qt.session_namespaces_validation_success]}}));const E=await this.client.core.crypto.generateKeyPair(),I=g.publicKey,_=await this.client.core.crypto.generateSharedKey(E,I),m=ie(ie(ie({relay:{protocol:c??"irn"},namespaces:h,controller:{publicKey:E,metadata:this.client.metadata},expiry:de(Fr)},u&&{sessionProperties:u}),l&&{scopedProperties:l}),f&&{sessionConfig:f}),O=ae.relay;S.addTrace(Qt.subscribing_session_topic);try{await this.client.core.relayer.subscribe(_,{transportType:O,internal:{skipSubscribe:!0}})}catch(b){throw S.setError(Ei.subscribe_session_topic_failure),b}S.addTrace(Qt.subscribe_session_topic_success);const D=Re(ie({},m),{topic:_,requiredNamespaces:y,optionalNamespaces:x,pairingTopic:d,acknowledged:!1,self:m.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:E,transportType:ae.relay});await this.client.session.set(_,D),S.addTrace(Qt.store_session);try{await this.sendApproveSession({sessionTopic:_,proposal:p,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:E},sessionSettleRequest:m,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:a}}}),S.addTrace(Qt.session_approve_publish_success)}catch(b){throw this.client.logger.error(b),this.client.session.delete(_,ce("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(_),b}return this.client.core.eventClient.deleteEvent({eventId:S.eventId}),await this.client.core.pairing.updateMetadata({topic:d,metadata:g.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:d}),await this.setExpiry(_,de(Fr)),{topic:_,acknowledged:()=>Promise.resolve(this.client.session.get(_))}}),j(this,"reject",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(t)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:i,reason:s}=t;let n;try{n=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}n&&await this.sendError({id:i,topic:n,error:s,rpcOpts:Se.wc_sessionPropose.reject}),await this.deleteProposal(i)}),j(this,"update",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(t)}catch(l){throw this.client.logger.error("update() -> isValidUpdate() failed"),l}const{topic:i,namespaces:s}=t,{done:n,resolve:o,reject:a}=pr(),c=xt(),h=sr().toString(),u=this.client.session.get(i).namespaces;return this.events.once(re("session_update",c),({error:l})=>{l?a(l):o()}),await this.client.session.update(i,{namespaces:s}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:h}).catch(l=>{this.client.logger.error(l),this.client.session.update(i,{namespaces:u}),a(l)}),{acknowledged:n}}),j(this,"extend",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(t)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:i}=t,s=xt(),{done:n,resolve:o,reject:a}=pr();return this.events.once(re("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(i,de(Fr)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}}),j(this,"request",async t=>{this.isInitialized();try{await this.isValidRequest(t)}catch(y){throw this.client.logger.error("request() -> isValidRequest() failed"),y}const{chainId:i,request:s,topic:n,expiry:o=Se.wc_sessionRequest.req.ttl}=t,a=this.client.session.get(n);a?.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const c=xt(),h=sr().toString(),{done:u,resolve:l,reject:f}=pr(o,"Request expired. Please try again.");this.events.once(re("session_request",c),({error:y,result:x})=>{y?f(y):l(x)});const p="wc_sessionRequest",d=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(d)return await this.sendRequest({clientRpcId:c,relayRpcId:h,topic:n,method:p,params:{request:Re(ie({},s),{expiryTimestamp:de(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:d}).catch(y=>f(y)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),await u();const g={request:Re(ie({},s),{expiryTimestamp:de(o)}),chainId:i};return await Promise.all([new Promise(async y=>{await this.sendRequest({clientRpcId:c,relayRpcId:h,topic:n,method:p,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(x=>f(x)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),y()}),new Promise(async y=>{var x;if(!((x=a.sessionConfig)!=null&&x.disableDeepLink)){const S=await av(this.client.core.storage,Su);await sv({id:c,topic:n,wcDeepLink:S})}y()}),u()]).then(y=>y[2])}),j(this,"respond",async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:i,response:s}=t,{id:n}=s,o=this.client.session.get(i);o.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);It(s)?await this.sendResult({id:n,topic:i,result:s.result,throwOnFailedPublish:!0,appLink:a}):it(s)&&await this.sendError({id:n,topic:i,error:s.error,appLink:a}),this.cleanupAfterResponse(t)}),j(this,"ping",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(t)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:i}=t;if(this.client.session.keys.includes(i)){const s=xt(),n=sr().toString(),{done:o,resolve:a,reject:c}=pr();this.events.once(re("session_ping",s),({error:h})=>{h?c(h):a()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),j(this,"emit",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(t);const{topic:i,event:s,chainId:n}=t,o=sr().toString(),a=xt();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:s,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),j(this,"disconnect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(t);const{topic:i}=t;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:ce("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:s}=F("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(s)}}),j(this,"find",t=>(this.isInitialized(),this.client.session.getAll().filter(i=>y_(i,t)))),j(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),j(this,"authenticate",async(t,i)=>{var s;this.isInitialized(),this.isValidAuthenticate(t);const n=i&&this.client.core.linkModeSupportedApps.includes(i)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=n?ae.link_mode:ae.relay;o===ae.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:h,domain:u,nonce:l,type:f,exp:p,nbf:d,methods:g=[],expiry:y}=t,x=[...t.resources||[]],{topic:S,uri:E}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:S,uri:E}});const I=await this.client.core.crypto.generateKeyPair(),_=$s(I);if(await Promise.all([this.client.auth.authKeys.set(Ps,{responseTopic:_,publicKey:I}),this.client.auth.pairingTopics.set(_,{topic:_,pairingTopic:S})]),await this.client.core.relayer.subscribe(_,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${S}`),g.length>0){const{namespace:T}=nr(a[0]);let R=x2(T,"request",g);Ds(x)&&(R=S2(R,x.pop())),x.push(R)}const m=y&&y>Se.wc_sessionAuthenticate.req.ttl?y:Se.wc_sessionAuthenticate.req.ttl,O={authPayload:{type:f??"caip122",chains:a,statement:c,aud:h,domain:u,version:"1",nonce:l,iat:new Date().toISOString(),exp:p,nbf:d,resources:x},requester:{publicKey:I,metadata:this.client.metadata},expiryTimestamp:de(m)},D={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},b={requiredNamespaces:{},optionalNamespaces:D,relays:[{protocol:"irn"}],pairingTopic:S,proposer:{publicKey:I,metadata:this.client.metadata},expiryTimestamp:de(Se.wc_sessionPropose.req.ttl),id:xt()},{done:$,resolve:P,reject:C}=pr(m,"Request expired"),U=xt(),N=re("session_connect",b.id),w=re("session_request",U),v=async({error:T,session:R})=>{this.events.off(w,A),T?C(T):R&&P({session:R})},A=async T=>{var R,k,q;if(await this.deletePendingAuthRequest(U,{message:"fulfilled",code:0}),T.error){const G=ce("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return T.error.code===G.code?void 0:(this.events.off(N,v),C(T.error.message))}await this.deleteProposal(b.id),this.events.off(N,v);const{cacaos:H,responder:M}=T.result,V=[],K=[];for(const G of H){await gh({cacao:G,projectId:this.client.core.projectId})||(this.client.logger.error(G,"Signature verification failed"),C(ce("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:he}=G,Ee=Ds(he.resources),hr=[Po(he.iss)],is=Ls(he.iss);if(Ee){const Cr=yh(Ee),ln=wh(Ee);V.push(...Cr),hr.push(...ln)}for(const Cr of hr)K.push(`${Cr}:${is}`)}const te=await this.client.core.crypto.generateSharedKey(I,M.publicKey);let ee;V.length>0&&(ee={topic:te,acknowledged:!0,self:{publicKey:I,metadata:this.client.metadata},peer:M,controller:M.publicKey,expiry:de(Fr),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:S,namespaces:Mh([...new Set(V)],[...new Set(K)]),transportType:o},await this.client.core.relayer.subscribe(te,{transportType:o}),await this.client.session.set(te,ee),S&&await this.client.core.pairing.updateMetadata({topic:S,metadata:M.metadata}),ee=this.client.session.get(te)),(R=this.client.metadata.redirect)!=null&&R.linkMode&&(k=M.metadata.redirect)!=null&&k.linkMode&&(q=M.metadata.redirect)!=null&&q.universal&&i&&(this.client.core.addLinkModeSupportedApp(M.metadata.redirect.universal),this.client.session.update(te,{transportType:ae.link_mode})),P({auths:H,session:ee})};this.events.once(N,v),this.events.once(w,A);let B;try{if(n){const T=gt("wc_sessionAuthenticate",O,U);this.client.core.history.set(S,T);const R=await this.client.core.crypto.encode("",T,{type:ts,encoding:ir});B=ws(i,S,R)}else await Promise.all([this.sendRequest({topic:S,method:"wc_sessionAuthenticate",params:O,expiry:t.expiry,throwOnFailedPublish:!0,clientRpcId:U}),this.sendRequest({topic:S,method:"wc_sessionPropose",params:b,expiry:Se.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:b.id})])}catch(T){throw this.events.off(N,v),this.events.off(w,A),T}return await this.setProposal(b.id,b),await this.setAuthRequest(U,{request:Re(ie({},O),{verifyContext:{}}),pairingTopic:S,transportType:o}),{uri:B??E,response:$}}),j(this,"approveSessionAuthenticate",async t=>{const{id:i,auths:s}=t,n=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[fr.authenticated_session_approve_started]}});try{this.isInitialized()}catch(y){throw n.setError(_i.no_internet_connection),y}const o=this.getPendingAuthRequest(i);if(!o)throw n.setError(_i.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const a=o.transportType||ae.relay;a===ae.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),u=$s(c),l={type:Lt,receiverPublicKey:c,senderPublicKey:h},f=[],p=[];for(const y of s){if(!await gh({cacao:y,projectId:this.client.core.projectId})){n.setError(_i.invalid_cacao);const _=ce("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:u,error:_,encodeOpts:l}),new Error(_.message)}n.addTrace(fr.cacaos_verified);const{p:x}=y,S=Ds(x.resources),E=[Po(x.iss)],I=Ls(x.iss);if(S){const _=yh(S),m=wh(S);f.push(..._),E.push(...m)}for(const _ of E)p.push(`${_}:${I}`)}const d=await this.client.core.crypto.generateSharedKey(h,c);n.addTrace(fr.create_authenticated_session_topic);let g;if(f?.length>0){g={topic:d,acknowledged:!0,self:{publicKey:h,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:de(Fr),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Mh([...new Set(f)],[...new Set(p)]),transportType:a},n.addTrace(fr.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(d,{transportType:a})}catch(y){throw n.setError(_i.subscribe_authenticated_session_topic_failure),y}n.addTrace(fr.subscribe_authenticated_session_topic_success),await this.client.session.set(d,g),n.addTrace(fr.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(fr.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:i,result:{cacaos:s,responder:{publicKey:h,metadata:this.client.metadata}},encodeOpts:l,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(y){throw n.setError(_i.authenticated_session_approve_publish_failure),y}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:g}}),j(this,"rejectSessionAuthenticate",async t=>{this.isInitialized();const{id:i,reason:s}=t,n=this.getPendingAuthRequest(i);if(!n)throw new Error(`Could not find pending auth request with id ${i}`);n.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=$s(o),h={type:Lt,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:i,topic:c,error:s,encodeOpts:h,rpcOpts:Se.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.deleteProposal(i)}),j(this,"formatAuthMessage",t=>{this.isInitialized();const{request:i,iss:s}=t;return Cf(i,s)}),j(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const t=this.relayMessageCache.shift();t&&await this.onRelayMessage(t)}catch(t){this.client.logger.error(t)}},50)}),j(this,"cleanupDuplicatePairings",async t=>{if(t.pairingTopic)try{const i=this.client.core.pairing.pairings.get(t.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===t.peer.metadata.url&&n.topic&&n.topic!==i.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),j(this,"deleteSession",async t=>{var i;const{topic:s,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=t,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,ce("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),n||this.client.core.expirer.del(s),this.client.core.storage.removeItem(Su).catch(h=>this.client.logger.warn(h)),this.getPendingSessionRequests().forEach(h=>{h.topic===s&&this.deletePendingSessionRequest(h.id,ce("USER_DISCONNECTED"))}),s===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=Et.idle),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),j(this,"deleteProposal",async(t,i)=>{if(i)try{const s=this.client.proposal.get(t);this.client.core.eventClient.getEvent({topic:s.pairingTopic})?.setError(Ei.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(t,ce("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"proposal")}),j(this,"deletePendingSessionRequest",async(t,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,i),s?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==t),s&&(this.sessionRequestQueue.state=Et.idle,this.client.events.emit("session_request_expire",{id:t}))}),j(this,"deletePendingAuthRequest",async(t,i,s=!1)=>{await Promise.all([this.client.auth.requests.delete(t,i),s?Promise.resolve():this.client.core.expirer.del(t)])}),j(this,"setExpiry",async(t,i)=>{this.client.session.keys.includes(t)&&(this.client.core.expirer.set(t,i),await this.client.session.update(t,{expiry:i}))}),j(this,"setProposal",async(t,i)=>{this.client.core.expirer.set(t,de(Se.wc_sessionPropose.req.ttl)),await this.client.proposal.set(t,i)}),j(this,"setAuthRequest",async(t,i)=>{const{request:s,pairingTopic:n,transportType:o=ae.relay}=i;this.client.core.expirer.set(t,s.expiryTimestamp),await this.client.auth.requests.set(t,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:t,pairingTopic:n,verifyContext:s.verifyContext,transportType:o})}),j(this,"setPendingSessionRequest",async t=>{const{id:i,topic:s,params:n,verifyContext:o}=t,a=n.request.expiryTimestamp||de(Se.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),await this.client.pendingRequest.set(i,{id:i,topic:s,params:n,verifyContext:o})}),j(this,"sendRequest",async t=>{const{topic:i,method:s,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:h,appLink:u,tvf:l,publishOpts:f={}}=t,p=gt(s,n,c);let d;const g=!!u;try{const S=g?ir:ze;d=await this.client.core.crypto.encode(i,p,{encoding:S})}catch(S){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),S}let y;if(R8.includes(s)){const S=rt(JSON.stringify(p)),E=rt(d);y=await this.client.core.verify.register({id:E,decryptedId:S})}const x=ie(ie({},Se[s].req),f);if(x.attestation=y,o&&(x.ttl=o),a&&(x.id=a),this.client.core.history.set(i,p),g){const S=ws(u,i,d);await global.Linking.openURL(S,this.client.name)}else x.tvf=Re(ie({},l),{correlationId:p.id}),h?(x.internal=Re(ie({},x.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,d,x)):this.client.core.relayer.publish(i,d,x).catch(S=>this.client.logger.error(S));return p.id}),j(this,"sendProposeSession",async t=>{const{proposal:i,publishOpts:s}=t,n=gt("wc_sessionPropose",i,i.id);this.client.core.history.set(i.pairingTopic,n);const o=await this.client.core.crypto.encode(i.pairingTopic,n,{encoding:ze}),a=rt(JSON.stringify(n)),c=rt(o),h=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:i.pairingTopic,sessionProposal:o},opts:Re(ie({},s),{publishMethod:"wc_proposeSession",attestation:h})})}),j(this,"sendApproveSession",async t=>{const{sessionTopic:i,pairingProposalResponse:s,proposal:n,sessionSettleRequest:o,publishOpts:a}=t,c=Vi(n.id,s),h=await this.client.core.crypto.encode(n.pairingTopic,c,{encoding:ze}),u=gt("wc_sessionSettle",o,a?.id),l=await this.client.core.crypto.encode(i,u,{encoding:ze});this.client.core.history.set(i,u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:i,pairingTopic:n.pairingTopic,sessionProposalResponse:h,sessionSettlementRequest:l},opts:Re(ie({},a),{publishMethod:"wc_approveSession"})})}),j(this,"sendResult",async t=>{const{id:i,topic:s,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=t,h=Vi(i,n);let u;const l=c&&typeof(global==null?void 0:global.Linking)<"u";try{const d=l?ir:ze;u=await this.client.core.crypto.encode(s,h,Re(ie({},a||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),d}let f,p;try{f=await this.client.core.history.get(s,i);const d=f.request;try{p=this.getTVFParams(i,d.params,n)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g?.message}`)}}catch(d){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${i}) failed`),d}if(l){const d=ws(c,s,u);await global.Linking.openURL(d,this.client.name)}else{const d=f.request.method,g=Se[d].res;g.tvf=Re(ie({},p),{correlationId:i}),o?(g.internal=Re(ie({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,u,g)):this.client.core.relayer.publish(s,u,g).catch(y=>this.client.logger.error(y))}await this.client.core.history.resolve(h)}),j(this,"sendError",async t=>{const{id:i,topic:s,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=t,h=on(i,n);let u;const l=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=l?ir:ze;u=await this.client.core.crypto.encode(s,h,Re(ie({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),p}let f;try{f=await this.client.core.history.get(s,i)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${s}, ${i}) failed`),p}if(l){const p=ws(c,s,u);await global.Linking.openURL(p,this.client.name)}else{const p=f.request.method,d=a||Se[p].res;this.client.core.relayer.publish(s,u,d)}await this.client.core.history.resolve(h)}),j(this,"cleanup",async()=>{const t=[],i=[];this.client.session.getAll().forEach(s=>{let n=!1;Dt(s.expiry)&&(n=!0),this.client.core.crypto.keychain.has(s.topic)||(n=!0),n&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Dt(s.expiryTimestamp)&&i.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession({topic:s})),...i.map(s=>this.deleteProposal(s))])}),j(this,"onProviderMessageEvent",async t=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(t):await this.onRelayMessage(t)}),j(this,"onRelayEventRequest",async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()}),j(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Et.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Et.active;const t=this.requestQueue.queue.shift();if(t)try{await this.processRequest(t)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=Et.idle}),j(this,"processRequest",async t=>{const{topic:i,payload:s,attestation:n,transportType:o,encryptedId:a}=t,c=s.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:s,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,s);case"wc_sessionPing":return await this.onSessionPingRequest(i,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(i,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),j(this,"onRelayEventResponse",async t=>{const{topic:i,payload:s,transportType:n}=t,o=(await this.client.core.history.get(i,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),j(this,"onRelayEventUnknownPayload",t=>{const{topic:i}=t,{message:s}=F("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),j(this,"shouldIgnorePairingRequest",t=>{const{topic:i,requestMethod:s}=t,n=this.expectedPairingMethodMap.get(i);return!n||n.includes(s)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),j(this,"onSessionProposeRequest",async t=>{const{topic:i,payload:s,attestation:n,encryptedId:o}=t,{params:a,id:c}=s;try{const h=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),h?.setError(jt.proposal_listener_not_found)),this.isValidConnect(ie({},s.params));const u=a.expiryTimestamp||de(Se.wc_sessionPropose.req.ttl),l=ie({id:c,pairingTopic:i,expiryTimestamp:u,attestation:n,encryptedId:o},a);await this.setProposal(c,l);const f=await this.getVerifyContext({attestationId:n,hash:rt(JSON.stringify(s)),encryptedId:o,metadata:l.proposer.metadata});h?.addTrace(_t.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:l,verifyContext:f})}catch(h){await this.sendError({id:c,topic:i,error:h,rpcOpts:Se.wc_sessionPropose.autoReject}),this.client.logger.error(h)}}),j(this,"onSessionProposeResponse",async(t,i,s)=>{const{id:n}=i;if(It(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const h=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});const u=await this.client.core.crypto.generateSharedKey(c,h);this.pendingSessions.set(n,{sessionTopic:u,pairingTopic:t,proposalId:n,publicKey:c});const l=await this.client.core.relayer.subscribe(u,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),await this.client.core.pairing.activate({topic:t})}else if(it(i)){await this.deleteProposal(n);const o=re("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}}),j(this,"onSessionSettleRequest",async(t,i)=>{const{id:s,params:n}=i;try{this.isValidSessionSettleRequest(n);const{relay:o,controller:a,expiry:c,namespaces:h,sessionProperties:u,scopedProperties:l,sessionConfig:f}=i.params,p=[...this.pendingSessions.values()].find(y=>y.sessionTopic===t);if(!p)return this.client.logger.error(`Pending session not found for topic ${t}`);const d=this.client.proposal.get(p.proposalId),g=Re(ie(ie(ie({topic:t,relay:o,expiry:c,namespaces:h,acknowledged:!0,pairingTopic:p.pairingTopic,requiredNamespaces:d.requiredNamespaces,optionalNamespaces:d.optionalNamespaces,controller:a.publicKey,self:{publicKey:p.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),l&&{scopedProperties:l}),f&&{sessionConfig:f}),{transportType:ae.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:p.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(re("session_connect",p.proposalId),{session:g}),this.pendingSessions.delete(p.proposalId),this.deleteProposal(p.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:i.id,topic:t,result:!0})}catch(o){await this.sendError({id:s,topic:t,error:o}),this.client.logger.error(o)}}),j(this,"onSessionSettleResponse",async(t,i)=>{const{id:s}=i;It(i)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(re("session_approve",s),{})):it(i)&&(await this.client.session.delete(t,ce("USER_DISCONNECTED")),this.events.emit(re("session_approve",s),{error:i.error}))}),j(this,"onSessionUpdateRequest",async(t,i)=>{const{params:s,id:n}=i;try{const o=`${t}_session_update`,a=bi.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:t,error:ce("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ie({topic:t},s));try{bi.set(o,n),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult({id:n,topic:t,result:!0})}catch(c){throw bi.delete(o),c}this.client.events.emit("session_update",{id:n,topic:t,params:s})}catch(o){await this.sendError({id:n,topic:t,error:o}),this.client.logger.error(o)}}),j(this,"isRequestOutOfSync",(t,i)=>i.toString().slice(0,-3)<t.toString().slice(0,-3)),j(this,"onSessionUpdateResponse",(t,i)=>{const{id:s}=i,n=re("session_update",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);It(i)?this.events.emit(re("session_update",s),{}):it(i)&&this.events.emit(re("session_update",s),{error:i.error})}),j(this,"onSessionExtendRequest",async(t,i)=>{const{id:s}=i;try{this.isValidExtend({topic:t}),await this.setExpiry(t,de(Fr)),await this.sendResult({id:s,topic:t,result:!0}),this.client.events.emit("session_extend",{id:s,topic:t})}catch(n){await this.sendError({id:s,topic:t,error:n}),this.client.logger.error(n)}}),j(this,"onSessionExtendResponse",(t,i)=>{const{id:s}=i,n=re("session_extend",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);It(i)?this.events.emit(re("session_extend",s),{}):it(i)&&this.events.emit(re("session_extend",s),{error:i.error})}),j(this,"onSessionPingRequest",async(t,i)=>{const{id:s}=i;try{this.isValidPing({topic:t}),await this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:t})}catch(n){await this.sendError({id:s,topic:t,error:n}),this.client.logger.error(n)}}),j(this,"onSessionPingResponse",(t,i)=>{const{id:s}=i,n=re("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);It(i)?this.events.emit(re("session_ping",s),{}):it(i)&&this.events.emit(re("session_ping",s),{error:i.error})},500)}),j(this,"onSessionDeleteRequest",async(t,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:t,reason:i.params}),await Promise.all([new Promise(n=>{this.client.core.relayer.once(ue.publish,async()=>{n(await this.deleteSession({topic:t,id:s}))})}),this.sendResult({id:s,topic:t,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:t,error:ce("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),j(this,"onSessionRequest",async t=>{var i,s,n;const{topic:o,payload:a,attestation:c,encryptedId:h,transportType:u}=t,{id:l,params:f}=a;try{await this.isValidRequest(ie({topic:o},f));const p=this.client.session.get(o),d=await this.getVerifyContext({attestationId:c,hash:rt(JSON.stringify(gt("wc_sessionRequest",f,l))),encryptedId:h,metadata:p.peer.metadata,transportType:u}),g={id:l,topic:o,params:f,verifyContext:d};await this.setPendingSessionRequest(g),u===ae.link_mode&&(i=p.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((s=p.peer.metadata.redirect)==null?void 0:s.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(p){await this.sendError({id:l,topic:o,error:p}),this.client.logger.error(p)}}),j(this,"onSessionRequestResponse",(t,i)=>{const{id:s}=i,n=re("session_request",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);It(i)?this.events.emit(re("session_request",s),{result:i.result}):it(i)&&this.events.emit(re("session_request",s),{error:i.error})}),j(this,"onSessionEventRequest",async(t,i)=>{const{id:s,params:n}=i;try{const o=`${t}_session_event_${n.event.name}`,a=bi.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(ie({topic:t},n)),this.client.events.emit("session_event",{id:s,topic:t,params:n}),bi.set(o,s)}catch(o){await this.sendError({id:s,topic:t,error:o}),this.client.logger.error(o)}}),j(this,"onSessionAuthenticateResponse",(t,i)=>{const{id:s}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:t,payload:i}),It(i)?this.events.emit(re("session_request",s),{result:i.result}):it(i)&&this.events.emit(re("session_request",s),{error:i.error})}),j(this,"onSessionAuthenticateRequest",async t=>{var i;const{topic:s,payload:n,attestation:o,encryptedId:a,transportType:c}=t;try{const{requester:h,authPayload:u,expiryTimestamp:l}=n.params,f=await this.getVerifyContext({attestationId:o,hash:rt(JSON.stringify(n)),encryptedId:a,metadata:h.metadata,transportType:c}),p={requester:h,pairingTopic:s,id:n.id,authPayload:u,verifyContext:f,expiryTimestamp:l};await this.setAuthRequest(n.id,{request:p,pairingTopic:s,transportType:c}),c===ae.link_mode&&(i=h.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(h.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:n.params,id:n.id,verifyContext:f})}catch(h){this.client.logger.error(h);const u=n.params.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(n.params.requester.metadata,c),p={type:Lt,receiverPublicKey:u,senderPublicKey:l};await this.sendError({id:n.id,topic:s,error:h,encodeOpts:p,rpcOpts:Se.wc_sessionAuthenticate.autoReject,appLink:f})}}),j(this,"addSessionRequestToSessionRequestQueue",t=>{this.sessionRequestQueue.queue.push(t)}),j(this,"cleanupAfterResponse",t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Et.idle,this.processSessionRequestQueue()},L.toMiliseconds(this.requestQueueDelay))}),j(this,"cleanupPendingSentRequestsForTopic",({topic:t,error:i})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(n=>n.topic===t&&n.request.method==="wc_sessionRequest").forEach(n=>{const o=n.request.id,a=re("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(re("session_request",n.request.id),{error:i})})}),j(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Et.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(t)}catch(i){this.client.logger.error(i)}}),j(this,"emitSessionRequest",t=>{if(this.emittedSessionRequests.has(t.id)){this.client.logger.warn({id:t.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${t.id}`);return}this.sessionRequestQueue.state=Et.active,this.emittedSessionRequests.add(t.id),this.client.events.emit("session_request",t)}),j(this,"onPairingCreated",t=>{if(t.methods&&this.expectedPairingMethodMap.set(t.topic,t.methods),t.active)return;const i=this.client.proposal.getAll().find(s=>s.pairingTopic===t.topic);i&&this.onSessionProposeRequest({topic:t.topic,payload:gt("wc_sessionPropose",Re(ie({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id),attestation:i.attestation,encryptedId:i.encryptedId})}),j(this,"isValidConnect",async t=>{if(!Le(t)){const{message:h}=F("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(h)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=t;if(we(i)||await this.isValidPairingTopic(i),!O_(c)){const{message:h}=F("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(h)}if(!we(s)&&Pt(s)!==0){const h="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(h):this.client.logger.warn(h),this.validateNamespaces(s,"requiredNamespaces")}if(!we(n)&&Pt(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),we(o)||this.validateSessionProps(o,"sessionProperties"),!we(a)){this.validateSessionProps(a,"scopedProperties");const h=Object.keys(s||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(u=>h.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(h)}`)}}),j(this,"validateNamespaces",(t,i)=>{const s=$_(t,"connect()",i);if(s)throw new Error(s.message)}),j(this,"isValidApprove",async t=>{if(!Le(t))throw new Error(F("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:i,namespaces:s,relayProtocol:n,sessionProperties:o,scopedProperties:a}=t;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const c=this.client.proposal.get(i),h=Wn(s,"approve()");if(h)throw new Error(h.message);const u=Hh(c.requiredNamespaces,s,"approve()");if(u)throw new Error(u.message);if(!pe(n,!0)){const{message:l}=F("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(l)}if(we(o)||this.validateSessionProps(o,"sessionProperties"),!we(a)){this.validateSessionProps(a,"scopedProperties");const l=new Set(Object.keys(s));if(!Object.keys(a).every(f=>l.has(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(l).join(", ")}`)}}),j(this,"isValidReject",async t=>{if(!Le(t)){const{message:n}=F("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(n)}const{id:i,reason:s}=t;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!A_(s)){const{message:n}=F("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(n)}}),j(this,"isValidSessionSettleRequest",t=>{if(!Le(t)){const{message:h}=F("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(h)}const{relay:i,controller:s,namespaces:n,expiry:o}=t;if(!cd(i)){const{message:h}=F("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(h)}const a=E_(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Wn(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Dt(o)){const{message:h}=F("EXPIRED","onSessionSettleRequest()");throw new Error(h)}}),j(this,"isValidUpdate",async t=>{if(!Le(t)){const{message:c}=F("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(c)}const{topic:i,namespaces:s}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const n=this.client.session.get(i),o=Wn(s,"update()");if(o)throw new Error(o.message);const a=Hh(n.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),j(this,"isValidExtend",async t=>{if(!Le(t)){const{message:s}=F("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:i}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),j(this,"isValidRequest",async t=>{if(!Le(t)){const{message:c}=F("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(c)}const{topic:i,request:s,chainId:n,expiry:o}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!zh(a,n)){const{message:c}=F("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!C_(s)){const{message:c}=F("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!B_(a,n,s.method)){const{message:c}=F("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}if(o&&!j_(o,eo)){const{message:c}=F("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${eo.min} and ${eo.max}`);throw new Error(c)}}),j(this,"isValidRespond",async t=>{var i;if(!Le(t)){const{message:o}=F("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(o)}const{topic:s,response:n}=t;try{await this.isValidSessionTopic(s)}catch(o){throw(i=t?.response)!=null&&i.id&&this.cleanupAfterResponse(t),o}if(!T_(n)){const{message:o}=F("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}}),j(this,"isValidPing",async t=>{if(!Le(t)){const{message:s}=F("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)}),j(this,"isValidEmit",async t=>{if(!Le(t)){const{message:a}=F("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(a)}const{topic:i,event:s,chainId:n}=t;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!zh(o,n)){const{message:a}=F("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!R_(s)){const{message:a}=F("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!N_(o,n,s.name)){const{message:a}=F("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),j(this,"isValidDisconnect",async t=>{if(!Le(t)){const{message:s}=F("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)}),j(this,"isValidAuthenticate",t=>{const{chains:i,uri:s,domain:n,nonce:o}=t;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!pe(s,!1))throw new Error("uri is required parameter");if(!pe(n,!1))throw new Error("domain is required parameter");if(!pe(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>nr(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=nr(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),j(this,"getVerifyContext",async t=>{const{attestationId:i,hash:s,encryptedId:n,metadata:o,transportType:a}=t,c={verified:{verifyUrl:o.verifyUrl||Ni,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ae.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const h=await this.client.core.verify.resolve({attestationId:i,hash:s,encryptedId:n,verifyUrl:o.verifyUrl});h&&(c.verified.origin=h.origin,c.verified.isScam=h.isScam,c.verified.validation=h.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.warn(h)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),j(this,"validateSessionProps",(t,i)=>{Object.values(t).forEach((s,n)=>{if(s==null){const{message:o}=F("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${s} for key ${Object.keys(t)[n]}`);throw new Error(o)}})}),j(this,"getPendingAuthRequest",t=>{const i=this.client.auth.requests.get(t);return typeof i=="object"?i:void 0}),j(this,"addToRecentlyDeleted",(t,i)=>{if(this.recentlyDeletedMap.set(t,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const n=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(s++>=n)break;this.recentlyDeletedMap.delete(o)}}}),j(this,"checkRecentlyDeleted",t=>{const i=this.recentlyDeletedMap.get(t);if(i){const{message:s}=F("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${t}`);throw new Error(s)}}),j(this,"isLinkModeEnabled",(t,i)=>{var s,n,o,a,c,h,u,l,f;return!t||i!==ae.link_mode?!1:((n=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((h=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:h.universal)!==""&&((u=t?.redirect)==null?void 0:u.universal)!==void 0&&((l=t?.redirect)==null?void 0:l.universal)!==""&&((f=t?.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),j(this,"getAppLinkIfEnabled",(t,i)=>{var s;return this.isLinkModeEnabled(t,i)?(s=t?.redirect)==null?void 0:s.universal:void 0}),j(this,"handleLinkModeMessage",({url:t})=>{if(!t||!t.includes("wc_ev")||!t.includes("topic"))return;const i=ih(t,"topic")||"",s=decodeURIComponent(ih(t,"wc_ev")||""),n=this.client.session.keys.includes(i);n&&this.client.session.update(i,{transportType:ae.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:s,sessionExists:n})}),j(this,"registerLinkModeListeners",async()=>{var t;if(ma()||cr()&&(t=this.client.metadata.redirect)!=null&&t.linkMode){const i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await i.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),j(this,"getTVFParams",(t,i,s)=>{var n,o,a;if(!((n=i.request)!=null&&n.method))return{};const c={correlationId:t,rpcMethods:[i.request.method],chainId:i.chainId};try{const h=this.extractTxHashesFromResult(i.request,s);c.txHashes=h,c.contractAddresses=this.isValidContractData(i.request.params)?[(a=(o=i.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(h){this.client.logger.warn("Error getting TVF params",h)}return c}),j(this,"isValidContractData",t=>{var i;if(!t)return!1;try{const s=t?.data||((i=t?.[0])==null?void 0:i.data);if(!s.startsWith("0x"))return!1;const n=s.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),j(this,"extractTxHashesFromResult",(t,i)=>{var s;try{if(!i)return[];const n=t.method,o=C8[n];if(n==="sui_signTransaction")return[a2(i.transactionBytes)];if(n==="near_signTransaction")return[lh(i)];if(n==="near_signTransactions")return i.map(c=>lh(c));if(n==="xrpl_signTransactionFor"||n==="xrpl_signTransaction")return[(s=i.tx_json)==null?void 0:s.hash];if(n==="polkadot_signTransaction")return[Q_({transaction:t.params.transactionPayload,signature:i.signature})];if(n==="algo_signTxn")return Mt(i)?i.map(c=>fh(c)):[fh(i)];if(n==="cosmos_signDirect")return[h2(i)];if(typeof i=="string")return[i];const a=i[o.key];if(Mt(a))return n==="solana_signAllTransactions"?a.map(c=>o2(c)):a;if(typeof a=="string")return[a]}catch(n){this.client.logger.warn("Error extracting tx hashes from result",n)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,s]of Object.entries(t))for(const n of s)try{await this.onProviderMessageEvent({topic:i,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${n}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(ue.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:t,message:i,attestation:s,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Ps)?this.client.auth.authKeys.get(Ps):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(t,i,{receiverPublicKey:o,encoding:n===ae.link_mode?ir:ze});Ra(a)?(this.client.core.history.set(t,a),await this.onRelayEventRequest({topic:t,payload:a,attestation:s,transportType:n,encryptedId:rt(i)})):an(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a,transportType:n}),this.client.core.history.delete(t,a.id)):await this.onRelayEventUnknownPayload({topic:t,payload:a,transportType:n}),await this.client.core.relayer.messages.ack(t,i)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(tt.expired,async e=>{const{topic:t,id:i}=yf(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,F("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,F("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(yr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(yr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!pe(e,!1)){const{message:t}=F("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=F("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Dt(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=F("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!pe(e,!1)){const{message:t}=F("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:t}=F("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(Dt(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:t}=F("EXPIRED",`session topic: ${e}`);throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){const{message:t}=F("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(pe(e,!1)){const{message:t}=F("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=F("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!P_(e)){const{message:t}=F("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=F("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(Dt(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:t}=F("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}};class V8 extends Pr{constructor(e,t){super(e,t,O8,Ba),this.core=e,this.logger=t}}let K8=class extends Pr{constructor(e,t){super(e,t,P8,Ba),this.core=e,this.logger=t}},W8=class extends Pr{constructor(e,t){super(e,t,T8,Ba,i=>i.id),this.core=e,this.logger=t}},G8=class extends Pr{constructor(e,t){super(e,t,U8,hn,()=>Ps),this.core=e,this.logger=t}},Y8=class extends Pr{constructor(e,t){super(e,t,k8,hn),this.core=e,this.logger=t}},J8=class extends Pr{constructor(e,t){super(e,t,j8,hn,i=>i.id),this.core=e,this.logger=t}};var Z8=Object.defineProperty,X8=(r,e,t)=>e in r?Z8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,to=(r,e,t)=>X8(r,typeof e!="symbol"?e+"":e,t);class Q8{constructor(e,t){this.core=e,this.logger=t,to(this,"authKeys"),to(this,"pairingTopics"),to(this,"requests"),this.authKeys=new G8(this.core,this.logger),this.pairingTopics=new Y8(this.core,this.logger),this.requests=new J8(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var eD=Object.defineProperty,tD=(r,e,t)=>e in r?eD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,J=(r,e,t)=>tD(r,typeof e!="symbol"?e+"":e,t);let rD=class Nd extends iy{constructor(e){super(e),J(this,"protocol",Td),J(this,"version",Rd),J(this,"name",Qn.name),J(this,"metadata"),J(this,"core"),J(this,"logger"),J(this,"events",new ct.EventEmitter),J(this,"engine"),J(this,"session"),J(this,"proposal"),J(this,"pendingRequest"),J(this,"auth"),J(this,"signConfig"),J(this,"on",(i,s)=>this.events.on(i,s)),J(this,"once",(i,s)=>this.events.once(i,s)),J(this,"off",(i,s)=>this.events.off(i,s)),J(this,"removeListener",(i,s)=>this.events.removeListener(i,s)),J(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),J(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}}),J(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}}),J(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}}),J(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}}),J(this,"update",async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}}),J(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}}),J(this,"request",async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}}),J(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}}),J(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}}),J(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}}),J(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}}),J(this,"find",i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}}),J(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),J(this,"authenticate",async(i,s)=>{try{return await this.engine.authenticate(i,s)}catch(n){throw this.logger.error(n.message),n}}),J(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(s){throw this.logger.error(s.message),s}}),J(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),J(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),this.name=e?.name||Qn.name,this.metadata=X1(e?.metadata),this.signConfig=e?.signConfig;const t=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:Wi(Ks({level:e?.logger||Qn.logger}));this.core=e?.core||new $8(e),this.logger=Ue(t,this.name),this.session=new K8(this.core,this.logger),this.proposal=new V8(this.core,this.logger),this.pendingRequest=new W8(this.core,this.logger),this.engine=new H8(this),this.auth=new Q8(this.core,this.logger)}static async init(e){const t=new Nd(e);return await t.initialize(),t}get context(){return Ke(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var ms={exports:{}},Ou;function iD(){return Ou||(Ou=1,(function(r,e){var t=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof St<"u"&&St,i=(function(){function n(){this.fetch=!1,this.DOMException=t.DOMException}return n.prototype=t,new n})();(function(n){(function(o){var a=typeof n<"u"&&n||typeof self<"u"&&self||typeof St<"u"&&St||{},c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function h(w){return w&&DataView.prototype.isPrototypeOf(w)}if(c.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(w){return w&&u.indexOf(Object.prototype.toString.call(w))>-1};function f(w){if(typeof w!="string"&&(w=String(w)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(w)||w==="")throw new TypeError('Invalid character in header field name: "'+w+'"');return w.toLowerCase()}function p(w){return typeof w!="string"&&(w=String(w)),w}function d(w){var v={next:function(){var A=w.shift();return{done:A===void 0,value:A}}};return c.iterable&&(v[Symbol.iterator]=function(){return v}),v}function g(w){this.map={},w instanceof g?w.forEach(function(v,A){this.append(A,v)},this):Array.isArray(w)?w.forEach(function(v){if(v.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+v.length);this.append(v[0],v[1])},this):w&&Object.getOwnPropertyNames(w).forEach(function(v){this.append(v,w[v])},this)}g.prototype.append=function(w,v){w=f(w),v=p(v);var A=this.map[w];this.map[w]=A?A+", "+v:v},g.prototype.delete=function(w){delete this.map[f(w)]},g.prototype.get=function(w){return w=f(w),this.has(w)?this.map[w]:null},g.prototype.has=function(w){return this.map.hasOwnProperty(f(w))},g.prototype.set=function(w,v){this.map[f(w)]=p(v)},g.prototype.forEach=function(w,v){for(var A in this.map)this.map.hasOwnProperty(A)&&w.call(v,this.map[A],A,this)},g.prototype.keys=function(){var w=[];return this.forEach(function(v,A){w.push(A)}),d(w)},g.prototype.values=function(){var w=[];return this.forEach(function(v){w.push(v)}),d(w)},g.prototype.entries=function(){var w=[];return this.forEach(function(v,A){w.push([A,v])}),d(w)},c.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);function y(w){if(!w._noBody){if(w.bodyUsed)return Promise.reject(new TypeError("Already read"));w.bodyUsed=!0}}function x(w){return new Promise(function(v,A){w.onload=function(){v(w.result)},w.onerror=function(){A(w.error)}})}function S(w){var v=new FileReader,A=x(v);return v.readAsArrayBuffer(w),A}function E(w){var v=new FileReader,A=x(v),B=/charset=([A-Za-z0-9_-]+)/.exec(w.type),T=B?B[1]:"utf-8";return v.readAsText(w,T),A}function I(w){for(var v=new Uint8Array(w),A=new Array(v.length),B=0;B<v.length;B++)A[B]=String.fromCharCode(v[B]);return A.join("")}function _(w){if(w.slice)return w.slice(0);var v=new Uint8Array(w.byteLength);return v.set(new Uint8Array(w)),v.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(w){this.bodyUsed=this.bodyUsed,this._bodyInit=w,w?typeof w=="string"?this._bodyText=w:c.blob&&Blob.prototype.isPrototypeOf(w)?this._bodyBlob=w:c.formData&&FormData.prototype.isPrototypeOf(w)?this._bodyFormData=w:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(w)?this._bodyText=w.toString():c.arrayBuffer&&c.blob&&h(w)?(this._bodyArrayBuffer=_(w.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(w)||l(w))?this._bodyArrayBuffer=_(w):this._bodyText=w=Object.prototype.toString.call(w):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof w=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(w)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var w=y(this);if(w)return w;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var w=y(this);return w||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(S);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var w=y(this);if(w)return w;if(this._bodyBlob)return E(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(I(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then($)}),this.json=function(){return this.text().then(JSON.parse)},this}var O=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function D(w){var v=w.toUpperCase();return O.indexOf(v)>-1?v:w}function b(w,v){if(!(this instanceof b))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');v=v||{};var A=v.body;if(w instanceof b){if(w.bodyUsed)throw new TypeError("Already read");this.url=w.url,this.credentials=w.credentials,v.headers||(this.headers=new g(w.headers)),this.method=w.method,this.mode=w.mode,this.signal=w.signal,!A&&w._bodyInit!=null&&(A=w._bodyInit,w.bodyUsed=!0)}else this.url=String(w);if(this.credentials=v.credentials||this.credentials||"same-origin",(v.headers||!this.headers)&&(this.headers=new g(v.headers)),this.method=D(v.method||this.method||"GET"),this.mode=v.mode||this.mode||null,this.signal=v.signal||this.signal||(function(){if("AbortController"in a){var R=new AbortController;return R.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&A)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(A),(this.method==="GET"||this.method==="HEAD")&&(v.cache==="no-store"||v.cache==="no-cache")){var B=/([?&])_=[^&]*/;if(B.test(this.url))this.url=this.url.replace(B,"$1_="+new Date().getTime());else{var T=/\?/;this.url+=(T.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}b.prototype.clone=function(){return new b(this,{body:this._bodyInit})};function $(w){var v=new FormData;return w.trim().split("&").forEach(function(A){if(A){var B=A.split("="),T=B.shift().replace(/\+/g," "),R=B.join("=").replace(/\+/g," ");v.append(decodeURIComponent(T),decodeURIComponent(R))}}),v}function P(w){var v=new g,A=w.replace(/\r?\n[\t ]+/g," ");return A.split("\r").map(function(B){return B.indexOf(`
`)===0?B.substr(1,B.length):B}).forEach(function(B){var T=B.split(":"),R=T.shift().trim();if(R){var k=T.join(":").trim();try{v.append(R,k)}catch(q){console.warn("Response "+q.message)}}}),v}m.call(b.prototype);function C(w,v){if(!(this instanceof C))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(v||(v={}),this.type="default",this.status=v.status===void 0?200:v.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=v.statusText===void 0?"":""+v.statusText,this.headers=new g(v.headers),this.url=v.url||"",this._initBody(w)}m.call(C.prototype),C.prototype.clone=function(){return new C(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},C.error=function(){var w=new C(null,{status:200,statusText:""});return w.ok=!1,w.status=0,w.type="error",w};var U=[301,302,303,307,308];C.redirect=function(w,v){if(U.indexOf(v)===-1)throw new RangeError("Invalid status code");return new C(null,{status:v,headers:{location:w}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(v,A){this.message=v,this.name=A;var B=Error(v);this.stack=B.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function N(w,v){return new Promise(function(A,B){var T=new b(w,v);if(T.signal&&T.signal.aborted)return B(new o.DOMException("Aborted","AbortError"));var R=new XMLHttpRequest;function k(){R.abort()}R.onload=function(){var M={statusText:R.statusText,headers:P(R.getAllResponseHeaders()||"")};T.url.indexOf("file://")===0&&(R.status<200||R.status>599)?M.status=200:M.status=R.status,M.url="responseURL"in R?R.responseURL:M.headers.get("X-Request-URL");var V="response"in R?R.response:R.responseText;setTimeout(function(){A(new C(V,M))},0)},R.onerror=function(){setTimeout(function(){B(new TypeError("Network request failed"))},0)},R.ontimeout=function(){setTimeout(function(){B(new TypeError("Network request timed out"))},0)},R.onabort=function(){setTimeout(function(){B(new o.DOMException("Aborted","AbortError"))},0)};function q(M){try{return M===""&&a.location.href?a.location.href:M}catch{return M}}if(R.open(T.method,q(T.url),!0),T.credentials==="include"?R.withCredentials=!0:T.credentials==="omit"&&(R.withCredentials=!1),"responseType"in R&&(c.blob?R.responseType="blob":c.arrayBuffer&&(R.responseType="arraybuffer")),v&&typeof v.headers=="object"&&!(v.headers instanceof g||a.Headers&&v.headers instanceof a.Headers)){var H=[];Object.getOwnPropertyNames(v.headers).forEach(function(M){H.push(f(M)),R.setRequestHeader(M,p(v.headers[M]))}),T.headers.forEach(function(M,V){H.indexOf(V)===-1&&R.setRequestHeader(V,M)})}else T.headers.forEach(function(M,V){R.setRequestHeader(V,M)});T.signal&&(T.signal.addEventListener("abort",k),R.onreadystatechange=function(){R.readyState===4&&T.signal.removeEventListener("abort",k)}),R.send(typeof T._bodyInit>"u"?null:T._bodyInit)})}return N.polyfill=!0,a.fetch||(a.fetch=N,a.Headers=g,a.Request=b,a.Response=C),o.Headers=g,o.Request=b,o.Response=C,o.fetch=N,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var s=t.fetch?t:i;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,r.exports=e})(ms,ms.exports)),ms.exports}var sD=iD();const Pu=sa(sD);var nD=Object.defineProperty,oD=Object.defineProperties,aD=Object.getOwnPropertyDescriptors,Au=Object.getOwnPropertySymbols,cD=Object.prototype.hasOwnProperty,hD=Object.prototype.propertyIsEnumerable,Cu=(r,e,t)=>e in r?nD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Tu=(r,e)=>{for(var t in e||(e={}))cD.call(e,t)&&Cu(r,t,e[t]);if(Au)for(var t of Au(e))hD.call(e,t)&&Cu(r,t,e[t]);return r},Ru=(r,e)=>oD(r,aD(e));const uD={Accept:"application/json","Content-Type":"application/json"},lD="POST",Bu={headers:uD,method:lD},Nu=10;let wt=class{constructor(e,t=!1){if(this.url=e,this.disableProviderPing=t,this.events=new ct.EventEmitter,this.isAvailable=!1,this.registering=!1,!Zh(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=t}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const t=qt(e),i=await(await Pu(this.url,Ru(Tu({},Bu),{body:t}))).json();this.onPayload({data:i})}catch(t){this.onError(e.id,t)}}async register(e=this.url){if(!Zh(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const t=qt({id:1,jsonrpc:"2.0",method:"test",params:[]});await Pu(e,Ru(Tu({},Bu),{body:t}))}this.onOpen()}catch(t){const i=this.parseError(t);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?_r(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),s=i.message||i.toString(),n=on(e,s);this.events.emit("payload",n)}parseError(e,t=this.url){return ld(e,t,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Nu&&this.events.setMaxListeners(Nu)}};const Uu="error",fD="wss://relay.walletconnect.org",dD="wc",pD="universal_provider",bs=`${dD}@2:${pD}:`,Ud="https://rpc.walletconnect.org/v1/",kd="generic",gD=`${Ud}bundler`,ei="call_status",yD=86400,ut={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function Na(r){return r==null||typeof r!="object"&&typeof r!="function"}function jd(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function Fd(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const wD="[object RegExp]",Ld="[object String]",Md="[object Number]",qd="[object Boolean]",zd="[object Arguments]",mD="[object Symbol]",bD="[object Date]",vD="[object Map]",ED="[object Set]",_D="[object Array]",xD="[object ArrayBuffer]",ID="[object Object]",SD="[object DataView]",DD="[object Uint8Array]",$D="[object Uint8ClampedArray]",OD="[object Uint16Array]",PD="[object Uint32Array]",AD="[object Int8Array]",CD="[object Int16Array]",TD="[object Int32Array]",RD="[object Float32Array]",BD="[object Float64Array]";function Ua(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function ND(r,e){return Qr(r,void 0,r,new Map,e)}function Qr(r,e,t,i=new Map,s=void 0){const n=s?.(r,e,t,i);if(n!=null)return n;if(Na(r))return r;if(i.has(r))return i.get(r);if(Array.isArray(r)){const o=new Array(r.length);i.set(r,o);for(let a=0;a<r.length;a++)o[a]=Qr(r[a],a,t,i,s);return Object.hasOwn(r,"index")&&(o.index=r.index),Object.hasOwn(r,"input")&&(o.input=r.input),o}if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp){const o=new RegExp(r.source,r.flags);return o.lastIndex=r.lastIndex,o}if(r instanceof Map){const o=new Map;i.set(r,o);for(const[a,c]of r)o.set(a,Qr(c,a,t,i,s));return o}if(r instanceof Set){const o=new Set;i.set(r,o);for(const a of r)o.add(Qr(a,void 0,t,i,s));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(r))return r.subarray();if(Ua(r)){const o=new(Object.getPrototypeOf(r)).constructor(r.length);i.set(r,o);for(let a=0;a<r.length;a++)o[a]=Qr(r[a],a,t,i,s);return o}if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);if(r instanceof DataView){const o=new DataView(r.buffer.slice(0),r.byteOffset,r.byteLength);return i.set(r,o),wr(o,r,t,i,s),o}if(typeof File<"u"&&r instanceof File){const o=new File([r],r.name,{type:r.type});return i.set(r,o),wr(o,r,t,i,s),o}if(r instanceof Blob){const o=new Blob([r],{type:r.type});return i.set(r,o),wr(o,r,t,i,s),o}if(r instanceof Error){const o=new r.constructor;return i.set(r,o),o.message=r.message,o.name=r.name,o.stack=r.stack,o.cause=r.cause,wr(o,r,t,i,s),o}if(typeof r=="object"&&UD(r)){const o=Object.create(Object.getPrototypeOf(r));return i.set(r,o),wr(o,r,t,i,s),o}return r}function wr(r,e,t=r,i,s){const n=[...Object.keys(e),...jd(e)];for(let o=0;o<n.length;o++){const a=n[o],c=Object.getOwnPropertyDescriptor(r,a);(c==null||c.writable)&&(r[a]=Qr(e[a],a,t,i,s))}}function UD(r){switch(Fd(r)){case zd:case _D:case xD:case SD:case qd:case bD:case RD:case BD:case AD:case CD:case TD:case vD:case Md:case ID:case wD:case ED:case Ld:case mD:case DD:case $D:case OD:case PD:return!0;default:return!1}}function kD(r,e){return ND(r,(t,i,s,n)=>{if(typeof r=="object")switch(Object.prototype.toString.call(r)){case Md:case Ld:case qd:{const o=new r.constructor(r?.valueOf());return wr(o,r),o}case zd:{const o={};return wr(o,r),o.length=r.length,o[Symbol.iterator]=r[Symbol.iterator],o}default:return}})}function ku(r){return kD(r)}function ju(r){return r!==null&&typeof r=="object"&&Fd(r)==="[object Arguments]"}function Fu(r){return typeof r=="object"&&r!==null}function jD(){}function FD(r){return Ua(r)}function LD(r){if(typeof r!="object"||r==null)return!1;if(Object.getPrototypeOf(r)===null)return!0;if(Object.prototype.toString.call(r)!=="[object Object]"){const t=r[Symbol.toStringTag];return t==null||!Object.getOwnPropertyDescriptor(r,Symbol.toStringTag)?.writable?!1:r.toString()===`[object ${t}]`}let e=r;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(r)===e}function MD(r){if(Na(r))return r;if(Array.isArray(r)||Ua(r)||r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);const e=Object.getPrototypeOf(r),t=e.constructor;if(r instanceof Date||r instanceof Map||r instanceof Set)return new t(r);if(r instanceof RegExp){const i=new t(r);return i.lastIndex=r.lastIndex,i}if(r instanceof DataView)return new t(r.buffer.slice(0));if(r instanceof Error){const i=new t(r.message);return i.stack=r.stack,i.name=r.name,i.cause=r.cause,i}if(typeof File<"u"&&r instanceof File)return new t([r],r.name,{type:r.type,lastModified:r.lastModified});if(typeof r=="object"){const i=Object.create(e);return Object.assign(i,r)}return r}function qD(r,...e){const t=e.slice(0,-1),i=e[e.length-1];let s=r;for(let n=0;n<t.length;n++){const o=t[n];s=ta(s,o,i,new Map)}return s}function ta(r,e,t,i){if(Na(r)&&(r=Object(r)),e==null||typeof e!="object")return r;if(i.has(e))return MD(i.get(e));if(i.set(e,r),Array.isArray(e)){e=e.slice();for(let n=0;n<e.length;n++)e[n]=e[n]??void 0}const s=[...Object.keys(e),...jd(e)];for(let n=0;n<s.length;n++){const o=s[n];let a=e[o],c=r[o];if(ju(a)&&(a={...a}),ju(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=ku(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const u=[],l=Reflect.ownKeys(c);for(let f=0;f<l.length;f++){const p=l[f];u[p]=c[p]}c=u}else c=[];const h=t(c,a,o,r,e,i);h!=null?r[o]=h:Array.isArray(a)||Fu(c)&&Fu(a)?r[o]=ta(c,a,t,i):c==null&&LD(a)?r[o]=ta({},a,t,i):c==null&&FD(a)?r[o]=ku(a):(c===void 0||a!==void 0)&&(r[o]=a)}return r}function zD(r,...e){return qD(r,...e,jD)}var HD=Object.defineProperty,VD=Object.defineProperties,KD=Object.getOwnPropertyDescriptors,Lu=Object.getOwnPropertySymbols,WD=Object.prototype.hasOwnProperty,GD=Object.prototype.propertyIsEnumerable,Mu=(r,e,t)=>e in r?HD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,vs=(r,e)=>{for(var t in e||(e={}))WD.call(e,t)&&Mu(r,t,e[t]);if(Lu)for(var t of Lu(e))GD.call(e,t)&&Mu(r,t,e[t]);return r},YD=(r,e)=>VD(r,KD(e));function Ze(r,e,t){var i;const s=nr(r);return((i=e.rpcMap)==null?void 0:i[s.reference])||`${Ud}?chainId=${s.namespace}:${s.reference}&projectId=${t}`}function Ar(r){return r.includes(":")?r.split(":")[1]:r}function Hd(r){return r.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function JD(r,e){const t=Object.keys(e.namespaces).filter(s=>s.includes(r));if(!t.length)return[];const i=[];return t.forEach(s=>{const n=e.namespaces[s].accounts;i.push(...n)}),i}function qu(r){return Object.fromEntries(Object.entries(r).filter(([e,t])=>{var i,s;return((i=t?.chains)==null?void 0:i.length)&&((s=t?.chains)==null?void 0:s.length)>0}))}function Es(r={},e={}){const t=qu(zu(r)),i=qu(zu(e));return zD(t,i)}function zu(r){var e,t,i,s,n;const o={};if(!Pt(r))return o;for(const[a,c]of Object.entries(r)){const h=nn(a)?[a]:c.chains,u=c.methods||[],l=c.events||[],f=c.rpcMap||{},p=Xr(a);o[p]=YD(vs(vs({},o[p]),c),{chains:Ot(h,(e=o[p])==null?void 0:e.chains),methods:Ot(u,(t=o[p])==null?void 0:t.methods),events:Ot(l,(i=o[p])==null?void 0:i.events)}),(Pt(f)||Pt(((s=o[p])==null?void 0:s.rpcMap)||{}))&&(o[p].rpcMap=vs(vs({},f),(n=o[p])==null?void 0:n.rpcMap))}return o}function Hu(r){return r.includes(":")?r.split(":")[2]:r}function Vu(r){const e={};for(const[t,i]of Object.entries(r)){const s=i.methods||[],n=i.events||[],o=i.accounts||[],a=nn(t)?[t]:i.chains?i.chains:Hd(i.accounts);e[t]={chains:a,methods:s,events:n,accounts:o}}return e}function ro(r){return typeof r=="number"?r:r.includes("0x")?parseInt(r,16):(r=r.includes(":")?r.split(":")[1]:r,isNaN(Number(r))?r:Number(r))}function ZD(r){try{const e=JSON.parse(r);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}const Vd={},Q=r=>Vd[r],io=(r,e)=>{Vd[r]=e};var XD=Object.defineProperty,Ku=Object.getOwnPropertySymbols,QD=Object.prototype.hasOwnProperty,e$=Object.prototype.propertyIsEnumerable,Wu=(r,e,t)=>e in r?XD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Gu=(r,e)=>{for(var t in e||(e={}))QD.call(e,t)&&Wu(r,t,e[t]);if(Ku)for(var t of Ku(e))e$.call(e,t)&&Wu(r,t,e[t]);return r};const Yu="eip155",t$=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],r$=r=>r&&r.startsWith("0x")?BigInt(r).toString(10):r,so=r=>r&&r.startsWith("0x")?r:`0x${BigInt(r).toString(16)}`,Ju=r=>Object.keys(r).filter(e=>t$.includes(e)).reduce((e,t)=>(e[t]=i$(r[t]),e),{}),i$=r=>typeof r=="string"&&ZD(r)?JSON.parse(r):r,s$=(r,e,t)=>{const{sessionProperties:i={},scopedProperties:s={}}=r,n={};if(!Pt(s)&&!Pt(i))return;const o=Ju(i);for(const a of t){const c=r$(a);if(!c)continue;n[so(c)]=o;const h=s?.[`${Yu}:${c}`];if(h){const u=h?.[`${Yu}:${c}:${e}`];n[so(c)]=Gu(Gu({},n[so(c)]),Ju(u||h))}}for(const[a,c]of Object.entries(n))Object.keys(c).length===0&&delete n[a];return Object.keys(n).length>0?n:void 0};var n$=Object.defineProperty,o$=(r,e,t)=>e in r?n$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,a$=(r,e,t)=>o$(r,e+"",t);let no;class ka{constructor(e){a$(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,t){return await this.storage.setItem(e,t)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return no||(no=new ka(e)),no}}var c$=Object.defineProperty,h$=Object.defineProperties,u$=Object.getOwnPropertyDescriptors,Zu=Object.getOwnPropertySymbols,l$=Object.prototype.hasOwnProperty,f$=Object.prototype.propertyIsEnumerable,Xu=(r,e,t)=>e in r?c$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,d$=(r,e)=>{for(var t in e||(e={}))l$.call(e,t)&&Xu(r,t,e[t]);if(Zu)for(var t of Zu(e))f$.call(e,t)&&Xu(r,t,e[t]);return r},p$=(r,e)=>h$(r,u$(e));async function g$(r,e){const t=nr(r.result.capabilities.caip345.caip2),i=r.result.capabilities.caip345.transactionHashes,s=await Promise.allSettled(i.map(l=>y$(t.reference,l,e))),n=s.filter(l=>l.status==="fulfilled").map(l=>l.value).filter(l=>l);s.filter(l=>l.status==="rejected").forEach(l=>console.warn("Failed to fetch transaction receipt:",l.reason));const o=!n.length||n.some(l=>!l),a=n.every(l=>l?.status==="0x1"),c=n.every(l=>l?.status==="0x0"),h=n.some(l=>l?.status==="0x0");let u;return o?u=100:a?u=200:c?u=500:h&&(u=600),{id:r.result.id,version:r.request.version,atomic:r.request.atomicRequired,chainId:r.request.chainId,capabilities:r.result.capabilities,receipts:n,status:u}}async function y$(r,e,t){return await t(parseInt(r)).request(gt("eth_getTransactionReceipt",[e]))}async function w$({sendCalls:r,storage:e}){const t=await e.getItem(ei);await e.setItem(ei,p$(d$({},t),{[r.result.id]:{request:r.request,result:r.result,expiry:de(yD)}}))}async function m$({resultId:r,storage:e}){const t=await e.getItem(ei);if(t){delete t[r],await e.setItem(ei,t);for(const i in t)Dt(t[i].expiry)&&delete t[i];await e.setItem(ei,t)}}async function b$({resultId:r,storage:e}){const t=await e.getItem(ei),i=t?.[r];if(i&&!Dt(i.expiry))return i;await m$({resultId:r,storage:e})}var v$=Object.defineProperty,E$=(r,e,t)=>e in r?v$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Lr=(r,e,t)=>E$(r,typeof e!="symbol"?e+"":e,t);class _${constructor(e){Lr(this,"name","polkadot"),Lr(this,"client"),Lr(this,"httpProviders"),Lr(this,"events"),Lr(this,"namespace"),Lr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(ut.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=Ar(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ze(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ht(new wt(i,Q("disableProviderPing")))}}var x$=Object.defineProperty,I$=Object.defineProperties,S$=Object.getOwnPropertyDescriptors,Qu=Object.getOwnPropertySymbols,D$=Object.prototype.hasOwnProperty,$$=Object.prototype.propertyIsEnumerable,ra=(r,e,t)=>e in r?x$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,oo=(r,e)=>{for(var t in e||(e={}))D$.call(e,t)&&ra(r,t,e[t]);if(Qu)for(var t of Qu(e))$$.call(e,t)&&ra(r,t,e[t]);return r},ao=(r,e)=>I$(r,S$(e)),dr=(r,e,t)=>ra(r,typeof e!="symbol"?e+"":e,t);class O${constructor(e){dr(this,"name","eip155"),dr(this,"client"),dr(this,"chainId"),dr(this,"namespace"),dr(this,"httpProviders"),dr(this,"events"),dr(this,"storage"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=ka.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(ut.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const i=t||Ze(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ht(new wt(i,Q("disableProviderPing")))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=parseInt(Ar(t));e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(e){const t=e||this.chainId;return this.httpProviders[t]||(this.httpProviders=ao(oo({},this.httpProviders),{[t]:this.createHttpProvider(t)}),this.httpProviders[t])}async handleSwitchChain(e){var t,i;let s=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const n=parseInt(s,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,i,s,n,o;const a=(i=(t=e.request)==null?void 0:t.params)==null?void 0:i[0],c=((n=(s=e.request)==null?void 0:s.params)==null?void 0:n[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const h=this.client.session.get(e.topic),u=((o=h?.sessionProperties)==null?void 0:o.capabilities)||{},l=`${a}${c.join(",")}`,f=u?.[l];if(f)return f;let p;try{p=s$(h,a,c)}catch(g){console.warn("Failed to extract capabilities from session",g)}if(p)return p;const d=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:ao(oo({},h.sessionProperties||{}),{capabilities:ao(oo({},u||{}),{[l]:d})})})}catch(g){console.warn("Failed to update session with capabilities",g)}return d}async getCallStatus(e){var t,i,s;const n=this.client.session.get(e.topic),o=(t=n.sessionProperties)==null?void 0:t.bundler_name;if(o){const h=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(h,e)}catch(u){console.warn("Failed to fetch call status from bundler",u,h)}}const a=(i=n.sessionProperties)==null?void 0:i.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(h){console.warn("Failed to fetch call status from custom bundler",h,a)}const c=await b$({resultId:(s=e.request.params)==null?void 0:s[0],storage:this.storage});if(c)try{return await g$(c,this.getHttpProvider.bind(this))}catch(h){console.warn("Failed to fetch call status from stored send calls",h,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var i;const s=new URL(e),n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(gt("eth_getUserOperationReceipt",[(i=t.request.params)==null?void 0:i[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,t){return`${gD}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}async sendCalls(e){var t,i,s;const n=await this.client.request(e),o=(t=e.request.params)==null?void 0:t[0],a=n?.id,c=n?.capabilities||{},h=(i=c?.caip345)==null?void 0:i.caip2,u=(s=c?.caip345)==null?void 0:s.transactionHashes;return!a||!h||!(u!=null&&u.length)||await w$({sendCalls:{request:o,result:n},storage:this.storage}),n}}var P$=Object.defineProperty,A$=(r,e,t)=>e in r?P$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Mr=(r,e,t)=>A$(r,typeof e!="symbol"?e+"":e,t);class C${constructor(e){Mr(this,"name","solana"),Mr(this,"client"),Mr(this,"httpProviders"),Mr(this,"events"),Mr(this,"namespace"),Mr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(ut.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=Ar(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ze(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ht(new wt(i,Q("disableProviderPing")))}}var T$=Object.defineProperty,R$=(r,e,t)=>e in r?T$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,qr=(r,e,t)=>R$(r,typeof e!="symbol"?e+"":e,t);class B${constructor(e){qr(this,"name","cosmos"),qr(this,"client"),qr(this,"httpProviders"),qr(this,"events"),qr(this,"namespace"),qr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(ut.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=Ar(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ze(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ht(new wt(i,Q("disableProviderPing")))}}var N$=Object.defineProperty,U$=(r,e,t)=>e in r?N$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,zr=(r,e,t)=>U$(r,typeof e!="symbol"?e+"":e,t);class k${constructor(e){zr(this,"name","algorand"),zr(this,"client"),zr(this,"httpProviders"),zr(this,"events"),zr(this,"namespace"),zr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const i=t||Ze(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(ut.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ze(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new ht(new wt(i,Q("disableProviderPing")))}}var j$=Object.defineProperty,F$=(r,e,t)=>e in r?j$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Hr=(r,e,t)=>F$(r,typeof e!="symbol"?e+"":e,t);class L${constructor(e){Hr(this,"name","cip34"),Hr(this,"client"),Hr(this,"httpProviders"),Hr(this,"events"),Hr(this,"namespace"),Hr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(ut.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=this.getCardanoRPCUrl(t),s=Ar(t);e[s]=this.createHttpProvider(s,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ht(new wt(i,Q("disableProviderPing")))}}var M$=Object.defineProperty,q$=(r,e,t)=>e in r?M$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Vr=(r,e,t)=>q$(r,typeof e!="symbol"?e+"":e,t);class z${constructor(e){Vr(this,"name","elrond"),Vr(this,"client"),Vr(this,"httpProviders"),Vr(this,"events"),Vr(this,"namespace"),Vr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(ut.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=Ar(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ze(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ht(new wt(i,Q("disableProviderPing")))}}var H$=Object.defineProperty,V$=(r,e,t)=>e in r?H$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Kr=(r,e,t)=>V$(r,typeof e!="symbol"?e+"":e,t);class K${constructor(e){Kr(this,"name","multiversx"),Kr(this,"client"),Kr(this,"httpProviders"),Kr(this,"events"),Kr(this,"namespace"),Kr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(ut.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=Ar(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ze(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ht(new wt(i,Q("disableProviderPing")))}}var W$=Object.defineProperty,G$=(r,e,t)=>e in r?W$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Wr=(r,e,t)=>G$(r,typeof e!="symbol"?e+"":e,t);class Y${constructor(e){Wr(this,"name","near"),Wr(this,"client"),Wr(this,"httpProviders"),Wr(this,"events"),Wr(this,"namespace"),Wr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Ze(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(ut.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ze(e,this.namespace);return typeof i>"u"?void 0:new ht(new wt(i,Q("disableProviderPing")))}}var J$=Object.defineProperty,Z$=(r,e,t)=>e in r?J$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Gr=(r,e,t)=>Z$(r,typeof e!="symbol"?e+"":e,t);class X${constructor(e){Gr(this,"name","tezos"),Gr(this,"client"),Gr(this,"httpProviders"),Gr(this,"events"),Gr(this,"namespace"),Gr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Ze(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(ut.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ze(e,this.namespace);return typeof i>"u"?void 0:new ht(new wt(i))}}var Q$=Object.defineProperty,eO=(r,e,t)=>e in r?Q$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Yr=(r,e,t)=>eO(r,typeof e!="symbol"?e+"":e,t);class tO{constructor(e){Yr(this,"name",kd),Yr(this,"client"),Yr(this,"httpProviders"),Yr(this,"events"),Yr(this,"namespace"),Yr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(ut.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return nr(e).namespace}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const i={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(s=>{const n=nr(s);i[n.reference]=this.createHttpProvider(s)}),i}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ze(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ht(new wt(i,Q("disableProviderPing")))}}var rO=Object.defineProperty,iO=Object.defineProperties,sO=Object.getOwnPropertyDescriptors,el=Object.getOwnPropertySymbols,nO=Object.prototype.hasOwnProperty,oO=Object.prototype.propertyIsEnumerable,ia=(r,e,t)=>e in r?rO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_s=(r,e)=>{for(var t in e||(e={}))nO.call(e,t)&&ia(r,t,e[t]);if(el)for(var t of el(e))oO.call(e,t)&&ia(r,t,e[t]);return r},co=(r,e)=>iO(r,sO(e)),et=(r,e,t)=>ia(r,typeof e!="symbol"?e+"":e,t);class un{constructor(e){et(this,"client"),et(this,"namespaces"),et(this,"optionalNamespaces"),et(this,"sessionProperties"),et(this,"scopedProperties"),et(this,"events",new oa),et(this,"rpcProviders",{}),et(this,"session"),et(this,"providerOpts"),et(this,"logger"),et(this,"uri"),et(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:Wi(Ks({level:e?.logger||Uu})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const t=new un(e);return await t.initialize(),t}async request(e,t,i){const[s,n]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:_s({},e),chainId:`${s}:${n}`,topic:this.session.topic,expiry:i})}sendAsync(e,t,i,s){const n=new Date().getTime();this.request(e,i,s).then(o=>t(null,Vi(n,o))).catch(o=>t(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:ce("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:s}=await this.client.authenticate(e,t);i&&(this.uri=i,this.events.emit("display_uri",i));const n=await s();if(this.session=n.session,this.session){const o=Vu(this.session.namespaces);this.namespaces=Es(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const s=await i();this.session=s;const n=Vu(s.namespaces);return this.namespaces=Es(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[i,s]=this.validateChain(e);this.getProvider(i).setDefaultChain(s,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(!Mt(t))return;for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}catch(t){this.logger.warn("Failed to cleanup pending pairings",t)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await rD.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Uu,relayUrl:this.providerOpts.relayUrl||fD,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error("Failed to get session",i),new Error(`The provided session: ${(t=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:t.topic} doesn't exist in the Sign client`)}else{const i=this.client.session.getAll();this.session=i[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>Xr(t)))];io("client",this.client),io("events",this.events),io("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const i=JD(t,this.session);if(i?.length===0)return;const s=Hd(i),n=Es(this.namespaces,this.optionalNamespaces),o=co(_s({},n[t]),{accounts:i,chains:s});switch(t){case"eip155":this.rpcProviders[t]=new O$({namespace:o});break;case"algorand":this.rpcProviders[t]=new k$({namespace:o});break;case"solana":this.rpcProviders[t]=new C$({namespace:o});break;case"cosmos":this.rpcProviders[t]=new B$({namespace:o});break;case"polkadot":this.rpcProviders[t]=new _$({namespace:o});break;case"cip34":this.rpcProviders[t]=new L$({namespace:o});break;case"elrond":this.rpcProviders[t]=new z$({namespace:o});break;case"multiversx":this.rpcProviders[t]=new K$({namespace:o});break;case"near":this.rpcProviders[t]=new Y$({namespace:o});break;case"tezos":this.rpcProviders[t]=new X$({namespace:o});break;default:this.rpcProviders[t]=new tO({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;const{topic:i}=e;i===((t=this.session)==null?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;const{params:i,topic:s}=e;if(s!==((t=this.session)==null?void 0:t.topic))return;const{event:n}=i;if(n.name==="accountsChanged"){const o=n.data;o&&Mt(o)&&this.events.emit("accountsChanged",o.map(Hu))}else if(n.name==="chainChanged"){const o=i.chainId,a=i.event.data,c=Xr(o),h=ro(o)!==ro(a)?`${c}:${ro(a)}`:o;this.onChainChanged(h)}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i,s;if(e!==((i=this.session)==null?void 0:i.topic))return;const{namespaces:n}=t,o=(s=this.client)==null?void 0:s.session.get(e);this.session=co(_s({},o),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{var t;e.topic===((t=this.session)==null?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",co(_s({},ce("USER_DISCONNECTED")),{data:e.topic})))}),this.on(ut.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[kd]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t={},optionalNamespaces:i={},sessionProperties:s,scopedProperties:n}=e;this.optionalNamespaces=Es(t,i),this.sessionProperties=s,this.scopedProperties=n}validateChain(e){const[t,i]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,i];if(t&&!Object.keys(this.namespaces||{}).map(o=>Xr(o)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&i)return[t,i];const s=Xr(Object.keys(this.namespaces)[0]),n=this.rpcProviders[s].getDefaultChain();return[s,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,t=!1){if(!this.namespaces)return;const[i,s]=this.validateChain(e);if(!s)return;this.updateNamespaceChain(i,s);const n=this.getProvider(i).getDefaultChain();t?(this.events.emit("chainChanged",s),this.emitAccountsChangedOnChainChange({namespace:i,previousChainId:n,newChainId:e})):this.getProvider(i).setDefaultChain(s),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:t,newChainId:i}){var s,n;try{if(t===i)return;const o=(n=(s=this.session)==null?void 0:s.namespaces[e])==null?void 0:n.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${i}:`)).map(Hu);if(!Mt(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,t){if(!this.namespaces)return;const i=this.namespaces[e]?e:`${e}:${t}`,s={chains:[],methods:[],events:[],defaultChain:t};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=t):this.namespaces[i]=s}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var i;const s=((i=this.session)==null?void 0:i.topic)||"";await this.client.core.storage.setItem(`${bs}/${e}${s}`,t)}async getFromStore(e){var t;const i=((t=this.session)==null?void 0:t.topic)||"";return await this.client.core.storage.getItem(`${bs}/${e}${i}`)}async deleteFromStore(e){var t;const i=((t=this.session)==null?void 0:t.topic)||"";await this.client.core.storage.removeItem(`${bs}/${e}${i}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const t=await this.client.core.storage.getKeys();for(const i of t)i.startsWith(bs)&&await this.client.core.storage.removeItem(i)}catch(t){this.logger.warn("Failed to cleanup storage",t)}}}const aO=un,aP=Object.freeze(Object.defineProperty({__proto__:null,UniversalProvider:aO,default:un},Symbol.toStringTag,{value:"Module"}));export{km as H,Mc as a,Fi as b,MO as c,Cm as d,Kl as e,jm as f,LO as g,ks as h,HO as i,zO as j,aP as k,qO as r,Wl as t};
