const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-uDqKOQk1.js","assets/index-Cn3kq7oy.js","assets/index-trjEgyRZ.css"])))=>i.map(i=>d[i]);
import{B as O,s as z,g as B,a as P,n as I,b as C,c as G,_ as V,d as y,f as J,e as q,h as K,i as b,p as X,j as Y,v as Q,k as Z,l as H,u as ee,m as E,t as ne}from"./index-Cn3kq7oy.js";const ae=e=>e;class te extends O{constructor({body:n,error:a,url:t}){super("RPC Request failed.",{cause:a,details:a.message,metaMessages:[`URL: ${ae(t)}`,`Request body: ${z(n)}`],name:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=a.code,this.data=a.data}}const ie=-1;class se extends O{constructor(n,{code:a,docsPath:t,metaMessages:i,name:c,shortMessage:r}){super(r,{cause:n,docsPath:t,metaMessages:i||n?.metaMessages,name:c||"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=c||n.name,this.code=n instanceof te?n.code:a??ie}}class N extends se{constructor(n,a){super(n,a),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=a.data}}class T extends N{constructor(n){super(n,{code:T.code,name:"UserRejectedRequestError",shortMessage:"User rejected the request."})}}Object.defineProperty(T,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class v extends N{constructor(n){super(n,{code:v.code,name:"SwitchChainError",shortMessage:"An error occurred when attempting to switch chain."})}}Object.defineProperty(v,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});const ce="08c4b07e3ad25f1a27c14a4e8cecb6f0",L="eip155";let w=null;const _={lastUsedChainId:"tw.wc.lastUsedChainId",requestedChains:"tw.wc.requestedChains"};async function fe(e,n,a,t,i){const c=await S(e,a,i),r=e.walletConnect;let{onDisplayUri:s}=r||{};const o=await P(a);!s&&i&&(s=A=>{const D=o.mobile.native||o.mobile.universal;if(!D){i(A);return}const x=J(D,A).redirect;i(x)}),s&&c.events.addListener("display_uri",s);let u=r?.optionalChains,d=e.chain;a==="global.safe"&&(u=W.map(C),d&&!u.includes(d)&&(d=void 0));const{chains:l,rpcMap:p}=le({chain:d,client:e.client,optionalChains:u});await c.connect({...r?.pairingTopic?{pairingTopic:r?.pairingTopic}:{},optionalNamespaces:{[L]:{chains:l,events:["chainChanged","accountsChanged"],methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain"],rpcMap:p}}}),k(l.map(g=>Number(g.split(":")[1])),t);const h=l[0]?.split(":")[1]||1,f=I(h),U=oe(c.session,"eip155:1");if(!U)throw new Error("No accounts found on provider.");const F=e.chain&&e.chain.id===f?e.chain:C(f);if(e){const g={chain:e.chain,optionalChains:e.walletConnect?.optionalChains,pairingTopic:e.walletConnect?.pairingTopic};t&&G(t,a,g)}return s&&c.events.removeListener("display_uri",s),$(U,F,c,n,t,e.client,o,i)}async function re(e,n,a){if(!e.session)throw new Error("No session found on provider.");const t=`eip155:${n.id}`,i=E(n.id);if(j(e.session,t)){e.setDefaultChain(t);return}try{await m({provider:e,payload:{method:"wallet_switchEthereumChain",params:[{chainId:i}]},chain:t,walletInfo:a}),e.setDefaultChain(t);return}catch(r){if((r?.code??r?.data?.originalError?.code)===4001)throw new Error("User rejected chain switch")}const c=de(e.session);if(!c)throw new Error("No routable chain to send wallet_addEthereumChain");try{await m({provider:e,payload:{method:"wallet_addEthereumChain",params:[{chainId:i,chainName:n.name,nativeCurrency:n.nativeCurrency,rpcUrls:[n.rpc],blockExplorerUrls:[n.blockExplorers?.[0]?.url??""]}]},chain:c,walletInfo:a})}catch(r){throw(r?.code??r?.data?.originalError?.code)===4001?new Error("User rejected add chain"):new Error(`Add chain failed: ${r?.message||String(r)}`)}if(await m({provider:e,payload:{method:"wallet_switchEthereumChain",params:[{chainId:i}]},chain:t,walletInfo:a}),e.setDefaultChain(t),!j(e.session,t))throw new Error("Target chain still not enabled by wallet")}function R(e){return e?.namespaces?.eip155}function j(e,n){return!!R(e)?.accounts?.some(t=>t.startsWith(`${n}:`))}function oe(e,n){const a=R(e),t=a?.accounts?.find(i=>i.startsWith(`${n}:`))||a?.accounts[0];return t?t.split(":")[2]??null:null}function de(e){return R(e)?.accounts?.[0]?.split(":")?.slice(0,2)?.join(":")??null}async function me(e,n,a,t,i){const c=t?await B(t,a):null,r=await P(a),s=await S(c?{chain:c.chain,client:e.client,walletConnect:{optionalChains:c.optionalChains,pairingTopic:c.pairingTopic}}:{client:e.client,walletConnect:{}},a,i);if(!s.session)throw await s.disconnect(),new Error("No wallet connect session found on provider.");const u=s.session?.namespaces?.[L]?.accounts?.[0]?.split(":")[2];if(!u)throw new Error("No accounts found on provider.");const d=e.chain?.id||1,l=I(d),p=e.chain&&e.chain.id===l?e.chain:C(l);return $(u,p,s,n,t,e.client,r,i)}async function S(e,n,a){if(w)return w;const t=await P(n),i=e.walletConnect,{UniversalProvider:c}=await V(async()=>{const{UniversalProvider:u}=await import("./index.es-uDqKOQk1.js").then(d=>d.k);return{UniversalProvider:u}},__vite__mapDeps([0,1,2]));let r=i?.optionalChains,s=e.chain;n==="global.safe"&&(r=W.map(C),s&&!r.includes(s)&&(s=void 0));const o=await c.init({metadata:{description:i?.appMetadata?.description||y().description,icons:[i?.appMetadata?.logoUrl||y().logoUrl],name:i?.appMetadata?.name||y().name,url:i?.appMetadata?.url||y().url,redirect:{native:t.mobile.native||void 0,universal:t.mobile.universal||void 0}},projectId:i?.projectId||ce});if(o.events.setMaxListeners(Number.POSITIVE_INFINITY),n!=="walletConnect"){async function u(){const d=o.session?.peer?.metadata?.redirect?.native||t.mobile.native||t.mobile.universal;a&&d&&await a(d)}o.on("session_request_sent",u),o.events.addListener("disconnect",()=>{o.off("session_request_sent",u),w=null})}return w=o,o}function M({provider:e,address:n,client:a,chain:t,sessionRequestHandler:i,walletInfo:c}){return{address:b(n),async sendTransaction(s){const o=await m({provider:e,payload:{method:"eth_sendTransaction",params:[{data:s.data,from:b(n),gas:s.gas?E(s.gas):void 0,to:s.to,value:s.value?E(s.value):void 0}]},chain:`eip155:${s.chainId}`,walletInfo:c,sessionRequestHandler:i});return ne({chainId:s.chainId,client:a,contractAddress:s.to??void 0,gasPrice:s.gasPrice,transactionHash:o,walletAddress:b(n),walletType:"walletConnect"}),{transactionHash:o}},async signMessage({message:s}){const o=typeof s=="string"?H(s):s.raw instanceof Uint8Array?ee(s.raw):s.raw;return m({provider:e,payload:{method:"personal_sign",params:[o,this.address]},chain:`eip155:${t.id}`,walletInfo:c,sessionRequestHandler:i})},async signTypedData(s){const o=X(s),{domain:u,message:d,primaryType:l}=o,p={EIP712Domain:Y({domain:u}),...o.types};Q({domain:u,message:d,primaryType:l,types:p});const h=Z({domain:u??{},message:d,primaryType:l,types:p});return await m({provider:e,payload:{method:"eth_signTypedData_v4",params:[this.address,h]},chain:`eip155:${t.id}`,walletInfo:c,sessionRequestHandler:i})}}}async function m(e){const{provider:n,payload:a,chain:t,walletInfo:i,sessionRequestHandler:c}=e,r=n.request(a,t),s=n.session?.peer?.metadata?.redirect?.native||i.mobile.native||i.mobile.universal;return c&&s&&await c(s),r}function $(e,n,a,t,i,c,r,s){const o=M({address:e,chain:n,client:c,provider:a,sessionRequestHandler:s,walletInfo:r});async function u(){a.removeListener("accountsChanged",l),a.removeListener("chainChanged",p),a.removeListener("disconnect",d),await a.disconnect(),w=null}function d(){k([],i),i?.removeItem(_.lastUsedChainId),u(),t.emit("disconnect",void 0)}function l(h){if(h[0]){const f=M({address:b(h[0]),chain:n,client:c,provider:a,sessionRequestHandler:s,walletInfo:r});t.emit("accountChanged",f),t.emit("accountsChanged",h)}else d()}function p(h){const f=C(I(h));t.emit("chainChanged",f),i?.setItem(_.lastUsedChainId,String(h))}return a.on("accountsChanged",l),a.on("chainChanged",p),a.on("disconnect",d),a.on("session_delete",d),[o,n,u,h=>ue(a,h,r)]}async function ue(e,n,a){try{await re(e,n,a)}catch(t){const i=typeof t=="string"?t:t?.message;throw/user rejected request/i.test(i)?new T(t):new v(t)}}function k(e,n){n?.setItem(_.requestedChains,K(e))}function le(e){const n={},a=[];e.chain&&(n[e.chain.id]=q({chain:e.chain,client:e.client}),a.push(e.chain.id));const t=(e?.optionalChains||[]).slice(0,10);for(const i of t)n[i.id]=q({chain:i,client:e.client}),a.push(i.id);return a.includes(1)||(n[1]=C(1).rpc,a.push(1)),{chains:a.map(i=>`eip155:${i}`),rpcMap:n}}const W=[1,11155111,42161,43114,8453,1313161554,84532,56,42220,100,10,137,1101,324,534352];export{me as autoConnectWC,fe as connectWC};
