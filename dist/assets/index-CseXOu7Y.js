const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/in-app-wallet-calls-Bu1gU1-o.js","assets/index-Cn3kq7oy.js","assets/index-trjEgyRZ.css","assets/send-transaction-D6lpxEtY.js","assets/to-serializable-transaction-CINlwqk-.js","assets/random-NeYOSU-c.js","assets/eth_getTransactionCount-DhE6m_ss.js","assets/index-Cij_JTZo.js","assets/read-contract-D2Vq_7_K.js","assets/utils-K5Uh5N8m.js","assets/bundler-aFvEyNsc.js","assets/addresses-Cbjra2SQ.js","assets/send-eip712-transaction-CDIeKzxW.js","assets/eth_sendRawTransaction-DPdnXbFR.js","assets/concat-hex-D70TxF1Q.js"])))=>i.map(i=>d[i]);
import{aT as L,_ as b,b as f,S as v,i as d,K as C,G as x,w as A,h as E,aU as P,y as I}from"./index-Cn3kq7oy.js";import{s as U}from"./types-DC0Zmj1B.js";import{p as _,o as M,i as W,j as V}from"./bundler-aFvEyNsc.js";import{b as R}from"./to-serializable-transaction-CINlwqk-.js";import{r as D}from"./random-NeYOSU-c.js";import"./utils-K5Uh5N8m.js";const F=L({blockExplorers:[{name:"Etherscan",url:"https://etherscan.io"}],id:1,name:"Ethereum",nativeCurrency:{decimals:18,name:"Ether",symbol:"ETH"}}),z="0x3f707e6b",G=[{type:"tuple[]",name:"calls",components:[{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}]}],O=[];function H(t){const e=M(async()=>"asyncParams"in t?await t.asyncParams():t);return _({contract:t.contract,method:[z,G,O],params:async()=>[(await e()).calls],value:async()=>(await e()).overrides?.value,accessList:async()=>(await e()).overrides?.accessList,gas:async()=>(await e()).overrides?.gas,gasPrice:async()=>(await e()).overrides?.gasPrice,maxFeePerGas:async()=>(await e()).overrides?.maxFeePerGas,maxPriorityFeePerGas:async()=>(await e()).overrides?.maxPriorityFeePerGas,nonce:async()=>(await e()).overrides?.nonce,extraGas:async()=>(await e()).overrides?.extraGas,erc20Value:async()=>(await e()).overrides?.erc20Value,authorizationList:async()=>(await e()).overrides?.authorizationList})}async function N(t){const{client:e,chain:n,bundlerUrl:s}=t,p=s??C(n),o=`delegation-contract:${p}`;return x(async()=>{const i=await A(e)(p,{useAuthToken:!0,body:E({id:1,jsonrpc:"2.0",method:"tw_getDelegationContract",params:[]}),headers:{"Content-Type":"application/json"},method:"POST"});if(!i.ok)throw new Error(`Failed to fetch delegation contract: ${i.status} ${i.statusText}`);const r=await i.json();if(r.error)throw new Error(`Delegation contract RPC error: ${JSON.stringify(r.error)}`);if(!r.result?.delegationContract)throw new Error("Invalid response: missing delegationContract in result");return r.result.delegationContract},{cacheKey:o,cacheTime:1440*60*1e3})}const $=t=>{const{client:e,adminAccount:n,sponsorGas:s}=t,p=async a=>{const i=a[0];if(!i)throw new Error("No transactions provided");const r=f(i.chainId),l=v({address:n.address,chain:r,client:e,abi:q});let y=i.authorizationList?.[0];const c=await N({client:e,chain:r});if(y&&y.address?.toLowerCase()!==c.toLowerCase())throw new Error(`Authorization address does not match expected delegation contract address. Expected ${c} but got ${y.address}`);if(!y&&!await k(l,c)){let m=i.nonce?BigInt(i.nonce):BigInt(await B({client:e,address:n.address,chain:r}));m+=s?0n:1n;const T=await n.signAuthorization?.({address:d(c),chainId:i.chainId,nonce:m});if(!T)throw new Error("Failed to sign authorization");y=T}if(s){const u={calls:a.map(g=>({data:g.data??"0x",target:d(g.to??""),value:g.value??0n})),uid:D()},m=await n.signTypedData({domain:{chainId:i.chainId,name:"MinimalAccount",verifyingContract:l.address,version:"1"},message:u,primaryType:"WrappedCalls",types:{Call:[{name:"target",type:"address"},{name:"value",type:"uint256"},{name:"data",type:"bytes"}],WrappedCalls:[{name:"calls",type:"Call[]"},{name:"uid",type:"bytes32"}]}}),T=await W({authorization:y,eoaAddress:d(n.address),options:{chain:f(i.chainId),client:e},signature:m,wrappedCalls:u});return{transactionHash:await j({options:{chain:f(i.chainId),client:e},transactionId:T.transactionId})}}const h=H({calls:a.map(u=>({data:u.data??"0x",target:d(u.to??""),value:u.value??0n})),contract:l,overrides:{authorizationList:y?[y]:void 0,value:a.reduce((u,m)=>u+(m.value??0n),0n)}}),w=await R({from:n.address,transaction:h});return n.sendTransaction(w)},o={address:n.address,sendBatchTransaction:async a=>p(a),sendTransaction:async a=>p([a]),signMessage:({message:a,originalMessage:i,chainId:r})=>n.signMessage({chainId:r,message:a,originalMessage:i}),signTypedData:a=>n.signTypedData(a),sendCalls:async a=>{const{inAppWalletSendCalls:i}=await b(async()=>{const{inAppWalletSendCalls:h}=await import("./in-app-wallet-calls-Bu1gU1-o.js");return{inAppWalletSendCalls:h}},__vite__mapDeps([0,1,2,3,4,5])),r=a.calls[0];if(!r)throw new Error("No calls to send");const l=r.client,y=r.chain||a.chain,c=await i({account:o,calls:a.calls,chain:y});return{chain:y,client:l,id:c}},getCallsStatus:async a=>{const{inAppWalletGetCallsStatus:i}=await b(async()=>{const{inAppWalletGetCallsStatus:r}=await import("./in-app-wallet-calls-Bu1gU1-o.js");return{inAppWalletGetCallsStatus:r}},__vite__mapDeps([0,1,2,3,4,5]));return i(a)},getCapabilities:async a=>({[a.chainId??1]:{atomic:{status:"supported"},paymasterService:{supported:s??!1}}})};return o};async function B(t){const{client:e,address:n,chain:s}=t,p=I({chain:s,client:e});return await b(async()=>{const{eth_getTransactionCount:a}=await import("./eth_getTransactionCount-DhE6m_ss.js");return{eth_getTransactionCount:a}},__vite__mapDeps([6,1,2])).then(({eth_getTransactionCount:a})=>a(p,{address:d(n),blockTag:"pending"}))}async function k(t,e){const n=await P(t),s=n.length>0&&n.startsWith("0xef0100"),p=`0x${n.slice(8,48)}`;return s&&p.toLowerCase()===e.toLowerCase()}async function j(t){const e=t.timeoutMs||3e5,n=t.intervalMs||1e3,s=Date.now()+e;for(;Date.now()<s;){const p=await V({options:t.options,transactionId:t.transactionId});if(p.transactionHash)return p.transactionHash;await new Promise(o=>setTimeout(o,n))}throw new Error(`Timeout waiting for transaction to be mined on chain ${t.options.chain.id} with transactionId: ${t.transactionId}`)}const q=[{type:"receive",stateMutability:"payable"},{type:"function",name:"createSessionWithSig",inputs:[{name:"sessionSpec",type:"tuple",internalType:"struct SessionLib.SessionSpec",components:[{name:"signer",type:"address",internalType:"address"},{name:"isWildcard",type:"bool",internalType:"bool"},{name:"expiresAt",type:"uint256",internalType:"uint256"},{name:"callPolicies",type:"tuple[]",internalType:"struct SessionLib.CallSpec[]",components:[{name:"target",type:"address",internalType:"address"},{name:"selector",type:"bytes4",internalType:"bytes4"},{name:"maxValuePerUse",type:"uint256",internalType:"uint256"},{name:"valueLimit",type:"tuple",internalType:"struct SessionLib.UsageLimit",components:[{name:"limitType",type:"uint8",internalType:"enum SessionLib.LimitType"},{name:"limit",type:"uint256",internalType:"uint256"},{name:"period",type:"uint256",internalType:"uint256"}]},{name:"constraints",type:"tuple[]",internalType:"struct SessionLib.Constraint[]",components:[{name:"condition",type:"uint8",internalType:"enum SessionLib.Condition"},{name:"index",type:"uint64",internalType:"uint64"},{name:"refValue",type:"bytes32",internalType:"bytes32"},{name:"limit",type:"tuple",internalType:"struct SessionLib.UsageLimit",components:[{name:"limitType",type:"uint8",internalType:"enum SessionLib.LimitType"},{name:"limit",type:"uint256",internalType:"uint256"},{name:"period",type:"uint256",internalType:"uint256"}]}]}]},{name:"transferPolicies",type:"tuple[]",internalType:"struct SessionLib.TransferSpec[]",components:[{name:"target",type:"address",internalType:"address"},{name:"maxValuePerUse",type:"uint256",internalType:"uint256"},{name:"valueLimit",type:"tuple",internalType:"struct SessionLib.UsageLimit",components:[{name:"limitType",type:"uint8",internalType:"enum SessionLib.LimitType"},{name:"limit",type:"uint256",internalType:"uint256"},{name:"period",type:"uint256",internalType:"uint256"}]}]},{name:"uid",type:"bytes32",internalType:"bytes32"}]},{name:"signature",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"eip712Domain",inputs:[],outputs:[{name:"fields",type:"bytes1",internalType:"bytes1"},{name:"name",type:"string",internalType:"string"},{name:"version",type:"string",internalType:"string"},{name:"chainId",type:"uint256",internalType:"uint256"},{name:"verifyingContract",type:"address",internalType:"address"},{name:"salt",type:"bytes32",internalType:"bytes32"},{name:"extensions",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"execute",inputs:[{name:"calls",type:"tuple[]",internalType:"struct Call[]",components:[{name:"target",type:"address",internalType:"address"},{name:"value",type:"uint256",internalType:"uint256"},{name:"data",type:"bytes",internalType:"bytes"}]}],outputs:[],stateMutability:"payable"},{type:"function",name:"executeWithSig",inputs:[{name:"wrappedCalls",type:"tuple",internalType:"struct WrappedCalls",components:[{name:"calls",type:"tuple[]",internalType:"struct Call[]",components:[{name:"target",type:"address",internalType:"address"},{name:"value",type:"uint256",internalType:"uint256"},{name:"data",type:"bytes",internalType:"bytes"}]},{name:"uid",type:"bytes32",internalType:"bytes32"}]},{name:"signature",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"payable"},{type:"function",name:"getCallPoliciesForSigner",inputs:[{name:"signer",type:"address",internalType:"address"}],outputs:[{name:"",type:"tuple[]",internalType:"struct SessionLib.CallSpec[]",components:[{name:"target",type:"address",internalType:"address"},{name:"selector",type:"bytes4",internalType:"bytes4"},{name:"maxValuePerUse",type:"uint256",internalType:"uint256"},{name:"valueLimit",type:"tuple",internalType:"struct SessionLib.UsageLimit",components:[{name:"limitType",type:"uint8",internalType:"enum SessionLib.LimitType"},{name:"limit",type:"uint256",internalType:"uint256"},{name:"period",type:"uint256",internalType:"uint256"}]},{name:"constraints",type:"tuple[]",internalType:"struct SessionLib.Constraint[]",components:[{name:"condition",type:"uint8",internalType:"enum SessionLib.Condition"},{name:"index",type:"uint64",internalType:"uint64"},{name:"refValue",type:"bytes32",internalType:"bytes32"},{name:"limit",type:"tuple",internalType:"struct SessionLib.UsageLimit",components:[{name:"limitType",type:"uint8",internalType:"enum SessionLib.LimitType"},{name:"limit",type:"uint256",internalType:"uint256"},{name:"period",type:"uint256",internalType:"uint256"}]}]}]}],stateMutability:"view"},{type:"function",name:"getSessionExpirationForSigner",inputs:[{name:"signer",type:"address",internalType:"address"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"getSessionStateForSigner",inputs:[{name:"signer",type:"address",internalType:"address"}],outputs:[{name:"",type:"tuple",internalType:"struct SessionLib.SessionState",components:[{name:"transferValue",type:"tuple[]",internalType:"struct SessionLib.LimitState[]",components:[{name:"remaining",type:"uint256",internalType:"uint256"},{name:"target",type:"address",internalType:"address"},{name:"selector",type:"bytes4",internalType:"bytes4"},{name:"index",type:"uint256",internalType:"uint256"}]},{name:"callValue",type:"tuple[]",internalType:"struct SessionLib.LimitState[]",components:[{name:"remaining",type:"uint256",internalType:"uint256"},{name:"target",type:"address",internalType:"address"},{name:"selector",type:"bytes4",internalType:"bytes4"},{name:"index",type:"uint256",internalType:"uint256"}]},{name:"callParams",type:"tuple[]",internalType:"struct SessionLib.LimitState[]",components:[{name:"remaining",type:"uint256",internalType:"uint256"},{name:"target",type:"address",internalType:"address"},{name:"selector",type:"bytes4",internalType:"bytes4"},{name:"index",type:"uint256",internalType:"uint256"}]}]}],stateMutability:"view"},{type:"function",name:"getTransferPoliciesForSigner",inputs:[{name:"signer",type:"address",internalType:"address"}],outputs:[{name:"",type:"tuple[]",internalType:"struct SessionLib.TransferSpec[]",components:[{name:"target",type:"address",internalType:"address"},{name:"maxValuePerUse",type:"uint256",internalType:"uint256"},{name:"valueLimit",type:"tuple",internalType:"struct SessionLib.UsageLimit",components:[{name:"limitType",type:"uint8",internalType:"enum SessionLib.LimitType"},{name:"limit",type:"uint256",internalType:"uint256"},{name:"period",type:"uint256",internalType:"uint256"}]}]}],stateMutability:"view"},{type:"function",name:"isWildcardSigner",inputs:[{name:"signer",type:"address",internalType:"address"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"onERC1155BatchReceived",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"address",internalType:"address"},{name:"",type:"uint256[]",internalType:"uint256[]"},{name:"",type:"uint256[]",internalType:"uint256[]"},{name:"",type:"bytes",internalType:"bytes"}],outputs:[{name:"",type:"bytes4",internalType:"bytes4"}],stateMutability:"nonpayable"},{type:"function",name:"onERC1155Received",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"bytes",internalType:"bytes"}],outputs:[{name:"",type:"bytes4",internalType:"bytes4"}],stateMutability:"nonpayable"},{type:"function",name:"onERC721Received",inputs:[{name:"",type:"address",internalType:"address"},{name:"",type:"address",internalType:"address"},{name:"",type:"uint256",internalType:"uint256"},{name:"",type:"bytes",internalType:"bytes"}],outputs:[{name:"",type:"bytes4",internalType:"bytes4"}],stateMutability:"nonpayable"},{type:"function",name:"supportsInterface",inputs:[{name:"interfaceId",type:"bytes4",internalType:"bytes4"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"event",name:"Executed",inputs:[{name:"to",type:"address",indexed:!0,internalType:"address"},{name:"value",type:"uint256",indexed:!1,internalType:"uint256"},{name:"data",type:"bytes",indexed:!1,internalType:"bytes"}],anonymous:!1},{type:"event",name:"SessionCreated",inputs:[{name:"signer",type:"address",indexed:!0,internalType:"address"},{name:"sessionSpec",type:"tuple",indexed:!1,internalType:"struct SessionLib.SessionSpec",components:[{name:"signer",type:"address",internalType:"address"},{name:"isWildcard",type:"bool",internalType:"bool"},{name:"expiresAt",type:"uint256",internalType:"uint256"},{name:"callPolicies",type:"tuple[]",internalType:"struct SessionLib.CallSpec[]",components:[{name:"target",type:"address",internalType:"address"},{name:"selector",type:"bytes4",internalType:"bytes4"},{name:"maxValuePerUse",type:"uint256",internalType:"uint256"},{name:"valueLimit",type:"tuple",internalType:"struct SessionLib.UsageLimit",components:[{name:"limitType",type:"uint8",internalType:"enum SessionLib.LimitType"},{name:"limit",type:"uint256",internalType:"uint256"},{name:"period",type:"uint256",internalType:"uint256"}]},{name:"constraints",type:"tuple[]",internalType:"struct SessionLib.Constraint[]",components:[{name:"condition",type:"uint8",internalType:"enum SessionLib.Condition"},{name:"index",type:"uint64",internalType:"uint64"},{name:"refValue",type:"bytes32",internalType:"bytes32"},{name:"limit",type:"tuple",internalType:"struct SessionLib.UsageLimit",components:[{name:"limitType",type:"uint8",internalType:"enum SessionLib.LimitType"},{name:"limit",type:"uint256",internalType:"uint256"},{name:"period",type:"uint256",internalType:"uint256"}]}]}]},{name:"transferPolicies",type:"tuple[]",internalType:"struct SessionLib.TransferSpec[]",components:[{name:"target",type:"address",internalType:"address"},{name:"maxValuePerUse",type:"uint256",internalType:"uint256"},{name:"valueLimit",type:"tuple",internalType:"struct SessionLib.UsageLimit",components:[{name:"limitType",type:"uint8",internalType:"enum SessionLib.LimitType"},{name:"limit",type:"uint256",internalType:"uint256"},{name:"period",type:"uint256",internalType:"uint256"}]}]},{name:"uid",type:"bytes32",internalType:"bytes32"}]}],anonymous:!1},{type:"event",name:"ValueReceived",inputs:[{name:"from",type:"address",indexed:!0,internalType:"address"},{name:"value",type:"uint256",indexed:!1,internalType:"uint256"}],anonymous:!1},{type:"error",name:"AllowanceExceeded",inputs:[{name:"allowanceUsage",type:"uint256",internalType:"uint256"},{name:"limit",type:"uint256",internalType:"uint256"},{name:"period",type:"uint64",internalType:"uint64"}]},{type:"error",name:"CallPolicyViolated",inputs:[{name:"target",type:"address",internalType:"address"},{name:"selector",type:"bytes4",internalType:"bytes4"}]},{type:"error",name:"CallReverted",inputs:[]},{type:"error",name:"ConditionFailed",inputs:[{name:"param",type:"bytes32",internalType:"bytes32"},{name:"refValue",type:"bytes32",internalType:"bytes32"},{name:"condition",type:"uint8",internalType:"uint8"}]},{type:"error",name:"InvalidDataLength",inputs:[{name:"actualLength",type:"uint256",internalType:"uint256"},{name:"expectedLength",type:"uint256",internalType:"uint256"}]},{type:"error",name:"InvalidSignature",inputs:[{name:"msgSender",type:"address",internalType:"address"},{name:"thisAddress",type:"address",internalType:"address"}]},{type:"error",name:"LifetimeUsageExceeded",inputs:[{name:"lifetimeUsage",type:"uint256",internalType:"uint256"},{name:"limit",type:"uint256",internalType:"uint256"}]},{type:"error",name:"MaxValueExceeded",inputs:[{name:"value",type:"uint256",internalType:"uint256"},{name:"maxValuePerUse",type:"uint256",internalType:"uint256"}]},{type:"error",name:"NoCallsToExecute",inputs:[]},{type:"error",name:"SessionExpired",inputs:[]},{type:"error",name:"SessionExpiresTooSoon",inputs:[]},{type:"error",name:"SessionZeroSigner",inputs:[]},{type:"error",name:"TransferPolicyViolated",inputs:[{name:"target",type:"address",internalType:"address"}]},{type:"error",name:"UIDAlreadyProcessed",inputs:[]}];async function ae(t,e,n){if(e?.auth?.mode!=="popup"&&e?.auth?.mode!==void 0&&n.authenticateWithRedirect){const o=t.strategy;U.includes(o)&&await n.authenticateWithRedirect(o,e?.auth?.mode,e?.auth?.redirectUrl)}const p=(await n.connect(t)).user.account;return S({authAccount:p,client:t.client,createOptions:e,desiredChain:t.chain})}async function ie(t,e,n){t.authResult&&n.loginWithAuthToken&&await n.loginWithAuthToken(t.authResult);const s=await J(n);if(!s)throw new Error("Failed to authenticate user.");const p=s.account;return S({authAccount:p,client:t.client,createOptions:e,desiredChain:t.chain})}async function K(t){const{connectSmartAccount:e}=await b(async()=>{const{connectSmartAccount:n}=await import("./index-Cij_JTZo.js").then(s=>s.i);return{connectSmartAccount:n}},__vite__mapDeps([7,1,2,8,9,4,10,11,12,13,14,5,3]));return e({chain:t.chain,client:t.client,personalAccount:t.authAccount},t.smartAccountOptions)}async function J(t){const e=await t.getUser();switch(e.status){case"Logged In, Wallet Initialized":return e}}async function S(t){const{createOptions:e,authAccount:n,desiredChain:s,client:p}=t;let o,a;const i=e&&"executionMode"in e?e.executionMode:void 0;if(i&&(i.mode==="EIP4337"?o=i.smartAccount:i.mode==="EIP7702"&&(a=i)),e&&"smartAccount"in e&&e?.smartAccount&&(o=e.smartAccount),o){const[r,l]=await K({authAccount:n,chain:s,client:p,smartAccountOptions:o});return{account:r,adminAccount:n,chain:l}}if(a){const r=s;if(!r)throw new Error("Chain is required for EIP-7702 execution, pass a chain when connecting the inAppWallet.");return{account:$({adminAccount:n,client:p,sponsorGas:a.sponsorGas}),adminAccount:n,chain:r}}return{account:n,chain:s||F}}export{ie as autoConnectInAppWallet,ae as connectInAppWallet};
